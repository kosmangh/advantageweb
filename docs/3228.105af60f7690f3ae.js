"use strict";(self.webpackChunkadvantageweb=self.webpackChunkadvantageweb||[]).push([[3228],{2187:(T,Z,o)=>{o.d(Z,{c:()=>m});var h=o(6814),c=o(1054),s=o(2868),n=o(5879);function f(d,g){if(1&d&&(n.TgZ(0,"div"),n.ALo(1,"avatarBg"),n.TgZ(2,"span"),n._uU(3),n.ALo(4,"avatarName"),n.qZA()()),2&d){const _=n.oxw();n.Gre("user-avatar  d-none d-sm-flex ",n.lcZ(1,4,""),""),n.xp6(3),n.hij("",n.lcZ(4,6,_.fullName)," ")}}function i(d,g){if(1&d&&(n.TgZ(0,"span"),n._UZ(1,"br"),n.TgZ(2,"span"),n._uU(3),n.qZA()()),2&d){const _=n.oxw();n.xp6(3),n.Oqu(_.otherFieldName)}}let m=(()=>{var d;class g{constructor(){this.showAvatar=!0}ngOnInit(){}}return(d=g).\u0275fac=function(B){return new(B||d)},d.\u0275cmp=n.Xpm({type:d,selectors:[["app-full-name"]],inputs:{fullName:"fullName",otherFieldName:"otherFieldName",showAvatar:"showAvatar"},standalone:!0,features:[n.jDz],decls:7,vars:3,consts:[[1,"user-card"],[3,"class",4,"ngIf"],[1,"user-info"],[1,"text-black"],[1,"dot","dot-success","d-md-none","ms-1"],[4,"ngIf"]],template:function(B,A){1&B&&(n.TgZ(0,"div",0),n.YNc(1,f,5,8,"div",1),n.TgZ(2,"div",2)(3,"span",3),n._uU(4),n._UZ(5,"span",4),n.qZA(),n.YNc(6,i,4,1,"span",5),n.qZA()()),2&B&&(n.xp6(1),n.Q6J("ngIf",A.showAvatar),n.xp6(3),n.hij(" ",A.fullName," "),n.xp6(2),n.Q6J("ngIf",A.otherFieldName))},dependencies:[h.ez,h.O5,c.b,s.M],encapsulation:2}),g})()},1054:(T,Z,o)=>{o.d(Z,{b:()=>c});var h=o(5879);let c=(()=>{var s;class n{transform(i){const m=["bg-info-dim","bg-warning-dim","bg-primary-dim","bg-success-dim","bg-danger-dim","bg-purple-dim","bg-indigo-dim"];return m[Math.floor(Math.random()*m.length)]}}return(s=n).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=h.Yjl({name:"avatarBg",type:s,pure:!0,standalone:!0}),n})()},2868:(T,Z,o)=>{o.d(Z,{M:()=>c});var h=o(5879);let c=(()=>{var s;class n{transform(i){if(!i)return"NF";const m=i.split(" ");let d=m[0],g=m[1];return g?(d.charAt(0)+""+g.charAt(0)).toUpperCase():d.slice(0,2).toUpperCase()}}return(s=n).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=h.Yjl({name:"avatarName",type:s,pure:!0,standalone:!0}),n})()},4874:(T,Z,o)=>{o.d(Z,{i:()=>c});var h=o(5879);let c=(()=>{var s;class n{transform(i){return i.trim().split("_").map(d=>d.trim()).join(" ")}}return(s=n).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=h.Yjl({name:"removeHyphen",type:s,pure:!0,standalone:!0}),n})()},1085:(T,Z,o)=>{o.d(Z,{e:()=>c});var h=o(5879);let c=(()=>{var s;class n{constructor(i,m){this.changeDetectorRef=i,this.ngZone=m,this.timer=null}transform(i){this.removeTimer();let m=new Date(i),g=Math.round(Math.abs(((new Date).getTime()-m.getTime())/1e3)),_=Number.isNaN(g)?1e3:1e3*this.getSecondsUntilUpdate(g);this.timer=this.ngZone.runOutsideAngular(()=>typeof window<"u"?window.setTimeout(()=>{this.ngZone.run(()=>this.changeDetectorRef.markForCheck())},_):null);let B=Math.round(Math.abs(g/60)),A=Math.round(Math.abs(B/60)),b=Math.round(Math.abs(A/24)),N=Math.round(Math.abs(b/30.416)),C=Math.round(Math.abs(b/365));return Number.isNaN(g)?"":g<=45?"a few seconds ago":g<=90?"a minute ago":B<=45?B+" minutes ago":B<=90?"an hour ago":A<=22?A+" hours ago":A<=36?"a day ago":b<=25?b+" days ago":b<=45?"a month ago":b<=345?N+" months ago":b<=545?"a year ago":C+" years ago"}ngOnDestroy(){this.removeTimer()}removeTimer(){this.timer&&(window.clearTimeout(this.timer),this.timer=null)}getSecondsUntilUpdate(i){return i<60?2:i<3600?30:i<86400?300:3600}}return(s=n).\u0275fac=function(i){return new(i||s)(h.Y36(h.sBO,16),h.Y36(h.R0b,16))},s.\u0275pipe=h.Yjl({name:"timeAgo",type:s,pure:!1,standalone:!0}),n})()},3228:(T,Z,o)=>{o.r(Z),o.d(Z,{RentalBillingComponent:()=>ne});var h=o(5861),c=o(6814),s=o(995),n=o(3519),f=o.n(n),i=o(95),m=o(4740),d=o(2458),g=o(5176),_=o(2735),B=o(2187),A=o(8624),b=o(4874),N=o(1085),C=o(1693),P=o(3221),Y=o(4647),U=o(1392),e=o(5879),I=o(7962),O=o(7467),D=o(1449),S=o(6842),q=o(7177),w=o(4981),J=o(7236);function E(r,u){if(1&r&&(e.TgZ(0,"ng-option",31),e._uU(1),e.qZA()),2&r){const a=u.$implicit;e.Q6J("value",a.recordId),e.xp6(1),e.hij(" ",a.estateName," ")}}function L(r,u){1&r&&(e.TgZ(0,"div"),e._UZ(1,"app-required-field"),e.qZA())}function Q(r,u){if(1&r&&(e.TgZ(0,"ng-option",31),e._uU(1),e.qZA()),2&r){const a=u.$implicit;e.Q6J("value",a.recordId),e.xp6(1),e.hij(" ",a.block," ")}}function k(r,u){1&r&&(e.TgZ(0,"div",32),e._UZ(1,"app-required-field"),e.qZA())}function G(r,u){if(1&r&&(e.TgZ(0,"ng-option",31),e._uU(1),e.qZA()),2&r){const a=u.$implicit;e.Q6J("value",a.recordId),e.xp6(1),e.AsE(" ",a.propertyName," ",a.recordId," ")}}function x(r,u){1&r&&(e.TgZ(0,"div"),e._UZ(1,"app-required-field"),e.qZA())}function j(r,u){1&r&&(e.TgZ(0,"span"),e._UZ(1,"app-required-field"),e.qZA())}function K(r,u){1&r&&(e.TgZ(0,"div"),e._UZ(1,"app-required-field"),e.qZA())}const y=function(r){return{"is-invalid":r}},$=function(r){return{"is-valid":r}};let z=(()=>{var r;class u{constructor(l,t,p,v,R,F,M,re){this.rentBillingService=l,this.utilsService=t,this.settingsService=p,this.addRentalBillBsModalRef=v,this.fb=R,this.accountService=F,this.alertService=M,this.logger=re,this.submitted=!1,this.accountService.currentUser.subscribe(oe=>this.currentUser=oe)}ngOnInit(){this.createNewForm(),this.addRentalBillBsModalRef.setClass("gray modal-md modal-dialog-top"),this.listOfChargeYears=this.utilsService.getChargeYears(),this.listOfUsages=this.settingsService.getPropertyUsage()}createNewForm(){this.rentalBillFormGroup=this.fb.group({estateId:["",[i.kI.required]],blockId:["",[i.kI.required]],propertyId:["",[i.kI.required]],rentAmount:["",[i.kI.required]],billDate:["",[i.kI.required]],recordId:[""],billingType:["PROP"],saveAndNew:[!1]}),this.fetchEstates()}get rentalBillForm(){return this.rentalBillFormGroup.controls}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:l=>{if(this.logger.info("getEstates response "+JSON.stringify(l)),"000"===l.headerResponse.responseCode)return l.estates.length<=0?(this.alertService.showInfoMsgGeneral("No zones found"),void this.logger.info("No zones found")):void(this.listOfEstates=l.estates);this.alertService.error(l.headerResponse.responseMessage)},error:l=>{this.logger.error(l),this.alertService.showInfoMsg(l)}})}fetchBlocks(){this.listOfBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.rentalBillForm.estateId.value).subscribe({next:l=>{if(this.logger.info("getEstateBlocks response "+JSON.stringify(l)),"000"===l.headerResponse.responseCode)return l.estateBlocks.length<=0?(this.alertService.showInfoMsgGeneral("No blocks found"),void this.logger.info("No blocks found")):void(this.listOfBlocks=l.estateBlocks);this.alertService.error(l.headerResponse.responseMessage)},error:l=>{this.logger.error(l),this.alertService.showInfoMsg(l)}})}fetchEstateProperties(){this.listOfProperties=[],this.settingsService.getEstateProperties(this.currentUser,this.rentalBillForm.blockId.value,!0,"RENTAL").subscribe({next:l=>{if(this.logger.info("getEstateProperties response "+JSON.stringify(l)),"000"===l.headerResponse.responseCode)return l.properties.length<=0?(this.alertService.showInfoMsgGeneral("No properties found"),this.logger.info("No properties found "),void this.rentalBillForm.propertyId.setValue("No properties found")):void(this.listOfProperties=l.properties);this.alertService.error(l.headerResponse.responseMessage)},error:l=>{this.logger.error(l.message),this.alertService.showInfoMsg(l.message)}})}savePropertyCharge(){if(this.submitted=!0,this.rentalBillFormGroup.invalid)return;let l=this.rentalBillForm.propertyId.value,t=this.listOfProperties.find(p=>p.recordId===l)?.propertyName;f().fire({title:"Confirmation",text:`Do you want to apply ground rent bill for  ${t} property?`,icon:"question",position:"top",showCancelButton:!0,confirmButtonText:"Yes, create",cancelButtonText:"No, cancel"}).then(p=>{p.value?(this.alertService.clear(),this.rentBillingService.saveRentalBill(this.currentUser,this.rentalBillFormGroup.value).subscribe({next:v=>{"000"===v.headerResponse.responseCode?(this.alertService.showSuccessMsg(v.headerResponse.responseMessage),this.rentalBillForm.saveAndNew.value||(this.addRentalBillBsModalRef.hide(),this.accountService.reloadCurrentRoute()),this.rentalBillFormGroup.reset(),this.createNewForm(),this.submitted=!1,this.logAction(`Applied ground rent bill for ${t}`,s.h.ESTATE_BILLING)):this.alertService.showErrorMsg(v.headerResponse.responseMessage)},error:v=>{this.alertService.showInfoMsg(v)}})):f()})}logAction(l,t){var p=this;return(0,h.Z)(function*(){yield p.accountService.logUserAudit(l,t)})()}}return(r=u).\u0275fac=function(l){return new(l||r)(e.Y36(I.r),e.Y36(O.F),e.Y36(D.g),e.Y36(S.UZ),e.Y36(i.qu),e.Y36(q.e),e.Y36(w.c),e.Y36(J.Kf))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-rental-bill"]],standalone:!0,features:[e.jDz],decls:74,vars:43,consts:[["novalidate","",3,"formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button btn-xs","aria-label","Close",1,"close","btn-close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"alert","alert-primary","alert-icon"],[1,"icon","ni","ni-alert-c"],[1,"row","gy-3","mt-3"],[1,"col-sm-6"],[1,"form-group"],[3,"labelForName","labelName"],[1,"form-control-wrap"],["id","estateid","formControlName","estateId",3,"clearable","ngClass","change"],["value","","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],[4,"ngIf"],["id","estateid","formControlName","blockId",3,"clearable","ngClass","change"],["class","text-danger",4,"ngIf"],["id","propertyId","formControlName","propertyId",3,"clearable","ngClass"],["styleClass","w-100","formControlName","billDate","id","billDate","dateFormat","dd-mm-yy",3,"showIcon","yearNavigator","monthNavigator","ngClass"],["type","number","formControlName","rentAmount","id","rentAmount","autocomplete","off",1,"form-control",3,"ngClass"],[1,"col-sm-12"],[1,"custom-control","custom-control-sm","custom-checkbox","checked"],["type","checkbox","formControlName","saveAndNew","id","saveAndNew","id","saveAndNew",1,"custom-control-input"],["for","saveAndNew",1,"custom-control-label","fw-bolder"],[1,"row","my-3","mx-2","mb-3","justify-content-end"],[1,"col-auto"],["data-bs-dismiss","modal",1,"btn","btn-outline-light","btn-sm",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click"],[3,"value"],[1,"text-danger"]],template:function(l,t){1&l&&(e.TgZ(0,"form",0)(1,"div",1)(2,"h6",2),e._uU(3,"Property Rental billing"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return null==t.addRentalBillBsModalRef?null:t.addRentalBillBsModalRef.hide()}),e.TgZ(5,"span",4),e._uU(6,"\xd7"),e.qZA()()(),e.TgZ(7,"div",5)(8,"div",6),e._UZ(9,"em",7),e.TgZ(10,"strong")(11,"em"),e._uU(12,"Heads up"),e.qZA()(),e._uU(13,". Selected property must be occupied as "),e.TgZ(14,"strong"),e._uU(15,"Rental"),e.qZA()(),e._UZ(16,"br")(17,"app-required-fields-notice"),e.TgZ(18,"div",8)(19,"div",9)(20,"div",10),e._UZ(21,"app-form-label",11),e.TgZ(22,"div",12)(23,"ng-select",13),e.NdJ("change",function(){return t.fetchBlocks()}),e.TgZ(24,"ng-option",14),e._uU(25,"Select One"),e.qZA(),e.YNc(26,E,2,2,"ng-option",15),e.qZA(),e.TgZ(27,"span",16),e.YNc(28,L,2,0,"div",17),e.qZA()()()(),e.TgZ(29,"div",9)(30,"div",10),e._UZ(31,"app-form-label",11),e.TgZ(32,"div",12)(33,"ng-select",18),e.NdJ("change",function(){return t.fetchEstateProperties()}),e.TgZ(34,"ng-option",14),e._uU(35,"Select One"),e.qZA(),e.YNc(36,Q,2,2,"ng-option",15),e.qZA(),e.TgZ(37,"span",16),e.YNc(38,k,2,0,"div",19),e.qZA()()()(),e.TgZ(39,"div",9)(40,"div",10),e._UZ(41,"app-form-label",11),e.TgZ(42,"div",12)(43,"ng-select",20)(44,"ng-option",14),e._uU(45,"Select Property"),e.qZA(),e.YNc(46,G,2,3,"ng-option",15),e.qZA(),e.TgZ(47,"span",16),e.YNc(48,x,2,0,"div",17),e.qZA()()()(),e.TgZ(49,"div",9)(50,"div",10),e._UZ(51,"app-form-label",11)(52,"p-calendar",21),e.TgZ(53,"span",16),e.YNc(54,j,2,0,"span",17),e.qZA()()(),e.TgZ(55,"div",9)(56,"div",10),e._UZ(57,"app-form-label",11),e.TgZ(58,"div",12),e._UZ(59,"input",22),e.TgZ(60,"span",16),e.YNc(61,K,2,0,"div",17),e.qZA()()()(),e.TgZ(62,"div",23)(63,"div",24),e._UZ(64,"input",25),e.TgZ(65,"label",26),e._uU(66," Save & create new "),e.qZA()()()()(),e.TgZ(67,"div",27)(68,"div",28)(69,"button",29),e.NdJ("click",function(){return null==t.addRentalBillBsModalRef?null:t.addRentalBillBsModalRef.hide()}),e._uU(70," Close "),e.qZA()(),e.TgZ(71,"div",28)(72,"button",30),e.NdJ("click",function(){return t.savePropertyCharge()}),e._uU(73," Apply property billing "),e.qZA()()()()),2&l&&(e.Q6J("formGroup",t.rentalBillFormGroup),e.xp6(21),e.Q6J("labelForName","estateId")("labelName","Estate"),e.xp6(2),e.Q6J("clearable",!1)("ngClass",e.VKq(31,y,((null==t.rentalBillForm.estateId?null:t.rentalBillForm.estateId.touched)||(null==t.rentalBillForm.estateId?null:t.rentalBillForm.estateId.dirty)||t.submitted)&&(null==t.rentalBillForm.estateId?null:t.rentalBillForm.estateId.errors))),e.xp6(3),e.Q6J("ngForOf",t.listOfEstates),e.xp6(2),e.Q6J("ngIf",(null==t.rentalBillForm.estateId||null==t.rentalBillForm.estateId.errors?null:t.rentalBillForm.estateId.errors.required)||t.submitted),e.xp6(3),e.Q6J("labelForName","blockId")("labelName","Block"),e.xp6(2),e.Q6J("clearable",!0)("ngClass",e.VKq(33,y,((null==t.rentalBillForm.blockId?null:t.rentalBillForm.blockId.touched)||(null==t.rentalBillForm.blockId?null:t.rentalBillForm.blockId.dirty)||t.submitted)&&(null==t.rentalBillForm.blockId?null:t.rentalBillForm.blockId.errors))),e.xp6(3),e.Q6J("ngForOf",t.listOfBlocks),e.xp6(2),e.Q6J("ngIf",null==t.rentalBillForm.blockId||null==t.rentalBillForm.blockId.errors?null:t.rentalBillForm.blockId.errors.required),e.xp6(3),e.Q6J("labelForName","propertyId")("labelName","Estate Properties"),e.xp6(2),e.Q6J("clearable",!1)("ngClass",e.VKq(35,$,null==t.rentalBillForm.propertyId?null:t.rentalBillForm.propertyId.valid))("ngClass",e.VKq(37,y,((null==t.rentalBillForm.propertyId?null:t.rentalBillForm.propertyId.touched)||(null==t.rentalBillForm.propertyId?null:t.rentalBillForm.propertyId.dirty)||t.submitted)&&(null==t.rentalBillForm.propertyId?null:t.rentalBillForm.propertyId.errors))),e.xp6(3),e.Q6J("ngForOf",t.listOfProperties),e.xp6(2),e.Q6J("ngIf",null==t.rentalBillForm.propertyId||null==t.rentalBillForm.propertyId.errors?null:t.rentalBillForm.propertyId.errors.required),e.xp6(3),e.Q6J("labelForName","billDate")("labelName","Date of Billing"),e.xp6(1),e.Q6J("showIcon",!0)("yearNavigator",!0)("monthNavigator",!0)("ngClass",e.VKq(39,y,((null==t.rentalBillForm.billDate?null:t.rentalBillForm.billDate.touched)||(null==t.rentalBillForm.billDate?null:t.rentalBillForm.billDate.dirty)||t.submitted)&&(null==t.rentalBillForm.billDate?null:t.rentalBillForm.billDate.errors))),e.xp6(2),e.Q6J("ngIf",null==t.rentalBillForm.billDate||null==t.rentalBillForm.billDate.errors?null:t.rentalBillForm.billDate.errors.required),e.xp6(3),e.Q6J("labelForName","rentAmount")("labelName","Rent Charge"),e.xp6(2),e.Q6J("ngClass",e.VKq(41,y,((null==t.rentalBillForm.rentAmount?null:t.rentalBillForm.rentAmount.touched)||(null==t.rentalBillForm.rentAmount?null:t.rentalBillForm.rentAmount.dirty)||t.submitted)&&(null==t.rentalBillForm.rentAmount?null:t.rentalBillForm.rentAmount.errors))),e.xp6(2),e.Q6J("ngIf",null==t.rentalBillForm.rentAmount||null==t.rentalBillForm.rentAmount.errors?null:t.rentalBillForm.rentAmount.errors.required))},dependencies:[c.ez,c.mk,c.sg,c.O5,i.u5,i._Y,i.Fj,i.wV,i.Wl,i.JJ,i.JL,i.UX,i.sg,i.u,P.z,U._8,U.f,_.h,C.M,m.A0,m.w9,m.jq,Y.P4],encapsulation:2}),u})();var H=o(9972);function V(r,u){if(1&r&&(e.TgZ(0,"ng-option",23),e._uU(1),e.qZA()),2&r){const a=u.$implicit;e.Q6J("value",a),e.xp6(1),e.hij(" ",a," ")}}function W(r,u){if(1&r&&(e.TgZ(0,"ng-option",23),e._uU(1),e.qZA()),2&r){const a=u.$implicit;e.Q6J("value",a),e.xp6(1),e.hij(" ",a," ")}}function X(r,u){if(1&r){const a=e.EpF();e.TgZ(0,"div",8)(1,"div",24)(2,"div",25),e._UZ(3,"em",26),e.qZA(),e.TgZ(4,"input",27),e.NdJ("ngModelChange",function(t){e.CHM(a);const p=e.oxw();return e.KtG(p.searchedKeyword=t)}),e.qZA()()()}if(2&r){const a=e.oxw();e.xp6(4),e.Q6J("ngModel",a.searchedKeyword)}}function ee(r,u){1&r&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"SN"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Occupant"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Property"),e.qZA(),e.TgZ(7,"th",28),e._uU(8,"Property No"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Usage"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Occupation Type"),e.qZA(),e.TgZ(13,"th",28),e._uU(14,"Charge Year"),e.qZA(),e.TgZ(15,"th",28),e._uU(16,"Amount"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Bill Type"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Bill Date"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Last Updated"),e.qZA()())}function te(r,u){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"app-full-name",29),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"app-full-name",30),e.ALo(7,"removeHyphen"),e.ALo(8,"titlecase"),e.qZA(),e.TgZ(9,"td",28),e._uU(10),e.qZA(),e.TgZ(11,"td",31),e._uU(12),e.ALo(13,"removeHyphen"),e.ALo(14,"titlecase"),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.ALo(17,"titlecase"),e.qZA(),e.TgZ(18,"td",28),e._uU(19),e.qZA(),e.TgZ(20,"td",32),e._uU(21),e.ALo(22,"number"),e.qZA(),e.TgZ(23,"td",31),e._uU(24),e.ALo(25,"removeHyphen"),e.ALo(26,"titlecase"),e.qZA(),e.TgZ(27,"td"),e._uU(28),e.ALo(29,"lowercase"),e.TgZ(30,"div",33)(31,"small",34),e._uU(32),e.ALo(33,"date"),e.qZA(),e.TgZ(34,"small",35),e._uU(35),e.ALo(36,"timeAgo"),e.qZA()()(),e.TgZ(37,"td"),e._uU(38),e.ALo(39,"lowercase"),e.TgZ(40,"div",33)(41,"small",34),e._uU(42),e.ALo(43,"date"),e.qZA(),e.TgZ(44,"small",35),e._uU(45),e.ALo(46,"timeAgo"),e.qZA()()()()),2&r){const a=u.$implicit,l=u.rowIndex;e.xp6(2),e.Oqu(l+1),e.xp6(2),e.s9C("fullName",null==a?null:a.occupantName),e.s9C("otherFieldName",null==a?null:a.institutionalDisplayName),e.xp6(2),e.s9C("fullName",null==a?null:a.propertyName),e.s9C("otherFieldName",e.lcZ(7,18,e.lcZ(8,20,null==a?null:a.propertyId))),e.Q6J("showAvatar",!1),e.xp6(4),e.Oqu(a.propertyNo),e.xp6(2),e.Oqu(e.lcZ(13,22,e.lcZ(14,24,a.propertyUsage))),e.xp6(4),e.Oqu(e.lcZ(17,26,a.occupationType)),e.xp6(3),e.Oqu(a.ledgerYear),e.xp6(2),e.Oqu(e.xi3(22,28,a.amountInvolved,".2-2")),e.xp6(3),e.Oqu(e.lcZ(25,31,e.lcZ(26,33,a.paymentType))),e.xp6(4),e.hij(" ",e.lcZ(29,35,a.createdBy)," "),e.xp6(4),e.Oqu(e.xi3(33,37,a.createdDate,"medium")),e.xp6(3),e.hij(" ",e.lcZ(36,40,a.createdDate),""),e.xp6(3),e.hij(" ",e.lcZ(39,42,a.lastModifiedBy)," "),e.xp6(4),e.Oqu(e.xi3(43,44,a.lastModifiedDate,"medium")),e.xp6(3),e.hij(" ",e.lcZ(46,47,a.lastModifiedDate),"")}}const le=function(){return[5,10,25,50]};let ne=(()=>{var r;class u{constructor(l,t,p,v,R,F){this.rentalBillService=l,this.utilsService=t,this.accountService=p,this.alertService=v,this.logger=R,this.addGroundRentBillModalService=F,this.accountService.currentUser.subscribe(M=>this.currentUser=M)}ngOnInit(){this.estate="A",this.block="A",this.logAction("Viewed property charges page",s.h.ESTATE_BILLING),this.regionId=this.currentUser.regionId,this.chargeYear=(new Date).getFullYear(),this.rentMonth=this.utilsService.getCurrentMonthName(),this.listOfChargeYears=this.utilsService.getChargeYears(),this.listOfMonths=this.utilsService.getMonthsOfYear(),this.fetchRentalBills()}ngOnDestroy(){this.addGroundRentBillModalService.hide(),f().close()}refreshButton(){this.fetchRentalBills()}fetchRentalBills(){this.listOfPropertyCharges=[],this.rentalBillService.getRentalBills(this.currentUser,this.rentMonth,this.chargeYear).subscribe({next:l=>{if(this.logger.info("getPropertyCharges response "+JSON.stringify(l)),"000"===l.headerResponse.responseCode){if(l.propertyLedgers.length<=0){let t=`No rent bills found for ${this.rentMonth}, ${this.chargeYear}`;return this.alertService.showInfoMsgGeneral(t),void this.logger.info(t)}this.listOfPropertyCharges=l.propertyLedgers}else this.alertService.error(l.headerResponse.responseMessage)},error:l=>{this.logger.error(l),this.alertService.showInfoMsg(l)}})}applyLastRentBilled2CurrentMonth(){f().fire({position:"top",title:"Confirmation",text:`This action will apply the last rent billed to occupants for ${this.rentMonth},${this.chargeYear}?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, apply"}).then(l=>{l.value?this.rentalBillService.applyLastRentBilled2CurrentMonth(this.currentUser).subscribe({next:t=>{this.logger.info("applyLastRentBilled2CurrentMonth response:"+JSON.stringify(t)),"000"===t.headerResponse.responseCode?(this.alertService.showSuccessMsg(t.headerResponse.responseMessage),this.logAction(`Applied last rent billed to ${this.rentMonth}, ${this.chargeYear}`,s.h.ESTATE_BILLING),this.fetchRentalBills()):this.alertService.showErrorMsg(t.headerResponse.responseMessage)},error:t=>{this.alertService.showInfoMsg(t.message)}}):f()})}openGroundRentBillModalComponent(){this.addGroundRentBillModalService.config.ignoreBackdropClick=!0,this.addGroundRentBillModalService.config.animated=!0,this.addGroundRentBillBsModalRef=this.addGroundRentBillModalService.show(z),this.addGroundRentBillBsModalRef.content.closeBtnName="Close"}logAction(l,t){var p=this;return(0,h.Z)(function*(){yield p.accountService.logUserAudit(l,t)})()}}return(r=u).\u0275fac=function(l){return new(l||r)(e.Y36(I.r),e.Y36(O.F),e.Y36(q.e),e.Y36(w.c),e.Y36(J.Kf),e.Y36(S.tT))},r.\u0275cmp=e.Xpm({type:r,selectors:[["ng-component"]],standalone:!0,features:[e.jDz],decls:35,vars:24,consts:[[3,"pageTitleName","description"],[1,"newItemName"],[1,"btn","btn-outline-primary",3,"click"],[1,"icon","ni","ni-view-grid-fill"],[1,"anotherItemName"],[1,"btn","btn-primary",3,"click"],[1,"icon","ni","ni-plus"],[1,"row","gy-2","gx-3","mb-4","align-items-center"],[1,"col-sm-2"],[1,"form-group"],[3,"labelForName","labelName"],[1,"form-control-wrap"],["id","estate",3,"clearable","ngModel","ngModelChange"],["value","A","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],["id","chargeYear",3,"clearable","ngModel","ngModelChange"],["class","col-sm-2",4,"ngIf"],[1,"col-auto"],["type","button","title","",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],[3,"value"],[1,"form-control-wrap","mt-4"],[1,"form-icon","form-icon-right"],[1,"icon","ni","ni-search"],["type","text","id","default-04","placeholder"," Search property here",1,"form-control",3,"ngModel","ngModelChange"],[1,"text-end"],[3,"fullName","otherFieldName"],[3,"showAvatar","fullName","otherFieldName"],[1,"text-capitalize"],[1,"text-end","font-monospace"],[1,"fw-lighter"],[1,"d-block"],[1,"text-primary"]],template:function(l,t){1&l&&(e.TgZ(0,"app-add-item",0)(1,"span",1)(2,"a",2),e.NdJ("click",function(){return t.applyLastRentBilled2CurrentMonth()}),e._UZ(3,"em",3),e.TgZ(4,"span"),e._uU(5,"Batch rental billing"),e.qZA()()(),e.TgZ(6,"span",4)(7,"a",5),e.NdJ("click",function(){return t.openGroundRentBillModalComponent()}),e._UZ(8,"em",6),e.TgZ(9,"span"),e._uU(10,"Add a rental bill"),e.qZA()()()(),e.TgZ(11,"div",7)(12,"div",8)(13,"div",9),e._UZ(14,"app-form-label",10),e.TgZ(15,"div",11)(16,"ng-select",12),e.NdJ("ngModelChange",function(v){return t.rentMonth=v}),e.TgZ(17,"ng-option",13),e._uU(18,"Select Month"),e.qZA(),e.YNc(19,V,2,2,"ng-option",14),e.qZA()()()(),e.TgZ(20,"div",8)(21,"div",9),e._UZ(22,"app-form-label",10),e.TgZ(23,"div",11)(24,"ng-select",15),e.NdJ("ngModelChange",function(v){return t.chargeYear=v}),e.YNc(25,W,2,2,"ng-option",14),e.qZA()()()(),e.YNc(26,X,5,1,"div",16),e.TgZ(27,"div",17)(28,"button",18),e.NdJ("click",function(){return t.fetchRentalBills()}),e._uU(29," Search "),e.qZA()()(),e.TgZ(30,"p-table",19,20),e.ALo(32,"filter"),e.YNc(33,ee,23,0,"ng-template",21),e.YNc(34,te,47,49,"ng-template",22),e.qZA()),2&l&&(e.Q6J("pageTitleName","Ground Rent Billing")("description","Apply ground rent to estates,properties and occupants"),e.xp6(14),e.Q6J("labelForName","estate")("labelName","Rent Month"),e.xp6(2),e.Q6J("clearable",!1)("ngModel",t.rentMonth),e.xp6(3),e.Q6J("ngForOf",t.listOfMonths),e.xp6(3),e.Q6J("labelForName","chargeYear")("labelName","Rent Year"),e.xp6(2),e.Q6J("clearable",!1)("ngModel",t.chargeYear),e.xp6(1),e.Q6J("ngForOf",t.listOfChargeYears),e.xp6(1),e.Q6J("ngIf",(null==t.listOfPropertyCharges?null:t.listOfPropertyCharges.length)>0),e.xp6(4),e.Q6J("value",e.xi3(32,20,t.listOfPropertyCharges,t.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",e.DdM(23,le))("resizableColumns",!0)("autoLayout",!0))},dependencies:[c.ez,c.sg,c.O5,c.i8,c.JJ,c.rS,c.uU,d.U$,d.iA,H.jx,i.u5,i.Fj,i.JJ,i.On,m.A0,m.w9,m.jq,B.c,g.L,A.$,N.e,_.h,b.i],encapsulation:2}),u})()}}]);