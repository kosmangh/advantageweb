import{a as be,b as Pe,c as we}from"./chunk-V6IZBQGW.js";import{a as Ee}from"./chunk-BUO42Q2K.js";import{a as Ce}from"./chunk-NXAZBSFM.js";import{b as ye}from"./chunk-MKJDMB7D.js";import{a as xe}from"./chunk-LD7XCFFA.js";import{a as Se}from"./chunk-FMEHXA2G.js";import{a as ge,b as fe,c as _e}from"./chunk-QQMX5O62.js";import{a as ve}from"./chunk-IP4FBAZW.js";import{b as me,c as ce,d as ue,e as he}from"./chunk-7PQCCLGB.js";import"./chunk-T45HSKH6.js";import{d as pe}from"./chunk-WH3N5QDN.js";import{i as ae,r as le,s as se,t as de}from"./chunk-KPCRGR73.js";import{h as B,i as D}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import"./chunk-NEQ5BFSP.js";import{c as Q,f as X,k as W,q as Z,r as ee,s as te,v as ie,x as re}from"./chunk-B2QESFZG.js";import{b as oe}from"./chunk-Y725X6Z7.js";import{b as Ne,c as ne}from"./chunk-R55IMLXW.js";import"./chunk-LPKVFVKE.js";import{b as J,d as z,f as K,g as Y}from"./chunk-IHPVOZWG.js";import"./chunk-HPGLX4ZN.js";import"./chunk-7DWKZ4XI.js";import{Ab as P,Bb as O,Eb as o,Fb as E,Gb as S,Kc as L,Lc as $,Mb as A,Nb as F,Pc as j,Qc as U,Rc as G,Sa as l,Ta as x,Tc as q,Uc as H,Wb as _,Xb as M,Yb as w,bb as m,ib as y,ja as b,la as V,nb as t,ob as n,pb as c,qa as g,qb as N,ra as f,rb as k,tb as C,wb as h,xb as p}from"./chunk-QRSQYA3Q.js";import{d as Re,e as T}from"./chunk-5FZOKLP6.js";var R=Re(Ne());var I=class{};function ke(s,d){if(s&1){let e=C();t(0,"div",2)(1,"div",5)(2,"label",4),o(3),n(),c(4,"br"),t(5,"input",25),h("ngModelChange",function(r){g(e);let a=p(2);return f(a.searchValue=r)}),n()()()}if(s&2){let e=p(2);l(3),E(e.searchParameterLabel),l(2),O("placeholder","Enter ",e.searchParameterLabel,""),m("ngModel",e.searchValue)}}function De(s,d){if(s&1&&(N(0),y(1,ke,6,3,"div",24),k()),s&2){let e=p();l(1),m("ngIf",e.searchParameter)}}function Te(s,d){if(s&1&&(t(0,"ng-option",35),o(1),n()),s&2){let e=d.$implicit;m("value",e.recordId),l(1),S(" ",e.estateName," ")}}function Ve(s,d){if(s&1&&(t(0,"ng-option",35),o(1),n()),s&2){let e=d.$implicit;m("value",e.recordId),l(1),S(" ",e.block," ")}}function Oe(s,d){if(s&1){let e=C();N(0),t(1,"div",2)(2,"div",3),c(3,"app-form-label",26),t(4,"div",5)(5,"ng-select",27),h("ngModelChange",function(r){g(e);let a=p();return f(a.estate=r)})("change",function(){g(e);let r=p();return f(r.fetchEstateBlocks())}),t(6,"ng-option",28),o(7,"Select Estate"),n(),y(8,Te,2,2,"ng-option",29),n()()()(),t(9,"div",2)(10,"div",3),c(11,"app-form-label",26),t(12,"div",5)(13,"ng-select",30),h("ngModelChange",function(r){g(e);let a=p();return f(a.block=r)}),t(14,"ng-option",28),o(15,"Select Block"),n(),y(16,Ve,2,2,"ng-option",29),n()()()(),t(17,"div",12)(18,"div",5)(19,"div",3)(20,"label",31),o(21,"Start Date"),n(),c(22,"br"),t(23,"p-calendar",32),h("ngModelChange",function(r){g(e);let a=p();return f(a.startDate=r)}),n()()()(),t(24,"div",12)(25,"label",33),o(26,"End Date"),n(),c(27,"br"),t(28,"p-calendar",34),h("ngModelChange",function(r){g(e);let a=p();return f(a.endDate=r)}),n()(),k()}if(s&2){let e=p();l(3),m("labelForName","estate")("labelName","Estates"),l(2),m("clearable",!1)("ngModel",e.estate),l(3),m("ngForOf",e.listOfEstates),l(3),m("labelForName","block")("labelName","Blocks"),l(2),m("clearable",!1)("ngModel",e.block),l(3),m("ngForOf",e.listOfEstateBlocks),l(7),m("monthNavigator",!0)("yearNavigator",!0)("showIcon",!0)("ngModel",e.startDate),l(5),m("showIcon",!0)("ngModel",e.endDate)}}function Ae(s,d){if(s&1){let e=C();t(0,"div",12)(1,"div",41)(2,"a",42)(3,"span"),o(4,"Export payments"),n(),c(5,"em",43),n(),t(6,"div",44)(7,"ul",45)(8,"li")(9,"a",46),h("click",function(){g(e);let r=p(2);return f(r.export())}),c(10,"em",47),t(11,"span"),o(12,"Export to Excel"),n()()(),t(13,"li")(14,"a",48),c(15,"em",49),t(16,"span"),o(17,"Export to PDF"),n()()()()()()()}}function Fe(s,d){if(s&1){let e=C();t(0,"div",36)(1,"div",12)(2,"div",5)(3,"div",37),c(4,"em",38),n(),t(5,"input",39),h("ngModelChange",function(r){g(e);let a=p();return f(a.searchedKeyword=r)}),n()()(),y(6,Ae,18,0,"div",40),n()}if(s&2){let e=p();l(5),m("ngModel",e.searchedKeyword),l(1),m("ngIf",(e.billPayments==null?null:e.billPayments.length)>0)}}function Le(s,d){s&1&&(t(0,"tr")(1,"th"),o(2,"Property"),n(),t(3,"th"),o(4,"Occupant"),n(),t(5,"th",50),o(6,"Amount(GHS)"),n(),t(7,"th"),o(8,"Receipt No."),n(),t(9,"th"),o(10,"Narration"),n(),t(11,"th"),o(12,"Payment Mode"),n(),t(13,"th"),o(14,"Payment Date"),n(),t(15,"th"),o(16,"Recorded By"),n(),t(17,"th"),o(18,"Actions"),n()())}function $e(s,d){if(s&1){let e=C();t(0,"li")(1,"a",64),h("click",function(){g(e);let r=p().$implicit,a=p();return f(a.openPrintReceipt(r))}),c(2,"em",65),t(3,"span"),o(4,"Print receipt"),n()()()}}function je(s,d){if(s&1){let e=C();t(0,"tr")(1,"td"),c(2,"app-full-name",51),n(),t(3,"td"),c(4,"app-full-name",51),n(),t(5,"td",52),o(6),_(7,"number"),n(),t(8,"td"),o(9),n(),t(10,"td"),o(11),n(),t(12,"td"),c(13,"app-full-name",51),_(14,"removeHyphen"),_(15,"titlecase"),n(),t(16,"td"),o(17),_(18,"lowercase"),t(19,"div",53)(20,"small",54),o(21),_(22,"date"),n(),t(23,"small"),o(24),_(25,"timeAgo"),n()()(),t(26,"td"),o(27),n(),t(28,"td")(29,"div",55)(30,"a",56),c(31,"em",57),n(),t(32,"div",58)(33,"ul",45)(34,"li")(35,"a",46),h("click",function(){let a=g(e).$implicit,u=p();return f(u.openPaymentDetailsModalComponent(a))}),c(36,"em",59),t(37,"span"),o(38,"View payment details"),n()()(),y(39,$e,5,0,"li",11),t(40,"li")(41,"a",46),h("click",function(){let a=g(e).$implicit,u=p();return f(u.openEditPaymentModalComponent(a))}),c(42,"em",60),t(43,"span"),o(44,"Edit payment"),n()()(),c(45,"li",61),t(46,"li")(47,"a",62),h("click",function(){let a=g(e).$implicit,u=p();return f(u.openReverseBillPayment(a))}),c(48,"em",63),t(49,"span"),o(50,"Reverse bill payment"),n()()()()()()()()}if(s&2){let e=d.$implicit;l(2),P("fullName",e==null?null:e.propertyName),P("otherFieldName",e==null?null:e.propertyId),m("showAvatar",!1),l(2),P("fullName",e==null?null:e.occupantName),P("otherFieldName",e==null?null:e.institutionalDisplayName),m("showAvatar",!1),l(2),S(" ",w(7,17,e==null?null:e.amountPaid,".2-2")," "),l(3),E(e==null?null:e.receiptNumberIssued),l(2),E(e==null?null:e.paymentFor),l(2),P("fullName",M(14,20,M(15,22,e==null?null:e.mediumOfPayment))),P("otherFieldName",e==null?null:e.mediumOfPaymentNumber),m("showAvatar",!1),l(4),S(" ",M(18,24,e==null?null:e.paymentDate)," "),l(4),E(w(22,26,e==null?null:e.createdDate,"medium")),l(3),S(" ",M(25,29,e==null?null:e.createdDate),""),l(3),E(e==null?null:e.createdBy),l(12),m("ngIf",!1)}}var Ue=()=>[5,10,25,50],Bt=(()=>{let d=class d{constructor(i,r,a,u,v,Me,Be){this.billPaymentService=i,this.logger=r,this.addOccupantPropertyBsModalRef=a,this.bsModalRef=u,this.viewOccupantPropertyBsModalRef=v,this.addOccupantPropertyModalService=Me,this.modalService=Be,this.searchParameter="BAB",this.showOccupantSearchBy=!0,this.settingsService=b(pe),this.excelExporterService=b(xe),this.accountService=b(Y),this.alertService=b(ne),this.utilsService=b(K),this.occupantsService=b(Se),this.accountService.currentUser.subscribe(Ie=>this.currentUser=Ie)}ngOnInit(){this.startDate=this.utilsService.getFirstDayDate(),this.endDate=new Date,this.block=localStorage.getItem("block")??null,this.estate=localStorage.getItem("estate")??null,this.block?(this.searchParameter="BAB",this.fetchEstates(),this.fetchEstateBlocks(),this.searchBillPayments()):(this.estate="A",this.block="A",this.searchParameter=="BAB",this.searchParameterListener()),this.totalCredit=0,this.totalDebit=0,this.balance=0}ngOnDestroy(){this.addOccupantPropertyModalService.hide(),R.default.close()}searchParameterListener(){if(this.searchParameter=="receiptNumberIssued"){this.searchParameterLabel="Receipt No.";return}if(this.searchParameter=="mediumOfPaymentNumber"){this.searchParameterLabel="Payment Mode No.";return}this.searchParameter=="BAB"&&(this.estate="A",this.block="A",this.fetchEstates(),this.listOfEstateBlocks=[])}searchBillPayments(){this.billPayments=[];let i=new Ee;i.searchBy=this.searchParameter,i.searchValue=this.searchValue,i.endDate=this.endDate,i.startDate=this.startDate,i.occupantId="",i.propertyId="",this.searchParameter=="BAB"&&(i.searchValue=this.block),i.propertyId=this.block,this.billPaymentService.fetchBillPayments(this.currentUser,i).subscribe({next:r=>{if(this.logger.info("fetchBillPayments response "+JSON.stringify(r)),r.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(r.headerResponse.responseMessage);return}if(r.propertyLedgers.length<=0){this.alertService.showInfoMsgGeneral("No payments found"),this.logger.info("No payments found");return}this.billPayments=r.propertyLedgers,this.totalCredit=r.totalCredit,this.totalDebit=r.totalDebit,this.balance=r.currentBalance},error:r=>{this.logger.error(r),this.alertService.showInfoMsg(r)}})}export(){this.excelExporterService.exportAsExcelFile(this.billPayments,"bill-payments")}printDemandNotice(){this.billPaymentService.generateJasperReport(this.currentUser,null)}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:i=>{if(this.logger.info("getEstates response "+JSON.stringify(i)),i.headerResponse.responseCode!=="000"){this.alertService.error(i.headerResponse.responseMessage);return}if(i.estates.length<=0){this.alertService.showInfoMsgGeneral("No zones found"),this.logger.info("No zones found");return}this.listOfEstates=i.estates},error:i=>{this.logger.error(i),this.alertService.showInfoMsg(i)}})}fetchEstateBlocks(){this.listOfEstateBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.estate).subscribe({next:i=>{if(this.logger.info("getEstates response "+JSON.stringify(i)),i.headerResponse.responseCode!=="000"){this.alertService.error(i.headerResponse.responseMessage);return}if(i.estateBlocks.length<=0){this.alertService.showInfoMsgGeneral("No blocks found"),this.logger.info("No blocks found ");return}this.listOfEstateBlocks=i.estateBlocks},error:i=>{this.logger.error(i.message),this.alertService.showInfoMsg(i.message)}})}openPrintReceipt(i){}openReverseBillPayment(i){let r=i.propertyId;R.default.fire({position:"top",title:"Confirmation",text:`Do you want to reverse payment of GHS ${i.amountPaid} for ${r}?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, reverse"}).then(a=>{if(a.value){this.alertService.clear();let u=new I;u.billId=i.bill,u.ledgerId=i.recordId,this.billPaymentService.reverseBillPayment(this.currentUser,u).subscribe({next:v=>{if(this.logger.info("reverseBillPayment response:"+JSON.stringify(v)),v.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(v.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(v.headerResponse.responseMessage),this.logAction(`Reversed payment of  ${i.amountPaid} of bill ${i.bill}, ${i.paymentFor}`,z.BILL_PAYMENTS),this.accountService.reloadCurrentRoute()},error:v=>{this.alertService.showInfoMsg(v.message)}})}else a.dismiss,R.default.DismissReason.cancel})}openEditPaymentModalComponent(i){let r=new we(null,i);localStorage.setItem("block",this.block),localStorage.setItem("estate",this.estate);let a={initialState:{isAddMode:!1,payBill:r}};this.modalService.config.ignoreBackdropClick=!0,this.modalService.config.animated=!0,this.bsModalRef=this.modalService.show(Pe,a),this.bsModalRef.content.closeBtnName="Close"}openPaymentDetailsModalComponent(i){let r={initialState:{propertyLedger:i}};this.modalService.config.ignoreBackdropClick=!0,this.modalService.config.animated=!0,this.bsModalRef=this.modalService.show(be,r),this.bsModalRef.content.closeBtnName="Close"}logAction(i,r){return T(this,null,function*(){yield this.accountService.logUserAudit(i,r)})}};d.\u0275fac=function(r){return new(r||d)(x(Ce),x(J),x(B),x(B),x(B),x(D),x(D))},d.\u0275cmp=V({type:d,selectors:[["ng-component"]],standalone:!0,features:[A],decls:50,vars:29,consts:[[3,"pageTitleName","description"],[1,"row","gy-2","gx-2","mt-5","mb-4","align-items-center"],[1,"col-sm-2"],[1,"form-group"],["for","searchParameter",1,"form-label","pt-0"],[1,"form-control-wrap"],[1,"form-control-select"],["id","searchParameter",1,"form-control",3,"ngModel","ngModelChange","change"],["value","receiptNumberIssued","selected","",1,"fs-6"],["value","mediumOfPaymentNumber","selected","",1,"fs-6"],["value","BAB"],[4,"ngIf"],[1,"col-auto"],["type","button",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],["class","row gy-2 gx-3 my-3",4,"ngIf"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],[1,"row","mt-3","justify-content-end"],[1,"col-6"],[1,"row","gy-2"],[1,"col-sm-12","text-end"],[1,"ff-mono","fw-bolder"],["class","col-sm-2",4,"ngIf"],["type","text","autocomplete","off","id","searchParameter",1,"form-control",3,"placeholder","ngModel","ngModelChange"],[3,"labelForName","labelName"],["id","estate",3,"clearable","ngModel","ngModelChange","change"],["value","A","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],["id","block",3,"clearable","ngModel","ngModelChange"],["for","startDate",1,"form-label","pt-0"],["dateFormat","yy-mm-dd","styleClass","\u201Dform-control\u201D","dateFormat","dd-mm-yy",3,"monthNavigator","yearNavigator","showIcon","ngModel","ngModelChange"],["for","endDate",1,"form-label","pt-0"],["styleClass","\u201Dform-control\u201D","dateFormat","dd-mm-yy",3,"showIcon","ngModel","ngModelChange"],[3,"value"],[1,"row","gy-2","gx-3","my-3"],[1,"form-icon","form-icon-right"],[1,"icon","ni","ni-search"],["type","text","autocomplete","off","id","default-04","placeholder","Quick search",1,"form-control",3,"ngModel","ngModelChange"],["class","col-auto ",4,"ngIf"],[1,"dropdown"],["href","#","data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-light"],[1,"icon","ni","ni-chevron-down"],[1,"dropdown-menu"],[1,"link-list-opt","no-bdr"],[3,"click"],[1,"icon","ni","ni-file-xls","text-primary"],[1,"disabled-element"],[1,"icon","ni","ni-file-pdf","text-primary"],[1,"text-end"],[3,"showAvatar","fullName","otherFieldName"],[1,"text-end","font-monospace"],[1,"fw-lighter"],[1,"d-block"],[1,"drodown","text-end"],["data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-icon","btn-light"],[1,"icon","ni","ni-more-v"],[1,"dropdown-menu","dropdown-menu-end"],[1,"icon","ni","ni-eye"],[1,"icon","ni","ni-edit"],[1,"divider"],[1,"text-danger",3,"click"],[1,"icon","ni","ni-undo"],[1,"disabled-element",3,"click"],[1,"icon","ni","ni-printer"]],template:function(r,a){r&1&&(c(0,"app-add-item",0),t(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),o(5,"Search By"),n(),c(6,"br"),t(7,"div",5)(8,"div",6)(9,"select",7),h("ngModelChange",function(v){return a.searchParameter=v})("change",function(){return a.searchParameterListener()}),t(10,"option",8),o(11,"Receipt No."),n(),t(12,"option",9),o(13,"Payment Mode No."),n(),t(14,"option",10),o(15,"Estate & block"),n()()()()()(),y(16,De,2,1,"ng-container",11)(17,Oe,29,16,"ng-container",11),t(18,"div",12)(19,"button",13),h("click",function(){return a.searchBillPayments()}),o(20," Search "),n()()(),y(21,Fe,7,2,"div",14),t(22,"p-table",15,16),_(24,"filter"),y(25,Le,19,0,"ng-template",17)(26,je,51,31,"ng-template",18),n(),t(27,"div",19),c(28,"div",20),t(29,"div",20)(30,"div",21)(31,"div",22),o(32," Currency:"),t(33,"span",23),o(34," GHS"),n()(),t(35,"div",22),o(36," Total Arrears: "),t(37,"span",23),o(38),_(39,"number"),n()(),t(40,"div",22),o(41," Total Payments: "),t(42,"span",23),o(43),_(44,"number"),n()(),t(45,"div",22),o(46," Outstanding Bal: "),t(47,"span",23),o(48),_(49,"number"),n()()()()()),r&2&&(m("pageTitleName","Bill Payments")("description","Payments of ground and house rents;payment can also be reversed"),l(9),m("ngModel",a.searchParameter),l(7),m("ngIf",a.searchParameter!=="BAB"),l(1),m("ngIf",a.searchParameter=="BAB"),l(4),m("ngIf",(a.billPayments==null?null:a.billPayments.length)>0),l(1),m("value",w(24,16,a.billPayments,a.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",F(28,Ue))("resizableColumns",!0)("autoLayout",!0),l(16),S(" ",w(39,19,a.totalDebit,"1.2-2"),""),l(5),S(" ",w(44,22,a.totalCredit,"1.2-2"),""),l(5),S(" ",w(49,25,a.balance,"1.2-2"),""))},dependencies:[H,L,$,j,q,U,G,re,_e,fe,ge,ye,ie,ee,te,Q,Z,X,W,se,le,ae,de,ce,me,ue,oe,ve,he],encapsulation:2});let s=d;return s})();export{Bt as PaymentRecordsComponent};
