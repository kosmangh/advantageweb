import{a as $,b as U,c as J}from"./chunk-QQMX5O62.js";import{b as Be,c as Ee,d as Ie,e as xe}from"./chunk-7PQCCLGB.js";import{a as Ce}from"./chunk-T45HSKH6.js";import{d as L}from"./chunk-WH3N5QDN.js";import{i as be,s as Se,t as _e}from"./chunk-KPCRGR73.js";import{h as j,i as Fe}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import{a as ke}from"./chunk-NEQ5BFSP.js";import{b as se,c as D,e as F,f as V,g as ce,k as de,l as me,m as pe,o as ue,p as fe,u as he,v as z,w as ve,x as q}from"./chunk-B2QESFZG.js";import"./chunk-Y725X6Z7.js";import{b as ge,c as P}from"./chunk-R55IMLXW.js";import"./chunk-LPKVFVKE.js";import{b as R,d as G,g as O}from"./chunk-IHPVOZWG.js";import"./chunk-HPGLX4ZN.js";import{m as ae}from"./chunk-7DWKZ4XI.js";import{Eb as l,Fb as b,Gb as u,Ic as te,Kc as w,Lc as T,Mb as y,Nb as ee,Ob as M,Pc as ie,Qc as oe,Rc as ne,Sa as n,Sc as re,Ta as p,Tc as le,Uc as A,Wb as g,Xb as S,Yb as N,bb as c,ib as f,la as x,nb as t,ob as o,pb as m,qa as B,qb as W,ra as E,rb as Z,tb as _,wb as h,xb as v}from"./chunk-QRSQYA3Q.js";import{d as X,e as Q}from"./chunk-5FZOKLP6.js";var C=X(ge());function Pe(r,d){if(r&1&&(t(0,"div",30),m(1,"br"),l(2),m(3,"br"),l(4),m(5,"br"),l(6),m(7,"br"),l(8),g(9,"json"),o()),r&2){let a=v();n(2),u("Dirty: ",a.estateBlockFormGroup.dirty," "),n(2),u("Touched: ",a.estateBlockFormGroup.touched," "),n(2),u("Valid: ",a.estateBlockFormGroup.valid," "),n(2),u("Value: ",S(9,4,a.estateBlockFormGroup.value)," ")}}function qe(r,d){if(r&1&&(t(0,"ng-option",31),l(1),o()),r&2){let a=d.$implicit;c("value",a.recordId),n(1),u(" ",a.estateName," ")}}function je(r,d){r&1&&(t(0,"span",32),m(1,"app-required-field"),o())}function Le(r,d){r&1&&(t(0,"div"),m(1,"app-required-field"),o())}function $e(r,d){r&1&&(t(0,"div"),l(1," * Estate ID must be at least 1 character. "),o())}function Ue(r,d){r&1&&(t(0,"div"),m(1,"app-required-field"),o())}function Je(r,d){r&1&&(W(0),t(1,"div",33),m(2,"input",34),t(3,"label",35),l(4," Save & create new block "),o()(),Z())}function He(r,d){if(r&1){let a=_();t(0,"div",27)(1,"button",36),h("click",function(){B(a);let s=v();return E(s.deleteBlock())}),l(2," Delete "),o()()}if(r&2){let a=v();n(1),c("title",a.estateBlockFormGroup.invalid?"There must be errors on the form":"")}}function Ke(r,d){if(r&1){let a=_();t(0,"div",27)(1,"button",37),h("click",function(){B(a);let s=v();return E(s.updateBlock())}),l(2," Update block "),o()()}if(r&2){let a=v();n(1),c("title",a.estateBlockFormGroup.invalid?"There must be errors on the form":"")}}function Ye(r,d){if(r&1){let a=_();t(0,"div",27)(1,"button",37),h("click",function(){B(a);let s=v();return E(s.saveBlock())}),l(2," Create block "),o()()}if(r&2){let a=v();n(1),c("title",a.estateBlockFormGroup.invalid?"There must be errors on the form":"")}}var Y=r=>({"is-invalid":r}),ye=(()=>{let d=class d{constructor(i,s,e,k,I,H,K){this.title=i,this.addEstateBsModalRef=s,this.fb=e,this.accountService=k,this.alertService=I,this.logger=H,this.settingsService=K,this.submitted=!1,this.accountService.currentUser.subscribe(Ne=>this.currentUser=Ne)}ngOnInit(){this.createNewForm(),this.isAddMode?(this.estateHeaderMsg="New estate block",this.title.setTitle(this.estateHeaderMsg)):(this.estateHeaderMsg="Edit "+this.estateBlock.block+" block",this.title.setTitle(this.estateHeaderMsg),this.estateBlockFormGroup.patchValue(this.estateBlock)),this.addEstateBsModalRef.setClass("gray modal-sm modal-dialog-top"),this.fetchEstates()}createNewForm(){this.estateBlockFormGroup=this.fb.group({estateId:["",[F.required]],block:["",{updateOn:"blur",validators:[F.required,F.minLength(1)]}],blockSize:["",{updateOn:"blur",validators:[F.required,F.minLength(3)]}],remarks:["",""],recordId:[""],saveAndNew:[!1]})}get estateBlockForm(){return this.estateBlockFormGroup.controls}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:i=>{if(this.logger.info("getEstates response "+JSON.stringify(i)),i.headerResponse.responseCode!=="000"){this.alertService.error(i.headerResponse.responseMessage);return}if(i.estates.length<=0){this.alertService.showInfoMsgGeneral("No zones found"),this.logger.info("No zones found");return}this.listOfEstates=i.estates},error:i=>{this.logger.error(i),this.alertService.showInfoMsg(i)}})}saveBlock(){if(this.alertService.clear(),this.submitted=!0,!this.estateBlockFormGroup.valid)return;let i=this.estateBlockForm.block.value.toUpperCase();C.default.fire({title:"Confirmation",text:`Do you want to create block  ${i}?`,icon:"question",position:"top",showCancelButton:!0,confirmButtonText:"Yes, create",cancelButtonText:"No, cancel"}).then(s=>{if(s.value){if(this.alertService.clear(),this.estateBlockFormGroup.invalid)return;this.settingsService.createEstateBlock(this.currentUser,this.estateBlockFormGroup.value).subscribe({next:e=>{if(e.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(e.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(`${i} block created successfully`),this.estateBlockForm.saveAndNew.value||(this.addEstateBsModalRef.hide(),this.accountService.reloadCurrentRoute()),this.estateBlockFormGroup.reset(),this.submitted=!1,this.logAction(`created block ${i}`,G.SETTINGS)},error:e=>{this.alertService.showInfoMsg(e)}})}else s.dismiss,C.default.DismissReason.cancel})}updateBlock(){if(this.alertService.clear(),this.submitted=!0,!this.estateBlockFormGroup.valid)return;let i=this.estateBlockForm.block.value;C.default.fire({position:"top",title:"Confirmation",text:`Do you want to update block ${i}?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, update"}).then(s=>{if(s.value){if(this.alertService.clear(),this.estateBlockFormGroup.invalid)return;this.settingsService.updateEstateBlock(this.currentUser,this.estateBlockFormGroup.value).subscribe({next:e=>{if(this.logger.info("updateEstateBlock response:"+JSON.stringify(e)),e.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(e.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(`${i} block updated successfully`),this.addEstateBsModalRef.hide(),this.logAction(`Updated ${i}`,G.SETTINGS),localStorage.setItem("estate",this.estateBlockFormGroup.value.estateId),this.accountService.reloadCurrentRoute()},error:e=>{this.alertService.showInfoMsg(e.message)}})}else s.dismiss,C.default.DismissReason.cancel})}deleteBlock(){let i=this.estateBlock.block;C.default.fire({position:"top",title:"Confirmation",text:`Do you want to delete block ${i}?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, delete"}).then(s=>{if(s.value){if(this.alertService.clear(),this.estateBlockFormGroup.invalid)return;this.settingsService.deleteEstateBlock(this.currentUser,this.estateBlockForm.estateId.value).subscribe({next:e=>{if(this.logger.info("delete block response:"+JSON.stringify(e)),e.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(e.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(`${i} block deleted successfully`),this.addEstateBsModalRef.hide(),this.logAction(`Deleted ${i}`,G.SETTINGS),this.accountService.reloadCurrentRoute()},error:e=>{this.alertService.showInfoMsg(e.message)}})}else s.dismiss,C.default.DismissReason.cancel})}logAction(i,s){return Q(this,null,function*(){yield this.accountService.logUserAudit(i,s)})}};d.\u0275fac=function(s){return new(s||d)(p(ae),p(j),p(he),p(O),p(P),p(R),p(L))},d.\u0275cmp=x({type:d,selectors:[["ng-component"]],standalone:!0,features:[y],decls:56,vars:32,consts:[["novalidate","",3,"formGroup"],[1,"container"],["class","p-10",4,"ngIf"],[1,"modal-header"],[1,"modal-title"],["type","button btn-xs","aria-label","Close",1,"close","btn-close","pull-right","border","border-gray",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"row","gy-2","mt-3"],[1,"col-sm-12"],[1,"form-group"],[3,"labelForName","labelName"],[1,"form-control-wrap"],["id","estateid","formControlName","estateId",3,"clearable","ngClass"],["value","","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["class","text-danger",4,"ngIf"],["type","text","formControlName","block","id","block","autocomplete","off",1,"form-control","text-uppercase",3,"ngClass"],[4,"ngIf"],["labelName","Block Size",3,"labelForName"],[1,"form-text-hint"],[1,"overline-title"],["type","number","formControlName","blockSize","id","blockSize","autocomplete","off",1,"form-control",3,"ngClass"],[3,"labelForName","showRequired","labelName"],["type","remarks","formControlName","remarks","id","remarks",1,"form-control",2,"min-height","30px"],[1,"row","my-3","mx-2","mb-3","justify-content-end"],[1,"col-auto"],["data-bs-dismiss","modal",1,"btn","btn-outline-light","btn-sm",3,"click"],["class","col-auto",4,"ngIf"],[1,"p-10"],[3,"value"],[1,"text-danger"],[1,"custom-control","custom-control-sm","custom-checkbox","checked"],["type","checkbox","formControlName","saveAndNew","id","saveAndNew","id","saveAndNew",1,"custom-control-input"],["for","saveAndNew",1,"custom-control-label","fw-bolder"],[1,"btn","btn-outline-danger","btn-sm",3,"title","click"],[1,"btn","btn-primary","btn-sm",3,"title","click"]],template:function(s,e){s&1&&(t(0,"form",0)(1,"div",1),f(2,Pe,10,6,"div",2),o(),t(3,"div",3)(4,"h6",4),l(5),g(6,"titlecase"),o(),t(7,"button",5),h("click",function(){return e.addEstateBsModalRef==null?null:e.addEstateBsModalRef.hide()}),t(8,"span",6),l(9,"\xD7"),o()()(),t(10,"div",7),m(11,"app-required-fields-notice"),t(12,"div",8)(13,"div",9)(14,"div",10),m(15,"app-form-label",11),t(16,"div",12)(17,"ng-select",13)(18,"ng-option",14),l(19,"Select One"),o(),f(20,qe,2,2,"ng-option",15),o(),t(21,"span",16),f(22,je,2,0,"span",17),o()()()(),t(23,"div",9)(24,"div",10),m(25,"app-form-label",11),t(26,"div",12),m(27,"input",18),t(28,"span",16),f(29,Le,2,0,"div",19)(30,$e,2,0,"div",19),o()()()(),t(31,"div",9)(32,"div",10),m(33,"app-form-label",20),t(34,"div",12)(35,"div",21)(36,"span",22),l(37,"Acre(s)"),o()(),m(38,"input",23),t(39,"span",16),f(40,Ue,2,0,"div",19),o()()()(),t(41,"div",9)(42,"div",10),m(43,"app-form-label",24),t(44,"div",12)(45,"textarea",25),l(46,"                        "),o()()()(),t(47,"div",9),f(48,Je,5,0,"ng-container",19),o()()(),t(49,"div",26)(50,"div",27)(51,"button",28),h("click",function(){return e.addEstateBsModalRef==null?null:e.addEstateBsModalRef.hide()}),l(52," Close "),o()(),f(53,He,3,1,"div",29)(54,Ke,3,1,"div",29)(55,Ye,3,1,"div",29),o()()),s&2&&(c("formGroup",e.estateBlockFormGroup),n(2),c("ngIf",!1),n(3),b(S(6,24,e.estateHeaderMsg)),n(10),c("labelForName","estateId")("labelName","Estate"),n(2),c("clearable",!1)("ngClass",M(26,Y,((e.estateBlockForm.estateId==null?null:e.estateBlockForm.estateId.touched)||(e.estateBlockForm.estateId==null?null:e.estateBlockForm.estateId.dirty)||e.submitted)&&(e.estateBlockForm.estateId==null?null:e.estateBlockForm.estateId.errors))),n(3),c("ngForOf",e.listOfEstates),n(2),c("ngIf",e.estateBlockForm.estateId==null||e.estateBlockForm.estateId.errors==null?null:e.estateBlockForm.estateId.errors.required),n(3),c("labelForName","block")("labelName","Block"),n(2),c("ngClass",M(28,Y,((e.estateBlockForm.block==null?null:e.estateBlockForm.block.touched)||(e.estateBlockForm.block==null?null:e.estateBlockForm.block.dirty)||e.submitted)&&(e.estateBlockForm.block==null?null:e.estateBlockForm.block.errors))),n(2),c("ngIf",e.estateBlockForm.block==null||e.estateBlockForm.block.errors==null?null:e.estateBlockForm.block.errors.required),n(1),c("ngIf",e.estateBlockForm.block==null||e.estateBlockForm.block.errors==null?null:e.estateBlockForm.block.errors.minlength),n(3),c("labelForName","blockSize"),n(5),c("ngClass",M(30,Y,((e.estateBlockForm.blockSize==null?null:e.estateBlockForm.blockSize.touched)||(e.estateBlockForm.blockSize==null?null:e.estateBlockForm.blockSize.dirty)||e.submitted)&&(e.estateBlockForm.blockSize==null?null:e.estateBlockForm.blockSize.errors))),n(2),c("ngIf",e.estateBlockForm.blockSize==null||e.estateBlockForm.blockSize.errors==null?null:e.estateBlockForm.blockSize.errors.required),n(3),c("labelForName","remarks")("showRequired",!1)("labelName","Addition Information"),n(5),c("ngIf",e.isAddMode),n(5),c("ngIf",!e.isAddMode),n(1),c("ngIf",!e.isAddMode),n(1),c("ngIf",e.isAddMode))},dependencies:[A,te,w,T,re,oe,z,me,D,pe,se,V,ce,ve,ue,fe,J,U,$,Se,Ce,q,ke],encapsulation:2});let r=d;return r})();var Me=X(ge());function Xe(r,d){if(r&1&&(t(0,"ng-option",19),l(1),o()),r&2){let a=d.$implicit;c("value",a.recordId),n(1),u(" ",a.estateName," ")}}function Qe(r,d){if(r&1){let a=_();t(0,"div",20)(1,"div",21)(2,"div",22),m(3,"em",23),o(),t(4,"input",24),h("ngModelChange",function(s){B(a);let e=v();return E(e.searchedKeyword=s)}),o()()()}if(r&2){let a=v();n(4),c("ngModel",a.searchedKeyword)}}function We(r,d){r&1&&(t(0,"tr")(1,"th"),l(2,"SN"),o(),t(3,"th"),l(4,"Estate"),o(),t(5,"th"),l(6,"Block"),o(),t(7,"th"),l(8,"Block Size / Acres"),o(),t(9,"th"),l(10,"Properties"),o(),t(11,"th"),l(12,"Remarks"),o(),t(13,"th"),l(14,"Created By"),o(),t(15,"th"),l(16,"Last Last Modified By"),o(),t(17,"th"),l(18,"Actions"),o()())}function Ze(r,d){if(r&1){let a=_();t(0,"tr")(1,"td"),l(2),o(),t(3,"td"),l(4),o(),t(5,"td"),l(6),o(),t(7,"td"),l(8),t(9,"span",25),l(10),o()(),t(11,"td"),l(12),g(13,"number"),o(),t(14,"td"),l(15),o(),t(16,"td"),l(17),g(18,"lowercase"),t(19,"div",26)(20,"small",27),l(21),g(22,"date"),o(),t(23,"small",25),l(24),g(25,"timeAgo"),o()()(),t(26,"td"),l(27),g(28,"lowercase"),t(29,"div",26)(30,"small",27),l(31),g(32,"date"),o(),t(33,"small",25),l(34),g(35,"timeAgo"),o()()(),t(36,"td")(37,"div",28),h("click",function(){let e=B(a).$implicit,k=v();return E(k.openEstateModalComponent(e,!1))}),t(38,"div",29)(39,"span"),m(40,"em",30),o()()()()()}if(r&2){let a=d.$implicit,i=d.rowIndex;n(2),b(i+1),n(2),b(a==null?null:a.estateName),n(2),b(a.block),n(2),u("",a.blockSize," "),n(2),u("(",a==null?null:a.blockSizeLeft," left)"),n(2),b(S(13,13,a.properties)),n(3),b(a.remarks),n(2),u(" ",S(18,15,a.createdBy)," "),n(4),b(N(22,17,a.createdDate,"medium")),n(3),u(" ",S(25,20,a.createdDate),""),n(3),u(" ",S(28,22,a.lastModifiedBy)," "),n(4),b(N(32,24,a.lastModifiedDate,"medium")),n(3),b(S(35,27,a.lastModifiedDate))}}var et=()=>[5,10,25,50],xt=(()=>{let d=class d{constructor(i,s,e,k,I,H){this.addEstateBlockBsModalRef=i,this.addEstateModalService=s,this.accountService=e,this.settingsService=k,this.alertService=I,this.logger=H,this.estate="A",this.accountService.currentUser.subscribe(K=>this.currentUser=K)}ngOnInit(){this.estate=localStorage.getItem("estate")??"A",this.fetchEstates(),this.estate!=="A"&&this.fetchEstateBlocks()}ngOnDestroy(){this.addEstateModalService.hide(),Me.default.close()}refreshButton(){this.fetchEstateBlocks()}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:i=>{if(this.logger.info("getEstates response "+JSON.stringify(i)),i.headerResponse.responseCode!=="000"){this.alertService.error(i.headerResponse.responseMessage);return}if(i.estates.length<=0){this.alertService.showInfoMsgGeneral("No estates found"),this.logger.info("No estates found");return}this.listOfEstates=i.estates},error:i=>{this.logger.error(i),this.alertService.showInfoMsg(i)}})}fetchEstateBlocks(){this.listOfEstateBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.estate).subscribe({next:i=>{if(this.logger.info("getEstates response "+JSON.stringify(i)),i.headerResponse.responseCode!=="000"){this.alertService.error(i.headerResponse.responseMessage);return}if(i.estateBlocks.length<=0){this.alertService.showInfoMsgGeneral("No blocks found"),this.logger.info("No blocks found ");return}this.listOfEstateBlocks=i.estateBlocks},error:i=>{this.logger.error(i),this.alertService.showInfoMsg(i)}})}openEstateModalComponent(i,s){let e={initialState:{isAddMode:s,estateBlock:i}};this.addEstateModalService.config.ignoreBackdropClick=!0,this.addEstateModalService.config.animated=!0,this.addEstateBlockBsModalRef=this.addEstateModalService.show(ye,e),this.addEstateBlockBsModalRef.content.closeBtnName="Close"}};d.\u0275fac=function(s){return new(s||d)(p(j),p(Fe),p(O),p(L),p(P),p(R))},d.\u0275cmp=x({type:d,selectors:[["app-estate-blocks"]],standalone:!0,features:[y],decls:24,vars:19,consts:[[3,"pageTitleName","description"],[1,"newItemName"],[1,"btn","btn-primary",3,"click"],[1,"icon","ni","ni-plus"],[1,"row","gy-2","gx-3","mb-4","align-items-center"],[1,"col-sm-3"],[1,"form-group"],[3,"labelForName","labelName"],[1,"form-control-wrap"],["id","region",3,"clearable","ngModel","ngModelChange","change"],["value","A","disabled","","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-2",4,"ngIf"],[1,"col-auto"],["type","button","title","",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],[3,"value"],[1,"col-sm-2"],[1,"form-control-wrap","mt-4"],[1,"form-icon","form-icon-right"],[1,"icon","ni","ni-search"],["type","text","id","default-04","placeholder"," Search blocks here",1,"form-control",3,"ngModel","ngModelChange"],[1,"text-primary"],[1,"fw-lighter"],[1,"d-block"],[1,"align-center","select-cursor",3,"click"],[1,"user-avatar","user-avatar-sm","bg-light"],[1,"icon","ni","ni-edit"]],template:function(s,e){s&1&&(t(0,"app-add-item",0)(1,"span",1)(2,"a",2),h("click",function(){return e.openEstateModalComponent(null,!0)}),m(3,"em",3),t(4,"span"),l(5,"Add estate block"),o()()()(),t(6,"div",4)(7,"div",5)(8,"div",6),m(9,"app-form-label",7),t(10,"div",8)(11,"ng-select",9),h("ngModelChange",function(I){return e.estate=I})("change",function(){return e.fetchEstateBlocks()}),t(12,"ng-option",10),l(13,"Select Estate"),o(),f(14,Xe,2,2,"ng-option",11),o()()()(),f(15,Qe,5,1,"div",12),t(16,"div",13)(17,"button",14),h("click",function(){return e.refreshButton()}),l(18," Refresh "),o()()(),t(19,"p-table",15,16),g(21,"filter"),f(22,We,19,0,"ng-template",17)(23,Ze,41,29,"ng-template",18),o()),s&2&&(c("pageTitleName","Estate blocks")("description","Setup state housing estate blocks"),n(9),c("labelForName","estate")("labelName","Estates"),n(2),c("clearable",!1)("ngModel",e.estate),n(3),c("ngForOf",e.listOfEstates),n(1),c("ngIf",e.estate),n(4),c("value",N(21,15,e.listOfEstateBlocks,e.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",ee(18,et))("resizableColumns",!0)("autoLayout",!0))},dependencies:[A,w,T,ie,le,ne,Ee,Be,be,z,D,V,de,J,U,$,_e,Ie,xe,q],encapsulation:2});let r=d;return r})();export{xt as EstateBlocksComponent};
