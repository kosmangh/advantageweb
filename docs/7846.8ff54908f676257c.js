"use strict";(self.webpackChunkadvantageweb=self.webpackChunkadvantageweb||[]).push([[7846],{7846:(X,h,a)=>{a.r(h),a.d(h,{OccupantPropertyComponent:()=>$});var f=a(5861),e=a(5879),p=a(6814),_=a(995),v=a(4981),Z=a(7177),O=a(6763),y=a(7467),C=a(3519),d=a.n(C),M=a(1456),l=a(95),x=a(1392),m=a(2458),T=a(5176),P=a(2735),A=a(8624),N=a(1449),g=a(4740),U=a(9082);class S{}var B=a(5858),b=a(8352),w=a(2187),J=a(4874),E=a(3285),k=a(7236),u=a(6842),I=a(9972);function L(r,s){if(1&r){const n=e.EpF();e.TgZ(0,"div",5)(1,"div",8)(2,"label",32),e._uU(3),e.qZA(),e._UZ(4,"br"),e.TgZ(5,"input",33),e.NdJ("ngModelChange",function(o){e.CHM(n);const c=e.oxw(2);return e.KtG(c.searchValue=o)}),e.qZA()()()}if(2&r){const n=e.oxw(2);e.xp6(3),e.Oqu(n.searchParameterLabel),e.xp6(2),e.MGl("placeholder","Enter ",n.searchParameterLabel,""),e.Q6J("ngModel",n.searchValue)}}function q(r,s){if(1&r){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",5)(2,"div",6)(3,"label",26),e._uU(4,"Search By"),e.qZA(),e._UZ(5,"br"),e.TgZ(6,"div",8)(7,"div",9)(8,"select",27),e.NdJ("ngModelChange",function(o){e.CHM(n);const c=e.oxw();return e.KtG(c.searchParameter=o)})("change",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.searchParameterListener())}),e.TgZ(9,"option",28),e._uU(10,"Name"),e.qZA(),e.TgZ(11,"option",29),e._uU(12,"Mobile No."),e.qZA(),e.TgZ(13,"option",30),e._uU(14,"Email"),e.qZA()()()()()(),e.YNc(15,L,6,3,"div",31),e.BQk()}if(2&r){const n=e.oxw();e.xp6(8),e.Q6J("ngModel",n.searchParameter),e.xp6(7),e.Q6J("ngIf",n.searchParameter)}}function R(r,s){if(1&r&&(e.TgZ(0,"ng-option",40),e._uU(1),e.qZA()),2&r){const n=s.$implicit;e.Q6J("value",n.recordId),e.xp6(1),e.hij(" ",n.estateName," ")}}function D(r,s){if(1&r&&(e.TgZ(0,"ng-option",40),e._uU(1),e.qZA()),2&r){const n=s.$implicit;e.Q6J("value",n.recordId),e.xp6(1),e.hij(" ",n.block," ")}}function Q(r,s){if(1&r){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",34)(2,"div",6),e._UZ(3,"app-form-label",35),e.TgZ(4,"div",8)(5,"ng-select",36),e.NdJ("ngModelChange",function(o){e.CHM(n);const c=e.oxw();return e.KtG(c.estate=o)})("change",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.fetchEstateBlocks())}),e.TgZ(6,"ng-option",37),e._uU(7,"Select Estate"),e.qZA(),e.YNc(8,R,2,2,"ng-option",38),e.qZA()()()(),e.TgZ(9,"div",5)(10,"div",6),e._UZ(11,"app-form-label",35),e.TgZ(12,"div",8)(13,"ng-select",39),e.NdJ("ngModelChange",function(o){e.CHM(n);const c=e.oxw();return e.KtG(c.block=o)})("change",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.fetchOccupantProperties())}),e.TgZ(14,"ng-option",37),e._uU(15,"Select Block"),e.qZA(),e.YNc(16,D,2,2,"ng-option",38),e.qZA()()()(),e.BQk()}if(2&r){const n=e.oxw();e.xp6(3),e.Q6J("labelForName","estate")("labelName","Estates"),e.xp6(2),e.Q6J("clearable",!1)("ngModel",n.estate),e.xp6(3),e.Q6J("ngForOf",n.listOfEstates),e.xp6(3),e.Q6J("labelForName","block")("labelName","Blocks"),e.xp6(2),e.Q6J("clearable",!1)("ngModel",n.block),e.xp6(3),e.Q6J("ngForOf",n.listOfEstateBlocks)}}function F(r,s){if(1&r){const n=e.EpF();e.TgZ(0,"div",14)(1,"a",41),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.export())}),e._UZ(2,"em",42),e.TgZ(3,"span"),e._uU(4,"Export"),e.qZA()()()}}function Y(r,s){if(1&r){const n=e.EpF();e.TgZ(0,"div",14)(1,"div",43)(2,"a",44),e._UZ(3,"em",42),e.TgZ(4,"span"),e._uU(5,"Export"),e.qZA()(),e.TgZ(6,"div",45)(7,"ul",46)(8,"li")(9,"a",47),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.export())}),e._UZ(10,"em",48),e.TgZ(11,"span"),e._uU(12,"Excel"),e.qZA()()(),e.TgZ(13,"li")(14,"a",49),e._UZ(15,"em",50),e.TgZ(16,"span"),e._uU(17,"PDF"),e.qZA()()()()()()()}}function G(r,s){1&r&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"SN"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Occupant"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Property"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Usage"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Block"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Occupation Period"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Duration Left"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Occupation Status"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Actions"),e.qZA()())}function K(r,s){if(1&r){const n=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"app-full-name",51),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"app-full-name",51),e.ALo(7,"titlecase"),e.qZA(),e.TgZ(8,"td",52),e._uU(9),e.ALo(10,"removeHyphen"),e.ALo(11,"titlecase"),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td"),e._uU(15),e.ALo(16,"date"),e.ALo(17,"cleanDate"),e.ALo(18,"date"),e.ALo(19,"cleanDate"),e.qZA(),e.TgZ(20,"td"),e._uU(21),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.qZA(),e.TgZ(24,"td")(25,"div",53)(26,"a",54),e._UZ(27,"em",55),e.qZA(),e.TgZ(28,"div",56)(29,"ul",46)(30,"li")(31,"a",47),e.NdJ("click",function(){const c=e.CHM(n).$implicit,i=e.oxw();return e.KtG(i.openOccupantPropertyModalComponent(c,!1))}),e._UZ(32,"em",57),e.TgZ(33,"span"),e._uU(34,"Edit occupancy"),e.qZA()()(),e.TgZ(35,"li")(36,"a",47),e.NdJ("click",function(){const c=e.CHM(n).$implicit,i=e.oxw();return e.KtG(i.openViewOccupantModalComponent(c))}),e._UZ(37,"em",58),e.TgZ(38,"span"),e._uU(39,"View occupancy"),e.qZA()()(),e._UZ(40,"li",59),e.TgZ(41,"li")(42,"a",60),e.NdJ("click",function(){const c=e.CHM(n).$implicit,i=e.oxw();return e.KtG(i.deleteOccupant(c))}),e._UZ(43,"em",61),e.TgZ(44,"span"),e._uU(45,"Delete"),e.qZA()()()()()()()()}if(2&r){const n=s.$implicit,t=s.rowIndex;e.xp6(2),e.Oqu(t+1),e.xp6(2),e.s9C("fullName",null==n?null:n.occupantName),e.s9C("otherFieldName",null==n?null:n.institutionalDisplayName),e.Q6J("showAvatar",!0),e.xp6(2),e.s9C("fullName",null==n?null:n.propertyName),e.hYB("otherFieldName","",e.lcZ(7,14,null==n?null:n.occupationType)," (",null==n?null:n.propertyNo,")"),e.Q6J("showAvatar",!1),e.xp6(3),e.Oqu(e.lcZ(10,16,e.lcZ(11,18,null==n?null:n.propertyUsage))),e.xp6(4),e.Oqu(n.blockName),e.xp6(2),e.AsE(" ",e.xi3(16,20,e.lcZ(17,23,null==n?null:n.firstDateOfOccupancy),"mediumDate")," -- ",e.xi3(18,25,e.lcZ(19,28,null==n?null:n.lastDateOfOccupancy),"mediumDate")," "),e.xp6(6),e.Oqu(n.durationLeft),e.xp6(2),e.Oqu(n.validity)}}const H=function(){return[5,10,25,50]};let $=(()=>{var r;class s{constructor(t,o,c,i,V,z){this.logger=t,this.addOccupantPropertyBsModalRef=o,this.addInstitutionOccupantBsModalRef=c,this.viewOccupantPropertyBsModalRef=i,this.addOccupantPropertyModalService=V,this.institutionOccupantModalService=z,this.searchParameter="NAM",this.showOccupantSearchBy=!0,this.settingsService=(0,e.f3M)(N.g),this.excelExporterService=(0,e.f3M)(b.h),this.accountService=(0,e.f3M)(Z.e),this.alertService=(0,e.f3M)(v.c),this.utilsService=(0,e.f3M)(y.F),this.occupantsService=(0,e.f3M)(O.k),this.accountService.currentUser.subscribe(j=>this.currentUser=j)}ngOnInit(){this.searchBy="OCC",this.startDate=this.utilsService.getFirstDayDate(),this.endDate=new Date,this.searchParameterListener()}ngOnDestroy(){this.addOccupantPropertyModalService.hide(),d().close()}searchByListener(){"BAB"==this.searchBy&&(this.estate="A",this.block="A",this.fetchEstates(),this.listOfEstateBlocks=[]),this.listOfOccupantProperties=[]}searchParameterListener(){"MOB"!=this.searchParameter?"NAM"!=this.searchParameter?"EMAIL"!=this.searchParameter||(this.searchParameterLabel="Email Address"):this.searchParameterLabel="Occupant Name":this.searchParameterLabel="Mobile Number"}fetchOccupantProperties(){this.listOfOccupantProperties=[];const t=new S;t.block="",t.searchBy=this.searchBy,t.searchParameter=this.searchParameter,t.searchValue=this.searchValue,"BAB"==this.searchBy&&(t.searchValue="",t.block=this.block,t.searchParameter="",t.searchValue=""),this.occupantsService.searchOccupantProperties(this.currentUser,t).subscribe({next:o=>{if(this.logger.info("searchOccupants response "+JSON.stringify(o)),"000"===o.headerResponse.responseCode)return o.occupantProperties.length<=0?(this.alertService.showInfoMsgGeneral("No occupant properties found"),void this.logger.info("No occupant properties found")):void(this.listOfOccupantProperties=o.occupantProperties);this.alertService.error(o.headerResponse.responseMessage)},error:o=>{this.logger.error(o),this.alertService.showInfoMsg(o)}})}export(){this.excelExporterService.exportAsExcelFile(this.listOfOccupantProperties,"occupantProperties")}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:t=>{if(this.logger.info("getEstates response "+JSON.stringify(t)),"000"===t.headerResponse.responseCode)return t.estates.length<=0?(this.alertService.showInfoMsgGeneral("No zones found"),void this.logger.info("No zones found")):void(this.listOfEstates=t.estates);this.alertService.error(t.headerResponse.responseMessage)},error:t=>{this.logger.error(t),this.alertService.showInfoMsg(t)}})}fetchEstateBlocks(){this.listOfEstateBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.estate).subscribe({next:t=>{if(this.logger.info("getEstates response "+JSON.stringify(t)),"000"===t.headerResponse.responseCode)return t.estateBlocks.length<=0?(this.alertService.showInfoMsgGeneral("No blocks found"),void this.logger.info("No blocks found ")):void(this.listOfEstateBlocks=t.estateBlocks);this.alertService.error(t.headerResponse.responseMessage)},error:t=>{this.logger.error(t.message),this.alertService.showInfoMsg(t.message)}})}deleteOccupant(t){let o=t.occupantName;d().fire({position:"top",title:"Confirmation",text:`Do you want to delete ${o}?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, delete"}).then(c=>{c.value?this.occupantsService.deleteOccupantProperty(this.currentUser,t.recordId).subscribe({next:i=>{this.logger.info("deleteOccupant response:"+JSON.stringify(i)),"000"===i.headerResponse.responseCode?(this.alertService.showSuccessMsg(`${o} deleted successfully`),this.addInstitutionOccupantBsModalRef.hide(),this.logAction(`Updated ${o}`,_.h.OCCUPANCY),this.accountService.reloadCurrentRoute()):this.alertService.showErrorMsg(i.headerResponse.responseMessage)},error:i=>{this.alertService.showInfoMsg(i.message)}}):d()})}openOccupantPropertyModalComponent(t,o){const c={initialState:{isAddMode:o,occupantProperty:t}};this.addOccupantPropertyModalService.config.ignoreBackdropClick=!0,this.addOccupantPropertyModalService.config.animated=!0,this.addOccupantPropertyBsModalRef=this.addOccupantPropertyModalService.show(U.f,c),this.addOccupantPropertyBsModalRef.content.closeBtnName="Close"}openInstitutionModalComponent(t,o){const c={initialState:{isAddMode:o,occupant:t}};this.institutionOccupantModalService.config.ignoreBackdropClick=!0,this.institutionOccupantModalService.config.animated=!0,this.addInstitutionOccupantBsModalRef=this.institutionOccupantModalService.show(M.m,c),this.addInstitutionOccupantBsModalRef.content.closeBtnName="Close"}openViewOccupantModalComponent(t){const o={initialState:{occupantProperty:t}};this.institutionOccupantModalService.config.ignoreBackdropClick=!0,this.institutionOccupantModalService.config.animated=!0,this.viewOccupantPropertyBsModalRef=this.institutionOccupantModalService.show(B.s,o),this.viewOccupantPropertyBsModalRef.content.closeBtnName="Close"}logAction(t,o){var c=this;return(0,f.Z)(function*(){yield c.accountService.logUserAudit(t,o)})()}}return(r=s).\u0275fac=function(t){return new(t||r)(e.Y36(k.Kf),e.Y36(u.UZ),e.Y36(u.UZ),e.Y36(u.UZ),e.Y36(u.tT),e.Y36(u.tT))},r.\u0275cmp=e.Xpm({type:r,selectors:[["ng-component"]],standalone:!0,features:[e.jDz],decls:37,vars:19,consts:[[3,"pageTitleName","description"],[1,"newItemName"],[1,"btn","btn-primary",3,"click"],[1,"icon","ni","ni-plus"],[1,"row","gy-2","gx-2","mt-5","mb-4","align-items-center"],[1,"col-sm-2"],[1,"form-group"],["for","startsearchByDate",1,"form-label","pt-0"],[1,"form-control-wrap"],[1,"form-control-select"],["id","searchBy",1,"form-control",3,"ngModel","ngModelChange","change"],["value","OCC","selected","",1,"fs-6"],["value","BAB"],[4,"ngIf"],[1,"col-auto"],["type","button","title","",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],["class","col-auto",4,"ngIf"],["class","col-auto ",4,"ngIf"],[1,"row","gy-2","gx-3","my-3"],[1,"form-icon","form-icon-right"],[1,"icon","ni","ni-search"],["type","text","autocomplete","off","id","default-04","placeholder","Quick search",1,"form-control",3,"ngModel","ngModelChange"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],["for","searchParameter",1,"form-label","pt-0"],["id","searchParameter",1,"form-control",3,"ngModel","ngModelChange","change"],["value","NAM"],["value","MOB"],["value","EMAIL"],["class","col-sm-2",4,"ngIf"],["for","startDate",1,"form-label","pt-0"],["type","text","autocomplete","off","id","default-04",1,"form-control",3,"placeholder","ngModel","ngModelChange"],[1,"col-sm-3"],[3,"labelForName","labelName"],["id","estate",3,"clearable","ngModel","ngModelChange","change"],["value","A","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],["id","block",3,"clearable","ngModel","ngModelChange","change"],[3,"value"],[1,"btn","mt-4","btn-outline-light",3,"click"],[1,"icon","ni","ni-download"],[1,"dropdown","mt-4"],["href","#","data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-outline-light"],[1,"dropdown-menu"],[1,"link-list-opt","no-bdr"],[3,"click"],[1,"icon","ni","ni-file-xls","text-primary"],[2,"cursor","not-allowed"],[1,"icon","ni","ni-file-pdf"],[3,"showAvatar","fullName","otherFieldName"],[1,"text-capitalize"],[1,"drodown"],["data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-icon","btn-light"],[1,"icon","ni","ni-more-h"],[1,"dropdown-menu","dropdown-menu-end"],[1,"icon","ni","ni-edit"],[1,"icon","ni","ni-eye"],[1,"divider"],[1,"text-danger",3,"click"],[1,"icon","ni","ni-trash"]],template:function(t,o){1&t&&(e.TgZ(0,"app-add-item",0)(1,"span",1)(2,"a",2),e.NdJ("click",function(){return o.openOccupantPropertyModalComponent(null,!0)}),e._UZ(3,"em",3),e.TgZ(4,"span"),e._uU(5,"Add occupant property"),e.qZA()()()(),e.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),e._uU(10,"Search Parameter"),e.qZA(),e._UZ(11,"br"),e.TgZ(12,"div",8)(13,"div",9)(14,"select",10),e.NdJ("ngModelChange",function(i){return o.searchBy=i})("change",function(){return o.searchByListener()}),e.TgZ(15,"option",11),e._uU(16,"Occupant"),e.qZA(),e.TgZ(17,"option",12),e._uU(18,"Estate & block"),e.qZA()()()()()(),e.YNc(19,q,16,2,"ng-container",13),e.YNc(20,Q,17,10,"ng-container",13),e.TgZ(21,"div",14)(22,"button",15),e.NdJ("click",function(){return o.fetchOccupantProperties()}),e._uU(23," Search "),e.qZA()(),e.YNc(24,F,5,0,"div",16),e.YNc(25,Y,18,0,"div",17),e.qZA(),e.TgZ(26,"div",18)(27,"div",14)(28,"div",8)(29,"div",19),e._UZ(30,"em",20),e.qZA(),e.TgZ(31,"input",21),e.NdJ("ngModelChange",function(i){return o.searchedKeyword=i}),e.qZA()()()(),e.TgZ(32,"p-table",22,23),e.ALo(34,"filter"),e.YNc(35,G,19,0,"ng-template",24),e.YNc(36,K,46,30,"ng-template",25),e.qZA()),2&t&&(e.Q6J("pageTitleName","Occupants")("description","Defines the contract between occupant, properties and estate company"),e.xp6(14),e.Q6J("ngModel",o.searchBy),e.xp6(5),e.Q6J("ngIf","OCC"==o.searchBy),e.xp6(1),e.Q6J("ngIf","BAB"==o.searchBy),e.xp6(4),e.Q6J("ngIf",!1),e.xp6(1),e.Q6J("ngIf",(null==o.listOfOccupantProperties?null:o.listOfOccupantProperties.length)>0),e.xp6(6),e.Q6J("ngModel",o.searchedKeyword),e.xp6(1),e.Q6J("value",e.xi3(34,15,o.listOfOccupantProperties,o.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",e.DdM(18,H))("resizableColumns",!0)("autoLayout",!0))},dependencies:[p.ez,p.sg,p.O5,p.rS,p.uU,P.h,g.A0,g.w9,g.jq,l.u5,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.On,x._8,I.jx,T.L,m.U$,m.iA,A.$,w.c,J.i,E.F],encapsulation:2}),s})()}}]);