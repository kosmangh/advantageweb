import{a as ye,b as he}from"./chunk-TPNH6JTS.js";import"./chunk-J3GFM727.js";import{a as ve}from"./chunk-BUO42Q2K.js";import{a as fe}from"./chunk-NXAZBSFM.js";import{a as me,b as ce}from"./chunk-MKJDMB7D.js";import{a as ge}from"./chunk-LD7XCFFA.js";import{a as ue}from"./chunk-FMEHXA2G.js";import{a as B}from"./chunk-IP4FBAZW.js";import{b as re,c as ae,d as de,e as N}from"./chunk-7PQCCLGB.js";import{d as se}from"./chunk-WH3N5QDN.js";import{i as te,r as ie,s as ne,t as oe}from"./chunk-KPCRGR73.js";import{h as le,i as pe}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import{c as z,f as K,k as X,v as Q,x as Y}from"./chunk-B2QESFZG.js";import{a as ee}from"./chunk-Y725X6Z7.js";import{c as W}from"./chunk-R55IMLXW.js";import{a as Z}from"./chunk-LPKVFVKE.js";import{b as $,f as J,g as M}from"./chunk-IHPVOZWG.js";import"./chunk-7DWKZ4XI.js";import{Ab as F,Eb as t,Fb as m,Gb as h,Hb as E,Kc as q,Lc as G,Mb as L,Nb as H,Qc as O,Rc as D,Sa as r,Ta as x,Tc as w,Uc as I,Wb as p,Xb as g,Yb as f,bb as v,gb as A,ib as P,ja as S,jb as V,la as C,nb as e,ob as i,pb as u,qa as T,qb as U,ra as k,rb as j,tb as R,wb as y,xb as _}from"./chunk-QRSQYA3Q.js";import"./chunk-5FZOKLP6.js";var Se=(()=>{let d=class d{constructor(l,a){this.bsModalRef=l,this.accountService=a,this.accountService.currentUser.subscribe(n=>this.currentUser=n)}ngOnInit(){this.bsModalRef.setClass("gray modal-md modal-dialog-top")}};d.\u0275fac=function(a){return new(a||d)(x(le),x(M))},d.\u0275cmp=C({type:d,selectors:[["app-property-ledger-details"]],standalone:!0,features:[L],decls:114,vars:38,consts:[[1,"modal-header"],[1,"modal-title"],["type","button btn-xs","aria-label","Close",1,"close","btn-close","pull-right","border","border-gray",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"card","card-no-border"],[1,"pricing-body"],[1,"pricing-features"],[1,"preview-title-lg","overline-title"],[1,"w-40"],[1,"ms-auto","fw-bolder"],[1,"preview-title-lg","overline-title","mt-3"],[1,"row","my-3","mx-2","mb-3","justify-content-end"],[1,"col-auto"],[1,"btn","btn-sm","btn-primary",3,"click"]],template:function(a,n){a&1&&(e(0,"div",0)(1,"h6",1),t(2),i(),e(3,"button",2),y("click",function(){return n.bsModalRef==null?null:n.bsModalRef.hide()}),e(4,"span",3),t(5,"\xD7"),i()()(),e(6,"div",4)(7,"div",5)(8,"div",6)(9,"ul",7)(10,"span",8),t(11,"Occupancy Details"),i(),e(12,"li")(13,"span",9),t(14,"Occupant"),i(),t(15," - "),e(16,"span",10),t(17),i()(),e(18,"li")(19,"span",9),t(20,"Occupant Type"),i(),t(21," - "),e(22,"span",10),t(23),i()(),e(24,"li")(25,"span",9),t(26,"Property No."),i(),t(27," - "),e(28,"span",10),t(29),i()(),e(30,"li")(31,"span",9),t(32,"Property Name"),i(),t(33," - "),e(34,"span",10),t(35),i()(),e(36,"li")(37,"span",9),t(38,"Property Usage"),i(),t(39," - "),e(40,"span",10),t(41),p(42,"titlecase"),p(43,"removeHyphen"),i()(),e(44,"span",11),t(45,"Ledger Details"),i(),e(46,"li")(47,"span",9),t(48,"Amount Paid"),i(),t(49," - "),e(50,"span",10),t(51),p(52,"number"),i()(),e(53,"li")(54,"span",9),t(55,"Medium Of Payment"),i(),t(56," - "),e(57,"span",10),t(58),p(59,"titlecase"),p(60,"removeHyphen"),i()(),e(61,"li")(62,"span",9),t(63,"Payment Ref. No. "),i(),t(64," - "),e(65,"span",10),t(66),i()(),e(67,"li")(68,"span",9),t(69,"Receipt Number Issued"),i(),t(70," - "),e(71,"span",10),t(72),i()(),e(73,"li")(74,"span",9),t(75,"Narration"),i(),t(76," - "),e(77,"span",10),t(78),i()(),e(79,"li")(80,"span",9),t(81,"Payment Date"),i(),t(82," - "),e(83,"span",10)(84,"span"),t(85),p(86,"date"),p(87,"timeAgo"),i()()(),e(88,"li")(89,"span",9),t(90,"Recorded By"),i(),t(91," - "),e(92,"span",10),t(93),i()(),e(94,"li")(95,"span",9),t(96,"Last modified Date"),i(),t(97," - "),e(98,"span",10)(99,"span"),t(100),p(101,"date"),p(102,"timeAgo"),i()()(),e(103,"li")(104,"span",9),t(105,"Last Modified By"),i(),t(106," - "),e(107,"span",10),t(108),i()()()()()(),e(109,"div",12)(110,"div",13)(111,"a",14),y("click",function(){return n.bsModalRef==null?null:n.bsModalRef.hide()}),e(112,"span"),t(113,"Close"),i()()()()),a&2&&(r(2),h("",n.propertyLedger==null?null:n.propertyLedger.occupantName," payment details"),r(15),m(n.propertyLedger==null?null:n.propertyLedger.occupantName),r(6),m(n.propertyLedger==null?null:n.propertyLedger.institutionalDisplayName),r(6),m(n.propertyLedger==null?null:n.propertyLedger.propertyNo),r(6),m(n.propertyLedger==null?null:n.propertyLedger.propertyName),r(6),m(g(42,17,g(43,19,n.propertyLedger==null?null:n.propertyLedger.propertyUsage))),r(10),m(f(52,21,n.propertyLedger==null?null:n.propertyLedger.amountPaid,"1.2-2")),r(7),h(" ",g(59,24,g(60,26,n.propertyLedger==null?null:n.propertyLedger.mediumOfPayment))," "),r(8),h(" ",n.propertyLedger==null?null:n.propertyLedger.mediumOfPaymentNumber," "),r(6),h(" ",n.propertyLedger==null?null:n.propertyLedger.receiptNumberIssued," "),r(6),m(n.propertyLedger==null?null:n.propertyLedger.paymentFor),r(7),E("",f(86,28,n.propertyLedger==null?null:n.propertyLedger.dateOfRecordEntry,"medium")," ",g(87,31,n.propertyLedger==null?null:n.propertyLedger.dateOfRecordEntry.toString()),""),r(8),m(n.propertyLedger==null?null:n.propertyLedger.createdBy),r(7),E("",f(101,33,n.propertyLedger==null?null:n.propertyLedger.lastModifiedDate,"medium")," ",g(102,36,n.propertyLedger==null?null:n.propertyLedger.lastModifiedDate.toString()),""),r(8),m(n.propertyLedger==null?null:n.propertyLedger.lastModifiedBy))},dependencies:[I,w,O,D,N,B],encapsulation:2});let s=d;return s})();function Ee(s,d){if(s&1){let o=R();e(0,"li")(1,"div",46),y("click",function(){let n=T(o).$implicit,c=_(2);return k(c.selectOccupant(n))}),u(2,"input",47),e(3,"label",48)(4,"span",49)(5,"span"),p(6,"avatarBg"),e(7,"span"),t(8),p(9,"avatarName"),i()(),e(10,"span",50)(11,"span",51),t(12),i(),e(13,"span",52),t(14),i(),e(15,"span",52),t(16),i(),e(17,"span",52),t(18),i()()()()()()}if(s&2){let o=d.$implicit;r(2),F("id",o.recordId),r(1),F("for",o.recordId),r(2),A("user-avatar ",g(6,11,""),""),r(3),m(g(9,13,o.occupantName)),r(4),m(o.occupantName),r(2),m(o.mobileNo),r(2),E("",o.propertyName," (",o.propertyId,") "),r(2),m(o.occupationType)}}function Ce(s,d){if(s&1&&(e(0,"ul",44),P(1,Ee,19,15,"li",45),i()),s&2){let o=_();r(1),v("ngForOf",o.listOfOccupantProperties)}}function Pe(s,d){if(s&1&&u(0,"app-occupant-property-details",53),s&2){let o=_();v("occupantDetails",o.selectedOccupant)}}function Le(s,d){s&1&&(e(0,"tr")(1,"th",54),t(2,"Amount"),i(),e(3,"th"),t(4,"Debit/Credit"),i(),e(5,"th"),t(6,"Narration"),i(),e(7,"th"),t(8,"Bill Date"),i(),e(9,"th"),t(10,"Actions"),i()())}function Oe(s,d){if(s&1){let o=R();e(0,"tr")(1,"td",54),t(2),p(3,"number"),i(),e(4,"td")(5,"span"),t(6),p(7,"titlecase"),p(8,"removeHyphen"),i()(),e(9,"td"),t(10),i(),e(11,"td"),t(12),e(13,"div",55)(14,"small",56),t(15),p(16,"date"),i(),e(17,"small"),t(18),p(19,"timeAgo"),i()()(),e(20,"td")(21,"div",57)(22,"div",58),y("click",function(){let n=T(o).$implicit,c=_();return k(c.openViewLedgerComponent(n))}),e(23,"span"),u(24,"em",59),i()()()()()}if(s&2){let o=d.$implicit;r(2),m(f(3,6,o==null?null:o.amountPaid,".2-2")),r(4),h(" ",g(7,9,g(8,11,o==null?null:o.debitCreditEntry))," "),r(4),m(o==null?null:o.paymentFor),r(2),h(" ",o==null?null:o.createdBy," "),r(3),m(f(16,13,o==null?null:o.createdDate,"dd/MM/yyyy HH:mm a")),r(3),h(" ",g(19,16,o==null?null:o.createdDate),"")}}var De=()=>[5,10,25,50],yt=(()=>{let d=class d{searchOccupantPayments(){throw new Error("Method not implemented.")}constructor(l,a,n){this.billPaymentService=l,this.modalService=a,this.logger=n,this.excelExporterService=S(ge),this.settingsService=S(se),this.accountService=S(M),this.alertService=S(W),this.utilsService=S(J),this.occupantsService=S(ue),this.accountService.currentUser.subscribe(c=>this.currentUser=c)}ngOnDestroy(){this.modalService.hide()}ngOnInit(){this.startDate=this.utilsService.getFirstDayDate(),this.endDate=new Date,this.selectedOccupant=JSON.parse(localStorage.getItem("selectedOccupant"))??null,this.selectedOccupant&&this.searchAllOccupantBills(),this.showOccupantDetails=!0,this.showNoRecordsFound=!1}searchOccupant(){this.selectedOccupant=new ye,this.showOccupantDetails=!1,this.showNoRecordsFound=!1,this.listOfOccupantProperties=[],this.listOfPropertyLedgers=[],this.occupantsService.quickSearchOccupantProperties(this.currentUser,this.searchTerm.trim(),"ALL").subscribe({next:l=>{if(this.logger.info("quickSearchOccupantProperties response "+JSON.stringify(l)),l.headerResponse.responseCode!=="000"){this.alertService.error(l.headerResponse.responseMessage);return}if(l.occupantProperties.length<=0){let a="No occupant found ";this.alertService.showInfoMsgGeneral(a),this.logger.info(a);return}this.listOfOccupantProperties=l.occupantProperties,this.listOfOccupantProperties.length===1&&(this.selectedOccupant=this.listOfOccupantProperties[0],this.selectOccupant(this.selectedOccupant))},error:l=>{this.logger.error(l),this.alertService.showInfoMsg(l)}})}selectOccupant(l){this.listOfOccupantProperties=[],this.selectedOccupant=l,this.showOccupantDetails=!0,this.searchAllOccupantBills()}openViewLedgerComponent(l){let a={initialState:{propertyLedger:l}};this.modalService.config.ignoreBackdropClick=!0,this.modalService.config.animated=!0,this.modalRef=this.modalService.show(Se,a),this.modalRef.content.closeBtnName="Close"}export(){this.excelExporterService.exportAsExcelFile(this.listOfPropertyLedgers,"property-ledgers")}searchAllOccupantBills(){this.listOfPropertyLedgers=[],this.totalCredit=0,this.totalDebit=0,this.currentBal=0,this.balance=0;let l=new ve;l.occupantId=this.selectedOccupant.occupantId,l.propertyId=this.selectedOccupant.propertyId,l.endDate=this.endDate,l.startDate=this.startDate,l.searchBy="DR",this.billPaymentService.fetchPropertyEntries(this.currentUser,l).subscribe({next:a=>{if(this.logger.info("getPropertyCharges response "+JSON.stringify(a)),a.headerResponse.responseCode!=="000"){this.alertService.error(a.headerResponse.responseMessage);return}if(a.propertyLedgers.length<=0){let n="No ledgers found ";this.alertService.showInfoMsgGeneral(n),this.logger.info(n);return}this.listOfPropertyLedgers=a.propertyLedgers,this.totalCredit=a.totalCredit,this.totalDebit=a.totalDebit,this.currentBal=a.currentBalance,this.balance=this.totalDebit-this.totalCredit},error:a=>{this.logger.error(a),this.alertService.showInfoMsg(a)}})}};d.\u0275fac=function(a){return new(a||d)(x(fe),x(pe),x($))},d.\u0275cmp=C({type:d,selectors:[["ng-component"]],standalone:!0,features:[L],decls:84,vars:36,consts:[[3,"pageTitleName","description"],[1,"row"],[1,"col-lg-4"],[1,"card","card-no-border"],[1,"card-title"],[1,"form-group","mb-3"],[3,"labelForName","labelName"],[1,"form-control-wrap"],[1,"input-group"],["type","text","placeholder","Enter occupant name,mobile no,property name,id",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-append","select-cursor"],["id","searching",1,"input-group-text","btn-dim","btn-primary",3,"click"],[1,"icon","ni","ni-search"],["class","custom-control-group custom-control-vertical custom-control-stacked w-100"],[3,"occupantDetails",4,"ngIf"],[1,"col-lg-8"],[1,"row","gy-2","gx-2","mb-4","align-items-center"],[1,"col-auto"],[1,"form-group"],["for","startDate",1,"form-label","pt-0"],["dateFormat","yy-mm-dd","styleClass","\u201Dform-control\u201D","dateFormat","dd-mm-yy",3,"monthNavigator","yearNavigator","showIcon","ngModel","ngModelChange"],["for","endDate",1,"form-label","pt-0"],["styleClass","\u201Dform-control\u201D","dateFormat","dd-mm-yy",3,"showIcon","ngModel","ngModelChange"],["type","button","title","",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],["tooltip","Data export",1,"dropdown"],["href","#","data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-light","mt-4"],[1,"icon","ni","ni-chevron-down"],[1,"dropdown-menu"],[1,"link-list-opt","no-bdr"],[3,"click"],[1,"icon","ni","ni-file-xls","text-primary"],[2,"cursor","not-allowed"],[1,"icon","ni","ni-file-pdf","text-primary","disabled"],[1,"row","gy-2","gx-3","my-3"],[1,"preview-title-lg","overline-title"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],[1,"row","mt-3","justify-content-end"],[1,"col-6"],[1,"row","gy-2"],[1,"col-sm-12","text-end"],[1,"ff-mono","fw-bolder"],[1,"custom-control-group","custom-control-vertical","custom-control-stacked","w-100"],[4,"ngFor","ngForOf"],[1,"custom-control","custom-control-sm","custom-radio","custom-control-pro","select-cursor",3,"click"],["type","radio","name","user-choose",1,"custom-control-input",3,"id"],[1,"custom-control-label",3,"for"],[1,"user-card"],[1,"user-info"],[1,"lead-text"],[1,"sub-text"],[3,"occupantDetails"],[1,"text-end"],[1,"fw-lighter"],[1,"d-block"],["tooltip","View ledger details",1,"align-center","select-cursor"],[1,"user-avatar","user-avatar-sm","bg-light",3,"click"],[1,"icon","ni","ni-eye"]],template:function(a,n){a&1&&(u(0,"app-add-item",0),e(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),u(6,"app-form-label",6),e(7,"div",7)(8,"div",8)(9,"input",9),y("ngModelChange",function(b){return n.searchTerm=b}),i(),e(10,"div",10)(11,"span",11),y("click",function(){return n.searchOccupant()}),u(12,"em",12),e(13,"span"),t(14,"Search"),i()()()()()()(),P(15,Ce,2,1,"ul",13)(16,Pe,1,1,"app-occupant-property-details",14),i()(),U(17),e(18,"div",15)(19,"div",16)(20,"div",17)(21,"div",7)(22,"div",18)(23,"label",19),t(24,"Start Date"),i(),u(25,"br"),e(26,"p-calendar",20),y("ngModelChange",function(b){return n.startDate=b}),i()()()(),e(27,"div",17)(28,"label",21),t(29,"End Date"),i(),u(30,"br"),e(31,"p-calendar",22),y("ngModelChange",function(b){return n.endDate=b}),i()(),e(32,"div",17)(33,"button",23),y("click",function(){return n.searchAllOccupantBills()}),t(34," Search "),i()(),e(35,"div",17)(36,"div",24)(37,"a",25)(38,"span"),t(39,"Export ledger"),i(),u(40,"em",26),i(),e(41,"div",27)(42,"ul",28)(43,"li")(44,"a",29),y("click",function(){return n.export()}),u(45,"em",30),e(46,"span"),t(47,"Export to Excel"),i()()(),e(48,"li")(49,"a",31),u(50,"em",32),e(51,"span"),t(52,"Export to PDF"),i()()()()()()()(),e(53,"div",33)(54,"span",34),t(55,"Property ledger history"),i(),e(56,"p-table",35,36),p(58,"filter"),P(59,Le,11,0,"ng-template",37)(60,Oe,25,18,"ng-template",38),i()(),e(61,"div",39),u(62,"div",40),e(63,"div",40)(64,"div",41)(65,"div",42),t(66," Currency:"),e(67,"span",43),t(68," GHS"),i()(),e(69,"div",42),t(70," Total Debit: "),e(71,"span",43),t(72),p(73,"number"),i()(),e(74,"div",42),t(75," Total Credit: "),e(76,"span",43),t(77),p(78,"number"),i()(),e(79,"div",42),t(80," Outstanding Bal: "),e(81,"span",43),t(82),p(83,"number"),i()()()()()(),j(),i()),a&2&&(v("pageTitleName","Property ledger")("description","View debit and credit entries of a property"),r(6),v("labelForName","searchText")("labelName","Search  occupant or property"),r(3),v("ngModel",n.searchTerm),r(6),V(15,n.listOfOccupantProperties?15:-1),r(1),v("ngIf",n.showOccupantDetails),r(10),v("monthNavigator",!0)("yearNavigator",!0)("showIcon",!0)("ngModel",n.startDate),r(5),v("showIcon",!0)("ngModel",n.endDate),r(25),v("value",f(58,23,n.listOfPropertyLedgers,n.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",H(35,De))("resizableColumns",!0)("autoLayout",!0),r(16),h(" ",f(73,26,n.totalDebit,"1.2-2"),""),r(5),h(" ",f(78,29,n.totalCredit,"1.2-2"),""),r(5),h(" ",f(83,32,n.balance,"1.2-2"),""))},dependencies:[I,q,G,w,O,D,oe,de,Q,z,K,X,Y,ae,re,te,he,Z,ee,N,ce,me,B,ne,ie],encapsulation:2});let s=d;return s})();export{yt as PropertyLedgerComponent};
