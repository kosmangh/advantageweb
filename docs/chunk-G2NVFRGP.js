import{a as ve}from"./chunk-2LQIRPNS.js";import{a as fe,b as xe,c as _e}from"./chunk-V6IZBQGW.js";import{a as R,b as he}from"./chunk-TPNH6JTS.js";import{a as Se}from"./chunk-J3GFM727.js";import{a as ge}from"./chunk-NXAZBSFM.js";import{a as ue}from"./chunk-LD7XCFFA.js";import{a as de}from"./chunk-FMEHXA2G.js";import{c as ce}from"./chunk-QQMX5O62.js";import{a as me}from"./chunk-IP4FBAZW.js";import{b as ne,c as le,d as pe,e as k}from"./chunk-7PQCCLGB.js";import"./chunk-T45HSKH6.js";import{d as se}from"./chunk-WH3N5QDN.js";import{i as ie,t as ae}from"./chunk-KPCRGR73.js";import{h as re,i as oe}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import"./chunk-NEQ5BFSP.js";import{c as K,f as z,k as Q,v as X,x as Z}from"./chunk-B2QESFZG.js";import{a as te}from"./chunk-Y725X6Z7.js";import{c as W}from"./chunk-R55IMLXW.js";import{a as ee}from"./chunk-LPKVFVKE.js";import{b as G,f as Y,g as T}from"./chunk-IHPVOZWG.js";import"./chunk-7DWKZ4XI.js";import{Ab as A,Eb as t,Fb as m,Gb as y,Hb as E,Kc as $,Lc as q,Mb as P,Nb as U,Qc as J,Rc as I,Sa as r,Ta as O,Tc as M,Uc as D,Wb as c,Xb as _,Yb as g,bb as x,fb as V,gb as F,ib as C,ja as b,jb as L,la as w,nb as e,ob as i,pb as d,qa as S,qb as j,ra as v,rb as H,tb as B,wb as f,xb as h}from"./chunk-QRSQYA3Q.js";import"./chunk-5FZOKLP6.js";var N=class{constructor(){}};var ye=(()=>{let p=class p{constructor(o,l){this.modalRef=o,this.accountService=l,this.accountService.currentUser.subscribe(n=>this.currentUser=n)}ngOnInit(){this.modalRef.setClass("gray modal-md modal-dialog-top")}};p.\u0275fac=function(l){return new(l||p)(O(re),O(T))},p.\u0275cmp=w({type:p,selectors:[["app-bill-details"]],standalone:!0,features:[P],decls:108,vars:35,consts:[[1,"modal-header"],[1,"modal-title"],["type","button btn-xs","aria-label","Close",1,"close","btn-close","pull-right","border","border-gray",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"card","card-no-border"],[1,"pricing-body"],[1,"pricing-features"],[1,"preview-title-lg","overline-title"],[1,"w-50"],[1,"ms-auto","fw-bolder"],[1,"preview-title-lg","overline-title","mt-3"],[1,"d-block"],[1,"row","my-3","mx-2","mb-3","justify-content-end"],[1,"col-auto"],[1,"btn","btn-sm","btn-primary",3,"click"]],template:function(l,n){l&1&&(e(0,"div",0)(1,"h6",1),t(2),i(),e(3,"button",2),f("click",function(){return n.modalRef==null?null:n.modalRef.hide()}),e(4,"span",3),t(5,"\xD7"),i()()(),e(6,"div",4)(7,"div",5)(8,"div",6)(9,"ul",7)(10,"span",8),t(11,"occupant Details"),i(),e(12,"li")(13,"span",9),t(14,"occupant"),i(),t(15," - "),e(16,"span",10),t(17),i()(),e(18,"li")(19,"span",9),t(20,"Property"),i(),t(21," - "),e(22,"span",10),t(23),i()(),e(24,"span",11),t(25,"Bill Details"),i(),e(26,"li")(27,"span",9),t(28,"Bill Amount"),i(),t(29," - "),e(30,"span",10),t(31),c(32,"number"),i()(),e(33,"li")(34,"span",9),t(35,"Amount Paid"),i(),t(36," - "),e(37,"span",10),t(38),c(39,"number"),i()(),e(40,"li")(41,"span",9),t(42,"Arrears"),i(),t(43," - "),e(44,"span",10),t(45),c(46,"number"),i()(),e(47,"li")(48,"span",9),t(49,"Bill Status"),i(),t(50," - "),e(51,"span",10),t(52),i()(),e(53,"li")(54,"span",9),t(55,"Bill Type"),i(),t(56," - "),e(57,"span",10),t(58),i()(),e(59,"li")(60,"span",9),t(61,"Entry Type"),i(),t(62," - "),e(63,"span",10),t(64),i()(),e(65,"li")(66,"span",9),t(67,"Bill Year"),i(),t(68," - "),e(69,"span",10),t(70),i()(),e(71,"span",11),t(72,"Bill Activities"),i(),e(73,"li")(74,"span",9),t(75,"Bill Date"),i(),t(76," - "),e(77,"span",10)(78,"span",12),t(79),c(80,"date"),c(81,"timeAgo"),i()()(),e(82,"li")(83,"span",9),t(84,"Billed By"),i(),t(85," - "),e(86,"span",10),t(87),i()(),e(88,"li")(89,"span",9),t(90,"Late Modified Date"),i(),t(91," - "),e(92,"span",10)(93,"span",12),t(94),c(95,"date"),c(96,"timeAgo"),i()()(),e(97,"li")(98,"span",9),t(99,"Last Modified By"),i(),t(100," - "),e(101,"span",10),t(102),i()()()()()(),e(103,"div",13)(104,"div",14)(105,"a",15),f("click",function(){return n.modalRef==null?null:n.modalRef.hide()}),e(106,"span"),t(107,"Close"),i()()()()),l&2&&(r(2),y("Property ",n.bills.property," Details"),r(15),m(n.occupant.occupantName),r(6),m(n.occupant.propertyName),r(8),m(g(32,16,n.bills.billAmount,"1.2-2")),r(7),m(g(39,19,n.bills.billAmountPaid,"1.2-2")),r(7),m(g(46,22,n.bills.arrears,"1.2-2")),r(7),m(n.bills.billStatus),r(6),m(n.bills.billType),r(6),m(n.bills.entryType),r(6),m(n.bills.billYear),r(9),E(" ",g(80,25,n.bills.createdDate,"dd/MM/yyyy HH:MM a")," ",_(81,28,n.bills.createdDate.toString())," "),r(8),m(n.bills.createdBy),r(7),E(" ",g(95,30,n.bills.lastModifiedDate,"dd/MM/yyyy HH:MM a")," ",_(96,33,n.bills.lastModifiedDate.toString())," "),r(8),m(n.bills.createdBy))},dependencies:[D,M,I,k],encapsulation:2});let s=p;return s})();function Ee(s,p){if(s&1){let a=B();e(0,"li")(1,"div",25),f("click",function(){let n=S(a).$implicit,u=h(2);return v(u.selectOccupant(n))}),d(2,"input",26),e(3,"label",27)(4,"span",28)(5,"span"),c(6,"avatarBg"),e(7,"span"),t(8),c(9,"avatarName"),i()(),e(10,"span",29)(11,"span",30),t(12),i(),e(13,"span",31),t(14),i(),e(15,"span",31),t(16),i(),e(17,"span",31),t(18),i()()()()()()}if(s&2){let a=p.$implicit;r(2),A("id",a.recordId),r(1),A("for",a.recordId),r(2),F("user-avatar ",_(6,11,""),""),r(3),m(_(9,13,a.occupantName)),r(4),m(a.occupantName),r(2),m(a.mobileNo),r(2),E("",a.propertyName," (",a.propertyId,") "),r(2),m(a.occupationType)}}function we(s,p){if(s&1&&(e(0,"ul",23),C(1,Ee,19,15,"li",24),i()),s&2){let a=h();r(1),x("ngForOf",a.listOfOccupantProperties)}}function Pe(s,p){if(s&1&&d(0,"app-occupant-property-details",32),s&2){let a=h();x("occupantDetails",a.selectedOccupant)}}function Ie(s,p){if(s&1){let a=B();e(0,"div",33)(1,"div",34)(2,"div",7)(3,"div",35),d(4,"em",12),i(),e(5,"input",36),f("ngModelChange",function(l){S(a);let n=h();return v(n.searchedKeyword=l)}),i()()(),e(6,"div",34)(7,"a",37),f("click",function(){S(a);let l=h();return v(l.searchAllOccupantBills())}),e(8,"span"),t(9,"Refresh"),i()()(),e(10,"div",34)(11,"div",38)(12,"a",39)(13,"span"),t(14,"Export bills"),i(),d(15,"em",40),i(),e(16,"div",41)(17,"ul",42)(18,"li")(19,"a",43),f("click",function(){S(a);let l=h();return v(l.export())}),d(20,"em",44),e(21,"span"),t(22,"Export to Excel"),i()()(),e(23,"li")(24,"a",45),d(25,"em",46),e(26,"span"),t(27,"Export to PDF"),i()()()()()()()()}if(s&2){let a=h();r(5),x("ngModel",a.searchedKeyword)}}function Me(s,p){s&1&&(e(0,"tr")(1,"th",47),t(2,"Bill Amount"),i(),e(3,"th",47),t(4,"Amount Paid"),i(),e(5,"th",47),t(6,"Arrears"),i(),e(7,"th"),t(8,"Bill Status"),i(),e(9,"th"),t(10,"Narration"),i(),e(11,"th"),t(12,"Bill Date"),i(),d(13,"th",47),e(14,"th",47),t(15,"More Actions"),i()())}function De(s,p){if(s&1){let a=B();e(0,"li")(1,"a",43),f("click",function(){S(a);let l=h().$implicit,n=h();return v(n.openPayBillComponent(l))}),d(2,"em",60),e(3,"span"),t(4,"Send demand notice"),i()()()}}function Te(s,p){if(s&1){let a=B();e(0,"tr")(1,"td",47),t(2),c(3,"number"),i(),e(4,"td",47),t(5),c(6,"number"),i(),e(7,"td",47)(8,"span",48),t(9),c(10,"number"),i()(),e(11,"td")(12,"span"),c(13,"statusStyle"),t(14),c(15,"titlecase"),c(16,"removeHyphen"),i()(),e(17,"td"),t(18),i(),e(19,"td"),t(20),e(21,"div",49)(22,"small",50),t(23),c(24,"date"),i(),e(25,"small"),t(26),c(27,"timeAgo"),i()()(),e(28,"td")(29,"a",51),f("click",function(){let n=S(a).$implicit,u=h();return v(u.openPayBillComponent(n))}),e(30,"span"),t(31,"Pay bill"),i()()(),e(32,"td")(33,"div",52)(34,"a",53),d(35,"em",54),i(),e(36,"div",55)(37,"ul",42)(38,"li")(39,"a",43),f("click",function(){let n=S(a).$implicit,u=h();return v(u.openPayBillComponent(n))}),d(40,"em",56),e(41,"span"),t(42,"Pay bill"),i()()(),e(43,"li")(44,"a",43),f("click",function(){let n=S(a).$implicit,u=h();return v(u.openBillDetailsComponent(n))}),d(45,"em",57),e(46,"span"),t(47,"View bill details"),i()()(),e(48,"li")(49,"a",43),f("click",function(){let n=S(a).$implicit,u=h();return v(u.printDemandNotice(n))}),d(50,"em",58),e(51,"span"),t(52,"Print demand notice"),i()()(),C(53,De,5,0,"li",59),i()()()()()}if(s&2){let a=p.$implicit;r(2),m(g(3,12,a==null?null:a.billAmount,".2-2")),r(3),m(g(6,15,a==null?null:a.billAmountPaid,".2-2")),r(4),m(g(10,18,a==null?null:a.arrears,".2-2")),r(3),V(_(13,21,a==null?null:a.billStatus)),r(2),y(" ",_(15,23,_(16,25,a==null?null:a.billStatus))," "),r(4),m(a==null?null:a.narration),r(2),y(" ",a==null?null:a.createdBy," "),r(3),m(g(24,27,a==null?null:a.createdDate,"dd/MM/yyyy HH:mm a")),r(3),y(" ",_(27,30,a==null?null:a.createdDate),""),r(27),x("ngIf",!1)}}function ke(s,p){if(s&1&&(e(0,"div",61),d(1,"div",62),e(2,"div",62)(3,"div",63)(4,"div",64),t(5," Currency:"),e(6,"span",65),t(7," GHS"),i()(),e(8,"div",64),t(9," Total Debit: "),e(10,"span",65),t(11),c(12,"number"),i()(),e(13,"div",64),t(14," Total Credit: "),e(15,"span",65),t(16),c(17,"number"),i()(),e(18,"div",64),t(19," Outstanding Bal: "),e(20,"span",65),t(21),c(22,"number"),i()()()()()),s&2){let a=h();r(11),y(" ",g(12,3,a.totalDebit,"1.2-2"),""),r(5),y(" ",g(17,6,a.totalCredit,"1.2-2"),""),r(5),y(" ",g(22,9,a.balance,"1.2-2"),"")}}var Ne=()=>[5,10,25,50],yt=(()=>{let p=class p{constructor(o,l,n){this.billPaymentService=o,this.modalService=l,this.logger=n,this.excelExporterService=b(ue),this.settingsService=b(se),this.accountService=b(T),this.alertService=b(W),this.utilsService=b(Y),this.occupantsService=b(de),this.accountService.currentUser.subscribe(u=>this.currentUser=u)}ngOnDestroy(){this.modalService.hide()}ngOnInit(){this.selectedOccupant=JSON.parse(localStorage.getItem("selectedOccupant"))??null,this.selectedOccupant&&(this.searchTerm=this.selectedOccupant.propertyId,this.searchAllOccupantBills()),this.showOccupantDetails=!0,this.showNoRecordsFound=!1}trackByFn(o){return o.occupantName}searchOccupant(){localStorage.removeItem("payBill"),this.selectedOccupant=new R,this.showOccupantDetails=!1,this.showNoRecordsFound=!1,this.listOfOccupantProperties=[],this.listOfOutstandingBills=[],this.occupantsService.quickSearchOccupantProperties(this.currentUser,this.searchTerm.trim(),"ALL").subscribe({next:o=>{if(this.logger.info("quickSearchOccupantProperties response "+JSON.stringify(o)),o.headerResponse.responseCode!=="000"){this.alertService.error(o.headerResponse.responseMessage);return}if(o.occupantProperties.length<=0){let l="No occupant found ";this.alertService.showInfoMsgGeneral(l),this.logger.info(l);return}this.listOfOccupantProperties=o.occupantProperties,this.listOfOccupantProperties.length===1&&(this.selectedOccupant=this.listOfOccupantProperties[0],this.selectOccupant(this.selectedOccupant))},error:o=>{this.logger.error(o),this.alertService.showInfoMsg(o)}})}selectOccupant(o){this.listOfOccupantProperties=[],this.selectedOccupant=o,this.showOccupantDetails=!0,this.searchAllOccupantBills()}cancelButton(){this.showOccupantDetails=!1,this.selectedOccupant=new R,this.listOfOccupantProperties=[],this.listOfPropertyLedgers=[]}openPayBillComponent(o){let l=new _e(o,null);l.payerName=this.selectedOccupant.occupantName,l.paymentType=this.selectedOccupant.paymentType,localStorage.setItem("selectedOccupant",JSON.stringify(this.selectedOccupant));let n={initialState:{isAddMode:!0,payBill:l}};this.modalService.config.ignoreBackdropClick=!0,this.modalService.config.animated=!0,this.addPaymentBsModalRef=this.modalService.show(xe,n),this.addPaymentBsModalRef.content.closeBtnName="Close"}printDemandNotice(o){let l=new ve;l.searchParameter="PID",l.searchValue=o.property,l.billYear=o.billYear,l.billMonth=o.billMonth,l.billType=o.billType,this.billPaymentService.generateJasperReport(this.currentUser,l)}openBillDetailsComponent(o){let l={initialState:{bills:o,occupant:this.selectedOccupant}};this.modalService.config.ignoreBackdropClick=!0,this.modalService.config.animated=!0,this.modalRef=this.modalService.show(ye,l),this.modalRef.content.closeBtnName="Close"}export(){this.excelExporterService.exportAsExcelFile(this.listOfOutstandingBills,"outstanding-bills")}searchAllOccupantBills(){this.listOfOutstandingBills=[],this.totalCredit=0,this.totalDebit=0,this.currentBal=0,this.balance=0;let o=new N;o.occupantId=this.selectedOccupant.occupantId,o.propertyId=this.selectedOccupant.propertyId,this.billPaymentService.fetchOutstandingBills(this.currentUser,o).subscribe({next:l=>{if(this.logger.info("fetchOutstandingBills response "+JSON.stringify(l)),l.headerResponse.responseCode!=="000"){this.alertService.error(l.headerResponse.responseMessage);return}if(l.listOfBills.length<=0){let n="No bills found ";this.alertService.showInfoMsgGeneral(n),this.logger.info(n);return}this.listOfOutstandingBills=l.listOfBills,this.balance=this.totalDebit-this.totalCredit},error:l=>{this.logger.error(l),this.alertService.showInfoMsg(l)}})}openPaymentDetailsComponent(o,l){let n={initialState:{propertyLedger:o,selectedOccupant:l}};this.modalService.config.ignoreBackdropClick=!0,this.modalService.config.animated=!0,this.modalRef=this.modalService.show(fe,n),this.modalRef.content.closeBtnName="Close"}searchParameterListener(){if(this.searchParameter=="receiptNumberIssued"){this.searchParameterLabel="Receipt Number";return}if(this.searchParameter=="mediumOfPaymentNumber"){this.searchParameterLabel="Mode of Payment Number";return}}};p.\u0275fac=function(l){return new(l||p)(O(ge),O(oe),O(G))},p.\u0275cmp=w({type:p,selectors:[["ng-component"]],standalone:!0,features:[P],decls:28,vars:20,consts:[[3,"pageTitleName","description"],[1,"row"],[1,"col-lg-4"],[1,"card","card-no-border"],[1,"card-title"],[1,"form-group","mb-3"],[3,"labelForName","labelName"],[1,"form-control-wrap"],[1,"input-group"],["type","text","placeholder","Enter occupant name,mobile no,property name,id",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-append","select-cursor"],["id","searching",1,"input-group-text","btn-dim","btn-primary",3,"click"],[1,"icon","ni","ni-search"],["class","custom-control-group custom-control-vertical custom-control-stacked w-100"],[3,"occupantDetails",4,"ngIf"],[1,"col-lg-8"],["class","row gy-2 gx-3 my-3",4,"ngIf"],[1,"preview-title-lg","overline-title"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],["class","row mt-3 justify-content-end",4,"ngIf"],[1,"custom-control-group","custom-control-vertical","custom-control-stacked","w-100"],[4,"ngFor","ngForOf"],[1,"custom-control","custom-control-sm","custom-radio","custom-control-pro","select-cursor",3,"click"],["type","radio","name","user-choose",1,"custom-control-input",3,"id"],[1,"custom-control-label",3,"for"],[1,"user-card"],[1,"user-info"],[1,"lead-text"],[1,"sub-text"],[3,"occupantDetails"],[1,"row","gy-2","gx-3","my-3"],[1,"col-auto"],[1,"form-icon","form-icon-right"],["type","text","autocomplete","off","id","default-04","placeholder","Quick search",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","btn-dim",3,"click"],["tooltip","Data export",1,"dropdown"],["href","#","data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-light"],[1,"icon","ni","ni-chevron-down"],[1,"dropdown-menu"],[1,"link-list-opt","no-bdr"],[3,"click"],[1,"icon","ni","ni-file-xls"],[2,"cursor","not-allowed"],[1,"icon","ni","ni-file-pdf","disabled"],[1,"text-end"],[1,"fw-bold"],[1,"fw-lighter"],[1,"d-block"],[1,"btn","btn-primary","btn-sm","text-end",3,"click"],[1,"drodown","text-end"],["data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-icon","btn-light"],[1,"icon","ni","ni-more-v"],[1,"dropdown-menu","dropdown-menu-end"],[1,"icon","ni","ni-money"],[1,"icon","ni","ni-eye"],[1,"icon","ni","ni-printer"],[4,"ngIf"],[1,"icon","ni","ni-send"],[1,"row","mt-3","justify-content-end"],[1,"col-6"],[1,"row","gy-2"],[1,"col-sm-12","text-end"],[1,"ff-mono","fw-bolder"]],template:function(l,n){l&1&&(d(0,"app-add-item",0),e(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),d(6,"app-form-label",6),e(7,"div",7)(8,"div",8)(9,"input",9),f("ngModelChange",function(be){return n.searchTerm=be}),i(),e(10,"div",10)(11,"span",11),f("click",function(){return n.searchOccupant()}),d(12,"em",12),e(13,"span"),t(14,"Search"),i()()()()()()(),C(15,we,2,1,"ul",13)(16,Pe,1,1,"app-occupant-property-details",14),i()(),j(17),e(18,"div",15),C(19,Ie,28,1,"div",16),e(20,"span",17),t(21,"Outstanding Bills"),i(),e(22,"p-table",18,19),c(24,"filter"),C(25,Me,16,0,"ng-template",20)(26,Te,54,32,"ng-template",21),i(),C(27,ke,23,12,"div",22),i(),H(),i()),l&2&&(x("pageTitleName","Property outstanding bills")("description","View & pay outstanding bills of ground and house rents"),r(6),x("labelForName","searchText")("labelName","Search  occupant or property"),r(3),x("ngModel",n.searchTerm),r(6),L(15,n.listOfOccupantProperties?15:-1),r(1),x("ngIf",n.showOccupantDetails),r(3),x("ngIf",(n.listOfOutstandingBills==null?null:n.listOfOutstandingBills.length)>0),r(3),x("value",g(24,16,n.listOfOutstandingBills,n.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",U(19,Ne))("resizableColumns",!0)("autoLayout",!0),r(5),x("ngIf",!1))},dependencies:[D,$,q,M,J,I,ae,pe,X,K,z,Q,Z,le,ne,ie,he,ce,ee,te,k,me,Se],encapsulation:2});let s=p;return s})();export{yt as OutstandingBillsComponent};
