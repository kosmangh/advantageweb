import"./chunk-J3GFM727.js";import{a as ie}from"./chunk-LD7XCFFA.js";import"./chunk-IP4FBAZW.js";import{b as W,c as Y,d as ee,e as te}from"./chunk-7PQCCLGB.js";import{i as X,r as $,s as q,t as Z}from"./chunk-KPCRGR73.js";import{h as S}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import{c as U,f as k,k as j,q as K,r as z,s as G,v as H}from"./chunk-B2QESFZG.js";import{b as Q}from"./chunk-Y725X6Z7.js";import{c as J}from"./chunk-R55IMLXW.js";import"./chunk-LPKVFVKE.js";import{b as O,f as V,g as E}from"./chunk-IHPVOZWG.js";import"./chunk-HPGLX4ZN.js";import"./chunk-7DWKZ4XI.js";import{Ab as _,Eb as i,Fb as f,Gb as L,Lc as R,Mb as T,Nb as B,Rc as P,Sa as a,Ta as v,Uc as F,Wb as y,Xb as N,Yb as x,bb as p,ib as C,ja as g,la as A,nb as e,ob as t,pb as c,qa as w,ra as D,tb as I,wb as h,xb as M}from"./chunk-QRSQYA3Q.js";import{e as b}from"./chunk-5FZOKLP6.js";function ne(l,s){if(l&1){let n=I();e(0,"div",3)(1,"div",4)(2,"label",5),i(3),t(),c(4,"br"),e(5,"div",6)(6,"input",26),h("ngModelChange",function(m){w(n);let r=M();return D(r.searchValue=m)}),t()()()()}if(l&2){let n=M();a(3),f(n.searchValueLabel),a(3),_("placeholder",n.searchPlaceholder),p("ngModel",n.searchValue)}}function re(l,s){l&1&&(e(0,"tr")(1,"th"),i(2,"SN"),t(),e(3,"th"),i(4,"Full Name"),t(),e(5,"th"),i(6,"Username"),t(),e(7,"th"),i(8,"Activity"),t(),e(9,"th"),i(10,"IP Address"),t(),e(11,"th"),i(12,"Log Date"),t()())}function oe(l,s){if(l&1&&(e(0,"tr")(1,"td"),i(2),t(),e(3,"td"),c(4,"app-full-name",27),t(),e(5,"td"),i(6),t(),e(7,"td"),i(8),t(),e(9,"td")(10,"div",28)(11,"small",29),i(12),y(13,"date"),t(),e(14,"small",30),i(15),y(16,"timeAgo"),t()()(),e(17,"td"),i(18),t()()),l&2){let n=s.$implicit,o=s.rowIndex;a(2),f(o+1),a(2),_("fullName",n==null?null:n.fullName),_("otherFieldName",n==null?null:n.email),a(2),f(n==null?null:n.username),a(2),f(n==null?null:n.userActivity),a(4),f(x(13,8,n.createdDate,"medium")),a(3),L(" ",N(16,11,n.createdDate),""),a(3),f(n==null?null:n.ip)}}var ae=()=>[5,10,25,50],Oe=(()=>{let s=class s{constructor(o,m,r,u){this.addStaffBsModalRef=o,this.viewStaffBsModalRef=m,this.loginAccountBsModalRef=r,this.adminPasswordResetBsModalRef=u,this.authService=g(E),this.accountService=g(E),this.alertService=g(J),this.utilsService=g(V),this.excelExporterService=g(ie),this.logger=g(O),this.accountService.currentUser.subscribe(d=>this.currentUser=d)}ngOnInit(){this.searchBy="DR",this.startDate=this.utilsService.getFirstDayDate(),this.endDate=new Date,this.fetchAudits()}ngOnDestroy(){}searchByListener(){if(this.searchValue="",this.searchBy==="username"){this.searchValueLabel="Username",this.searchPlaceholder=" Enter username";return}}fetchAudits(){this.listOfAudits=[],this.authService.searchAuditLogs(this.currentUser,this.searchBy,this.searchValue,this.startDate,this.endDate).subscribe({next:o=>{if(this.logger.info("search audit logs response "+JSON.stringify(o)),o.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(o.headerResponse.responseMessage);return}if(o.auditLogs.length<=0){this.alertService.showInfoMsgGeneral("No audits found"),this.logger.info("No audits found");return}this.listOfAudits=o.auditLogs},error:o=>{this.logger.error(o),this.alertService.showInfoMsg(o)}})}exportAudits(){this.excelExporterService.exportAsExcelFile(this.listOfAudits,"audit_logs")}logAction(o,m){return b(this,null,function*(){yield this.accountService.logUserAudit(o,m)})}};s.\u0275fac=function(m){return new(m||s)(v(S),v(S),v(S),v(S))},s.\u0275cmp=A({type:s,selectors:[["ng-component"]],standalone:!0,features:[T],decls:47,vars:20,consts:[[3,"pageTitleName","description"],[1,"newItemName"],[1,"row","gy-2","gx-3","mt-5","mb-4","align-items-center"],[1,"col-sm-2"],[1,"form-group"],["for","startDate",1,"form-label","pt-0"],[1,"form-control-wrap"],[1,"form-control-select"],["id","searchBy",1,"form-control",3,"ngModel","ngModelChange","change"],["value","username","selected","",1,"fs-6"],["value","DR","selected","",1,"fs-6"],["class","col-sm-2",4,"ngIf"],[1,"col-auto"],["styleClass","\u201Dform-control\u201D","dateFormat","dd-mm-yy",3,"showIcon","ngModel","ngModelChange"],["for","endDate",1,"form-label","pt-0"],["type","button","title","",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],[1,"btn","mt-4","btn-outline-light",3,"click"],[1,"icon","ni","ni-download"],[1,"row","gy-2","gx-3","my-3"],[1,"form-icon","form-icon-right"],[1,"icon","ni","ni-search"],["type","text","id","default-04","placeholder","Quick search",1,"form-control",3,"ngModel","ngModelChange"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],["id","searchBy",1,"form-control",3,"ngModel","placeholder","ngModelChange"],[3,"fullName","otherFieldName"],[1,"fw-lighter"],[1,"d-block"],[1,"text-primary"]],template:function(m,r){m&1&&(e(0,"app-add-item",0),c(1,"span",1),t(),e(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),i(6,"Search Type"),t(),c(7,"br"),e(8,"div",6)(9,"div",7)(10,"select",8),h("ngModelChange",function(d){return r.searchBy=d})("change",function(){return r.searchByListener()}),e(11,"option",9),i(12,"Username"),t(),e(13,"option",10),i(14,"Date Range"),t()()()()()(),C(15,ne,7,3,"div",11),e(16,"div",12)(17,"div",6)(18,"div",4)(19,"label",5),i(20,"Start Date"),t(),c(21,"br"),e(22,"p-calendar",13),h("ngModelChange",function(d){return r.startDate=d}),t()()()(),e(23,"div",12)(24,"label",14),i(25,"End Date"),t(),c(26,"br"),e(27,"p-calendar",13),h("ngModelChange",function(d){return r.endDate=d}),t()(),e(28,"div",12)(29,"button",15),h("click",function(){return r.fetchAudits()}),i(30," Search "),t()(),e(31,"div",12)(32,"a",16),h("click",function(){return r.exportAudits()}),c(33,"em",17),e(34,"span"),i(35,"Export"),t()()()(),e(36,"div",18)(37,"div",12)(38,"div",6)(39,"div",19),c(40,"em",20),t(),e(41,"input",21),h("ngModelChange",function(d){return r.searchedKeyword=d}),t()()()(),e(42,"p-table",22,23),y(44,"filter"),C(45,re,13,0,"ng-template",24)(46,oe,19,13,"ng-template",25),t()),m&2&&(p("pageTitleName","Audit Logs")("description","User activities"),a(10),p("ngModel",r.searchBy),a(5),p("ngIf",r.searchBy!=="DR"),a(7),p("showIcon",!0)("ngModel",r.startDate),a(5),p("showIcon",!0)("ngModel",r.endDate),a(14),p("ngModel",r.searchedKeyword),a(1),p("value",x(44,16,r.listOfAudits,r.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",B(19,ae))("resizableColumns",!0)("autoLayout",!0))},dependencies:[F,R,P,H,z,G,U,K,k,j,q,$,X,Z,Y,W,ee,Q,te],encapsulation:2});let l=s;return l})();export{Oe as AuditLogsComponent};
