import{a as $e}from"./chunk-LD7XCFFA.js";import{a as Ue,b as Ge}from"./chunk-6YXFCAQQ.js";import{a as re}from"./chunk-FMEHXA2G.js";import{a as ee,b as te,c as ne}from"./chunk-QQMX5O62.js";import{a as Le}from"./chunk-IP4FBAZW.js";import{a as qe}from"./chunk-L66UILBA.js";import{b as ke,c as Te,d as Re,e as Ve}from"./chunk-7PQCCLGB.js";import{a as De}from"./chunk-T45HSKH6.js";import{d as Z}from"./chunk-WH3N5QDN.js";import{i as Ne,r as Be,s as W,t as Ae}from"./chunk-KPCRGR73.js";import{h as M,i as ae}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import{a as Fe}from"./chunk-NEQ5BFSP.js";import{b as ye,c as Y,e as I,f as H,g as ge,k as ve,l as _e,n as Pe,o as Oe,p as Se,q as be,r as Ce,s as Ee,u as Ie,v as K,w as Me,x as Q}from"./chunk-B2QESFZG.js";import{b as we}from"./chunk-Y725X6Z7.js";import{b as xe,c as X}from"./chunk-R55IMLXW.js";import"./chunk-LPKVFVKE.js";import{b as J,d as L,f as he,g as V}from"./chunk-IHPVOZWG.js";import"./chunk-HPGLX4ZN.js";import{m as de,p as fe}from"./chunk-7DWKZ4XI.js";import{Ab as F,Bb as ce,Cb as pe,Eb as i,Fb as y,Gb as C,Hb as q,Ic as ue,Kc as $,Lc as D,Mb as A,Nb as se,Ob as E,Qc as j,Rc as z,Sa as l,Ta as P,Tc as me,Uc as R,Wb as g,Xb as S,Yb as w,bb as p,ib as h,ja as O,la as B,nb as t,ob as n,pb as u,qa as v,qb as k,ra as _,rb as T,tb as b,wb as d,xb as f}from"./chunk-QRSQYA3Q.js";import{d as le,e as G}from"./chunk-5FZOKLP6.js";var oe=le(xe());var U=le(xe());function et(c,s){if(c&1&&(t(0,"ng-option",35),i(1),n()),c&2){let o=s.$implicit;p("value",o.recordId),l(1),C(" ",o.estateName," ")}}function tt(c,s){c&1&&(t(0,"div"),u(1,"app-required-field"),n())}function nt(c,s){if(c&1&&(t(0,"ng-option",35),i(1),n()),c&2){let o=s.$implicit;p("value",o.recordId),l(1),C(" ",o.block," ")}}function rt(c,s){c&1&&(t(0,"div"),u(1,"app-required-field"),n())}function it(c,s){if(c&1&&(t(0,"ng-option",35),i(1),n()),c&2){let o=s.$implicit;p("value",o.recordId),l(1),C(" ",o.propertyName," ")}}function ot(c,s){c&1&&(t(0,"div"),u(1,"app-required-field"),n())}function at(c,s){if(c&1&&(t(0,"ng-option",36),i(1),n()),c&2){let o=s.$implicit;p("value",o.recordId),l(1),C(" ",o.occupantName," ")}}function lt(c,s){c&1&&(t(0,"div"),u(1,"app-required-field"),n())}function ct(c,s){c&1&&(t(0,"span"),u(1,"app-required-field"),n())}function pt(c,s){c&1&&(t(0,"span"),u(1,"app-required-field"),n())}var N=c=>({"is-invalid":c});function st(c,s){if(c&1&&(t(0,"li")(1,"div",37),u(2,"input",38),t(3,"label",39),i(4),n()()()),c&2){let o=s.$implicit,r=f();l(2),F("value",o.dataValue),p("id",o.dataValue)("ngClass",E(5,N,((r.occupantPropertyForm.occupationType==null?null:r.occupantPropertyForm.occupationType.touched)||(r.occupantPropertyForm.occupationType==null?null:r.occupantPropertyForm.occupationType.dirty)||r.submitted)&&(r.occupantPropertyForm.occupationType==null?null:r.occupantPropertyForm.occupationType.errors))),l(1),F("for",o.dataValue),l(1),y(o.dataLabel)}}function ut(c,s){c&1&&(t(0,"div",40),u(1,"app-required-field"),n())}function mt(c,s){c&1&&(t(0,"div",41),u(1,"input",42),t(2,"label",43),i(3," Save & new property "),n()())}function dt(c,s){if(c&1){let o=b();t(0,"button",44),d("click",function(){v(o);let a=f();return _(a.updateOccupant())}),i(1," Update "),n()}if(c&2){let o=f();p("title",o.occupantPropertyFormGroup.invalid?"There must be errors on the form":"")}}function ft(c,s){if(c&1){let o=b();t(0,"button",44),d("click",function(){v(o);let a=f();return _(a.saveOccupant())}),i(1," Save "),n()}if(c&2){let o=f();p("title",o.occupantPropertyFormGroup.invalid?"There must be errors on the form":"")}}var ht=c=>({"is-valid":c}),Ye=(()=>{let s=class s{constructor(r,a,e,m){this.title=r,this.addOccupantPropertyBsModalRef=a,this.fb=e,this.logger=m,this.submitted=!1,this.settingsService=O(Z),this.occupantsService=O(re),this.router=O(fe),this.accountService=O(V),this.alertService=O(X),this.accountService.currentUser.subscribe(x=>this.currentUser=x)}ngOnInit(){if(this.createForm(),this.fetchEstates(),this.isAddMode)this.headerMsg="New occupant property",this.title.setTitle(this.headerMsg);else{if(this.headerMsg="Edit "+this.occupantProperty.occupantName,this.title.setTitle(this.headerMsg),this.occupantPropertyFormGroup.patchValue(this.occupantProperty),this.occupantProperty.firstDateOfOccupancy){let r=this.occupantProperty.firstDateOfOccupancy.toString().replace("[UTC]","");this.occupantPropertyForm.firstDateOfOccupancy.setValue(new Date(r))}if(this.occupantProperty.lastDateOfOccupancy){let r=this.occupantProperty.lastDateOfOccupancy.toString().replace("[UTC]","");this.occupantPropertyForm.lastDateOfOccupancy.setValue(new Date(r))}this.fetchEstateBlocks(),this.fetchEstateProperties(),this.fetchOccupants()}this.addOccupantPropertyBsModalRef.setClass("gray modal-md modal-dialog-top"),this.listOfProOccupantTypes=this.settingsService.getOccupationType()}createForm(){this.occupantPropertyFormGroup=this.fb.group({estateId:["",[I.required]],blockId:["",[I.required]],propertyId:["",[I.required]],occupantId:["",[I.required]],occupationType:["",[I.required]],firstDateOfOccupancy:["",{updateOn:"blur",validators:[I.required]}],lastDateOfOccupancy:["",{updateOn:"blur",validators:[I.required]}],recordId:[""],saveAndNew:[!1]})}get occupantPropertyForm(){return this.occupantPropertyFormGroup.controls}fetchEstates(){this.listOfEstates=[],this.listOfEstateBlocks=[],this.listOfOccupants=[],this.listOfEstateBlocks=[],this.settingsService.getEstates().subscribe({next:r=>{if(this.logger.info("getEstates response "+JSON.stringify(r)),r.headerResponse.responseCode!=="000"){this.alertService.error(r.headerResponse.responseMessage);return}if(r.estates.length<=0){this.alertService.showInfoMsgGeneral("No estates found"),this.logger.info("No estates found");return}this.listOfEstates=r.estates},error:r=>{this.logger.error(r),this.alertService.showInfoMsg(r)}})}fetchEstateBlocks(){this.listOfEstateBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.occupantPropertyForm.estateId.value).subscribe({next:r=>{if(this.logger.info("getEstateBlocks response "+JSON.stringify(r)),r.headerResponse.responseCode!=="000"){this.alertService.error(r.headerResponse.responseMessage);return}if(r.estateBlocks.length<=0){this.alertService.showInfoMsgGeneral("No blocks found"),this.logger.info("No blocks found "),this.occupantPropertyForm.block.setValue("No blocks found");return}this.listOfEstateBlocks=r.estateBlocks},error:r=>{this.logger.error(r.message),this.alertService.showInfoMsg(r.message)}})}fetchEstateProperties(){this.listOfEstateProperties=[],this.settingsService.getEstateProperties(this.currentUser,this.occupantPropertyForm.blockId.value,!1,"").subscribe({next:r=>{if(this.logger.info("getEstateProperties response "+JSON.stringify(r)),r.headerResponse.responseCode!=="000"){this.alertService.error(r.headerResponse.responseMessage);return}if(r.properties.length<=0){this.alertService.showInfoMsgGeneral("No properties found"),this.logger.info("No properties found "),this.occupantPropertyForm.propertyId.setValue("No properties found");return}this.listOfEstateProperties=r.properties},error:r=>{this.logger.error(r.message),this.alertService.showInfoMsg(r.message)}})}fetchOccupants(){let r=new Ge;r.dateRange=!0,r.occupantType="ALL",this.listOfOccupants=[],this.occupantsService.searchOccupants(this.currentUser,r).subscribe({next:a=>{if(this.logger.info("searchOccupants response "+JSON.stringify(a)),a.headerResponse.responseCode!=="000"){this.alertService.error(a.headerResponse.responseMessage);return}if(a.occupants.length<=0){this.alertService.showInfoMsgGeneral("No occupants found"),this.occupantPropertyForm.occupantId.setValue("No occupants found"),this.logger.info("No occupants found ");return}this.listOfOccupants=a.occupants},error:a=>{this.logger.error(a.message),this.alertService.showInfoMsg(a.message)}})}saveOccupant(){this.submitted=!0,this.alertService.clear(),!this.occupantPropertyFormGroup.invalid&&U.default.fire({title:"Confirmation",text:"Do you want to assign property assign to  occupant?",icon:"question",position:"top",showCancelButton:!0,confirmButtonText:"Yes, assign",cancelButtonText:"No, cancel"}).then(r=>{r.value?this.occupantsService.createOccupantProperty(this.currentUser,this.occupantPropertyFormGroup.value).subscribe({next:a=>{if(a.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(a.headerResponse.responseMessage);return}this.alertService.showSuccessMsg("Property assigned to occupant successfully"),this.occupantPropertyForm.saveAndNew.value||(this.addOccupantPropertyBsModalRef.hide(),this.accountService.reloadCurrentRoute()),this.occupantPropertyFormGroup.reset(),this.listOfEstateBlocks=[],this.listOfEstateProperties=[],this.listOfOccupants=[],this.submitted=!1,this.logAction("assigned property to occupant",L.OCCUPANCY)},error:a=>{this.alertService.showInfoMsg(a.message)}}):(r.dismiss,U.default.DismissReason.cancel)})}updateOccupant(){if(this.submitted=!0,this.alertService.clear(),this.occupantPropertyFormGroup.invalid)return;let r=this.occupantProperty.occupantName;U.default.fire({position:"top",title:"Confirmation",text:`Do you want to update ${r}'s property?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, update"}).then(a=>{a.value?this.occupantsService.updateOccupantProperty(this.currentUser,this.occupantPropertyFormGroup.value).subscribe({next:e=>{if(this.logger.info("updateOccupant response:"+JSON.stringify(e)),e.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(e.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(`${r} updated successfully`),this.addOccupantPropertyBsModalRef.hide(),localStorage.setItem("estate",this.occupantPropertyFormGroup.value.estateId),localStorage.setItem("estateBlock",this.occupantPropertyFormGroup.value.blockId),this.logAction(`Updated ${r}`,L.OCCUPANCY),this.accountService.reloadCurrentRoute()},error:e=>{this.alertService.showInfoMsg(e.message)}}):(a.dismiss,U.default.DismissReason.cancel)})}logAction(r,a){return G(this,null,function*(){yield this.accountService.logUserAudit(r,a)})}};s.\u0275fac=function(a){return new(a||s)(P(de),P(M),P(Ie),P(J))},s.\u0275cmp=B({type:s,selectors:[["ng-component"]],standalone:!0,features:[A],decls:81,vars:60,consts:[[1,"modal-header"],[1,"modal-title"],["type","button btn-xs","aria-label","Close",1,"close","btn-close","pull-right","border","border-gray",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],["novalidate","",3,"formGroup"],[1,"row","gy-4","mt-1"],[1,"col-sm-6"],[1,"form-group"],[3,"labelForName","labelName"],[1,"form-control-wrap"],["id","estateId","formControlName","estateId",3,"clearable","ngClass","change"],["value","","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],[4,"ngIf"],["id","blockId","formControlName","blockId",3,"clearable","ngClass","change"],["id","propertyId","formControlName","propertyId",3,"clearable","ngClass","change"],["id","occupantId","formControlName","occupantId",3,"clearable","ngClass"],["class","text-capitalize",3,"value",4,"ngFor","ngForOf"],["styleClass","w-100","formControlName","firstDateOfOccupancy","id","firstDateOfOccupancy","dateFormat","dd-mm-yy",3,"showIcon","ngClass"],["styleClass","w-100","formControlName","lastDateOfOccupancy","id","lastDateOfOccupancy","dateFormat","dd-mm-yy",3,"showIcon","ngClass"],[1,"col-sm-12"],[1,"form-check-label",3,"labelForName","labelName"],[1,"custom-control-group"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"row","my-4"],[1,"bi-hr"],[1,"col-sm-5"],["class","custom-control custom-control-sm custom-checkbox checked",4,"ngIf"],[1,"col-sm-3"],[1,"col-sm-2"],["type","button","title","","data-bs-dismiss","modal",1,"btn","btn-outline-light","btn-sm",3,"click"],["class","btn btn-primary btn-sm",3,"title","click",4,"ngIf"],[3,"value"],[1,"text-capitalize",3,"value"],[1,"custom-control","custom-radio","custom-control-pro","no-control"],["formControlName","occupationType","name","occupationType","type","radio",1,"custom-control-input","form-check-input",3,"id","value","ngClass"],[1,"custom-control-label","form-check-label",3,"for"],[1,"text-danger"],[1,"custom-control","custom-control-sm","custom-checkbox","checked"],["type","checkbox","formControlName","saveAndNew","id","saveAndNew","id","saveAndNew",1,"custom-control-input"],["for","saveAndNew",1,"custom-control-label","fw-bolder"],[1,"btn","btn-primary","btn-sm",3,"title","click"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"h6",1),i(2),g(3,"titlecase"),n(),t(4,"button",2),d("click",function(){return e.addOccupantPropertyBsModalRef==null?null:e.addOccupantPropertyBsModalRef.hide()}),t(5,"span",3),i(6,"\xD7"),n()()(),t(7,"div",4),u(8,"app-required-fields-notice"),t(9,"form",5)(10,"div",6)(11,"div",7)(12,"div",8),u(13,"app-form-label",9),t(14,"div",10)(15,"ng-select",11),d("change",function(){return e.fetchEstateBlocks()}),t(16,"ng-option",12),i(17,"Select Estate"),n(),h(18,et,2,2,"ng-option",13),n(),t(19,"span",14),h(20,tt,2,0,"div",15),n()()()(),t(21,"div",7)(22,"div",8),u(23,"app-form-label",9),t(24,"div",10)(25,"ng-select",16),d("change",function(){return e.fetchEstateProperties()}),t(26,"ng-option",12),i(27,"Select Block"),n(),h(28,nt,2,2,"ng-option",13),n(),t(29,"span",14),h(30,rt,2,0,"div",15),n()()()(),t(31,"div",7)(32,"div",8),u(33,"app-form-label",9),t(34,"div",10)(35,"ng-select",17),d("change",function(){return e.fetchOccupants()}),t(36,"ng-option",12),i(37,"Select Property"),n(),h(38,it,2,2,"ng-option",13),n(),t(39,"span",14),h(40,ot,2,0,"div",15),n()()()(),t(41,"div",7)(42,"div",8),u(43,"app-form-label",9),t(44,"div",10)(45,"ng-select",18)(46,"ng-option",12),i(47,"Select Occupant"),n(),h(48,at,2,2,"ng-option",19),n(),t(49,"span",14),h(50,lt,2,0,"div",15),n()()()(),t(51,"div",7)(52,"div",8),u(53,"app-form-label",9)(54,"p-calendar",20),t(55,"span",14),h(56,ct,2,0,"span",15),n()()(),t(57,"div",7)(58,"div",8),u(59,"app-form-label",9)(60,"p-calendar",21),t(61,"span",14),h(62,pt,2,0,"span",15),n()()(),t(63,"div",22)(64,"div",8),u(65,"app-form-label",23),t(66,"div",10)(67,"ul",24),h(68,st,5,7,"li",25),n(),h(69,ut,2,0,"div",26),n()()()(),t(70,"div",27),u(71,"hr",28),t(72,"div",29),h(73,mt,4,0,"div",30),n(),u(74,"div",31),t(75,"div",32)(76,"button",33),d("click",function(){return e.addOccupantPropertyBsModalRef==null?null:e.addOccupantPropertyBsModalRef.hide()}),i(77," Close "),n()(),t(78,"div",32),h(79,dt,2,1,"button",34)(80,ft,2,1,"button",34),n()()()()),a&2&&(l(2),y(S(3,44,e.headerMsg)),l(7),p("formGroup",e.occupantPropertyFormGroup),l(4),p("labelForName","estateId")("labelName","Estates"),l(2),p("clearable",!1)("ngClass",E(46,N,((e.occupantPropertyForm.estateId==null?null:e.occupantPropertyForm.estateId.touched)||(e.occupantPropertyForm.estateId==null?null:e.occupantPropertyForm.estateId.dirty)||e.submitted)&&(e.occupantPropertyForm.estateId==null?null:e.occupantPropertyForm.estateId.errors))),l(3),p("ngForOf",e.listOfEstates),l(2),p("ngIf",e.occupantPropertyForm.estateId==null||e.occupantPropertyForm.estateId.errors==null?null:e.occupantPropertyForm.estateId.errors.required),l(3),p("labelForName","blockId")("labelName","Estate Blocks"),l(2),p("clearable",!1)("ngClass",E(48,N,((e.occupantPropertyForm.blockId==null?null:e.occupantPropertyForm.blockId.touched)||(e.occupantPropertyForm.blockId==null?null:e.occupantPropertyForm.blockId.dirty)||e.submitted)&&(e.occupantPropertyForm.blockId==null?null:e.occupantPropertyForm.blockId.errors))),l(3),p("ngForOf",e.listOfEstateBlocks),l(2),p("ngIf",e.occupantPropertyForm.blockId==null||e.occupantPropertyForm.blockId.errors==null?null:e.occupantPropertyForm.blockId.errors.required),l(3),p("labelForName","propertyId")("labelName","Estate Properties"),l(2),p("clearable",!1)("ngClass",E(50,ht,e.occupantPropertyForm.propertyId==null?null:e.occupantPropertyForm.propertyId.valid))("ngClass",E(52,N,((e.occupantPropertyForm.propertyId==null?null:e.occupantPropertyForm.propertyId.touched)||(e.occupantPropertyForm.propertyId==null?null:e.occupantPropertyForm.propertyId.dirty)||e.submitted)&&(e.occupantPropertyForm.propertyId==null?null:e.occupantPropertyForm.propertyId.errors))),l(3),p("ngForOf",e.listOfEstateProperties),l(2),p("ngIf",e.occupantPropertyForm.propertyId==null||e.occupantPropertyForm.propertyId.errors==null?null:e.occupantPropertyForm.propertyId.errors.required),l(3),p("labelForName","occupantId")("labelName","Occupants"),l(2),p("clearable",!1)("ngClass",E(54,N,((e.occupantPropertyForm.occupantId==null?null:e.occupantPropertyForm.occupantId.touched)||(e.occupantPropertyForm.occupantId==null?null:e.occupantPropertyForm.occupantId.dirty)||e.submitted)&&(e.occupantPropertyForm.occupantId==null?null:e.occupantPropertyForm.occupantId.errors))),l(3),p("ngForOf",e.listOfOccupants),l(2),p("ngIf",e.occupantPropertyForm.occupantId==null||e.occupantPropertyForm.occupantId.errors==null?null:e.occupantPropertyForm.occupantId.errors.required),l(3),p("labelForName","firstDateOfOccupancy")("labelName","First Date  Of Occupancy"),l(1),p("showIcon",!0)("ngClass",E(56,N,((e.occupantPropertyForm.firstDateOfOccupancy==null?null:e.occupantPropertyForm.firstDateOfOccupancy.touched)||(e.occupantPropertyForm.firstDateOfOccupancy==null?null:e.occupantPropertyForm.firstDateOfOccupancy.dirty)||e.submitted)&&(e.occupantPropertyForm.firstDateOfOccupancy==null?null:e.occupantPropertyForm.firstDateOfOccupancy.errors))),l(2),p("ngIf",e.occupantPropertyForm.firstDateOfOccupancy==null||e.occupantPropertyForm.firstDateOfOccupancy.errors==null?null:e.occupantPropertyForm.firstDateOfOccupancy.errors.required),l(3),p("labelForName","lastDateOfOccupancy")("labelName","Last Date  Of Occupancy"),l(1),p("showIcon",!0)("ngClass",E(58,N,((e.occupantPropertyForm.lastDateOfOccupancy==null?null:e.occupantPropertyForm.lastDateOfOccupancy.touched)||(e.occupantPropertyForm.lastDateOfOccupancy==null?null:e.occupantPropertyForm.lastDateOfOccupancy.dirty)||e.submitted)&&(e.occupantPropertyForm.lastDateOfOccupancy==null?null:e.occupantPropertyForm.lastDateOfOccupancy.errors))),l(2),p("ngIf",e.occupantPropertyForm.lastDateOfOccupancy==null||e.occupantPropertyForm.lastDateOfOccupancy.errors==null?null:e.occupantPropertyForm.lastDateOfOccupancy.errors.required),l(3),p("labelForName","occupationType")("labelName","Occupancy Type"),l(3),p("ngForOf",e.listOfProOccupantTypes),l(1),p("ngIf",e.submitted&&(e.occupantPropertyForm.occupationType.errors==null?null:e.occupantPropertyForm.occupationType.errors.required)),l(4),p("ngIf",e.isAddMode),l(6),p("ngIf",!e.isAddMode),l(1),p("ngIf",e.isAddMode))},dependencies:[R,ue,$,D,j,Me,_e,Y,ye,Pe,H,ge,Oe,Se,De,K,Q,Fe,W,Be,ne,te,ee],encapsulation:2});let c=s;return c})();var ie=class{};function yt(c,s){if(c&1&&(k(0),t(1,"li")(2,"span",11),i(3,"Institution Name"),n(),i(4," - "),t(5,"span",12),i(6),n()(),t(7,"li")(8,"span",11),i(9,"Mobile No."),n(),i(10," - "),t(11,"span",12),i(12),n()(),t(13,"li")(14,"span",11),i(15,"Telephone"),n(),i(16," - "),t(17,"span",12),i(18),n()(),t(19,"li")(20,"span",11),i(21,"Email"),n(),i(22," - "),t(23,"span",12),i(24),n()(),t(25,"li")(26,"span",11),i(27,"Address"),n(),i(28," - "),t(29,"span",12),i(30),n()(),T()),c&2){let o=f();l(6),y(o.occupantProperty==null?null:o.occupantProperty.propertyName),l(6),y(o.occupantProperty==null?null:o.occupantProperty.mobileNo),l(6),y(o.occupantProperty==null?null:o.occupantProperty.mobileNo),l(6),y(o.occupantProperty==null?null:o.occupantProperty.emailAddress),l(6),y(o.occupantProperty==null?null:o.occupantProperty.localAddress)}}function gt(c,s){if(c&1&&(k(0),t(1,"li")(2,"span",11),i(3,"Full Name"),n(),i(4," - "),t(5,"span",12),i(6),n()(),t(7,"li")(8,"span",11),i(9,"Mobile No."),n(),i(10," - "),t(11,"span",12),i(12),n()(),T()),c&2){let o=f();l(6),y(o.occupantProperty==null?null:o.occupantProperty.propertyName),l(6),y(o.occupantProperty==null?null:o.occupantProperty.mobileNo)}}var He=(()=>{let s=class s{constructor(r,a){this.viewOccupantPropertyBsModalRef=r,this.accountService=a,this.accountService.currentUser.subscribe(e=>this.currentUser=e)}ngOnInit(){this.viewOccupantPropertyBsModalRef.setClass("gray modal-md modal-dialog-top")}};s.\u0275fac=function(a){return new(a||s)(P(M),P(V))},s.\u0275cmp=B({type:s,selectors:[["ng-component"]],standalone:!0,features:[A],decls:70,vars:24,consts:[[1,"modal-header"],[1,"modal-title"],["type","button btn-xs","aria-label","Close",1,"close","btn-close","pull-right","border","border-gray",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"card","card-no-border"],[1,"pricing-body"],[1,"pricing-features"],[1,"preview-title-lg","overline-title"],[4,"ngIf"],[1,"preview-title-lg","overline-title","my-2"],[1,"w-50"],[1,"ms-auto"],[1,"row","my-3","mx-2","mb-3","justify-content-end"],[1,"col-auto"],[1,"btn","btn-sm","btn-primary",3,"click"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"h6",1),i(2),n(),t(3,"button",2),d("click",function(){return e.viewOccupantPropertyBsModalRef==null?null:e.viewOccupantPropertyBsModalRef.hide()}),t(4,"span",3),i(5,"\xD7"),n()()(),t(6,"div",4)(7,"div",5)(8,"div",6)(9,"ul",7)(10,"span",8),i(11,"Occupant Information"),n(),h(12,yt,31,5,"ng-container",9)(13,gt,13,2,"ng-container",9),t(14,"span",10),i(15,"Property Information"),n(),t(16,"li")(17,"span",11),i(18,"Property Name"),n(),i(19," - "),t(20,"span",12),i(21),n()(),t(22,"li")(23,"span",11),i(24,"Size"),n(),i(25," - "),t(26,"span",12),i(27),g(28,"number"),n()(),t(29,"li")(30,"span",11),i(31,"Occupancy Type"),n(),i(32," - "),t(33,"span",12),i(34),n()(),t(35,"span",10),i(36,"User activities"),n(),t(37,"li")(38,"span",11),i(39,"Created By"),n(),i(40," - "),t(41,"span",12),i(42),n()(),t(43,"li")(44,"span",11),i(45,"Created Date"),n(),i(46," - "),t(47,"span",12),i(48),g(49,"date"),g(50,"timeAgo"),n()(),t(51,"li")(52,"span",11),i(53,"Last Modified By"),n(),i(54," - "),t(55,"span",12),i(56),n()(),t(57,"li")(58,"span",11),i(59,"Modified Date"),n(),i(60," - "),t(61,"span",12),i(62),g(63,"date"),g(64,"timeAgo"),n()()()()()(),t(65,"div",13)(66,"div",14)(67,"a",15),d("click",function(){return e.viewOccupantPropertyBsModalRef==null?null:e.viewOccupantPropertyBsModalRef.hide()}),t(68,"span"),i(69,"Close"),n()()()()),a&2&&(l(2),C("",e.occupantProperty==null?null:e.occupantProperty.propertyName," Details"),l(10),p("ngIf",e.occupantProperty==null?null:e.occupantProperty.institutional),l(1),p("ngIf",!(e.occupantProperty!=null&&e.occupantProperty.institutional)),l(8),y(e.occupantProperty==null?null:e.occupantProperty.propertyName),l(6),y(S(28,12,e.occupantProperty==null?null:e.occupantProperty.propertySize)),l(7),y(e.occupantProperty==null?null:e.occupantProperty.occupationType),l(8),y(e.occupantProperty==null?null:e.occupantProperty.createdBy),l(6),q("",w(49,14,e.occupantProperty==null?null:e.occupantProperty.createdDate,"medium")," ,",S(50,17,e.occupantProperty==null?null:e.occupantProperty.createdDate.toString()),""),l(8),y(e.occupantProperty==null?null:e.occupantProperty.createdBy),l(6),q("",w(63,19,e.occupantProperty==null?null:e.occupantProperty.lastModifiedDate,"medium")," ,",S(64,22,e.occupantProperty==null?null:e.occupantProperty.lastModifiedDate.toString()),""))},dependencies:[R,D,me,z,Ve],encapsulation:2});let c=s;return c})();function vt(c,s){if(c&1){let o=b();t(0,"div",5)(1,"div",8)(2,"label",32),i(3),n(),u(4,"br"),t(5,"input",33),d("ngModelChange",function(a){v(o);let e=f(2);return _(e.searchValue=a)}),n()()()}if(c&2){let o=f(2);l(3),y(o.searchParameterLabel),l(2),ce("placeholder","Enter ",o.searchParameterLabel,""),p("ngModel",o.searchValue)}}function _t(c,s){if(c&1){let o=b();k(0),t(1,"div",5)(2,"div",6)(3,"label",26),i(4,"Search By"),n(),u(5,"br"),t(6,"div",8)(7,"div",9)(8,"select",27),d("ngModelChange",function(a){v(o);let e=f();return _(e.searchParameter=a)})("change",function(){v(o);let a=f();return _(a.searchParameterListener())}),t(9,"option",28),i(10,"Name"),n(),t(11,"option",29),i(12,"Mobile No."),n(),t(13,"option",30),i(14,"Email"),n()()()()()(),h(15,vt,6,3,"div",31),T()}if(c&2){let o=f();l(8),p("ngModel",o.searchParameter),l(7),p("ngIf",o.searchParameter)}}function Pt(c,s){if(c&1&&(t(0,"ng-option",40),i(1),n()),c&2){let o=s.$implicit;p("value",o.recordId),l(1),C(" ",o.estateName," ")}}function Ot(c,s){if(c&1&&(t(0,"ng-option",40),i(1),n()),c&2){let o=s.$implicit;p("value",o.recordId),l(1),C(" ",o.block," ")}}function St(c,s){if(c&1){let o=b();k(0),t(1,"div",34)(2,"div",6),u(3,"app-form-label",35),t(4,"div",8)(5,"ng-select",36),d("ngModelChange",function(a){v(o);let e=f();return _(e.estate=a)})("change",function(){v(o);let a=f();return _(a.fetchEstateBlocks())}),t(6,"ng-option",37),i(7,"Select Estate"),n(),h(8,Pt,2,2,"ng-option",38),n()()()(),t(9,"div",5)(10,"div",6),u(11,"app-form-label",35),t(12,"div",8)(13,"ng-select",39),d("ngModelChange",function(a){v(o);let e=f();return _(e.block=a)})("change",function(){v(o);let a=f();return _(a.fetchOccupantProperties())}),t(14,"ng-option",37),i(15,"Select Block"),n(),h(16,Ot,2,2,"ng-option",38),n()()()(),T()}if(c&2){let o=f();l(3),p("labelForName","estate")("labelName","Estates"),l(2),p("clearable",!1)("ngModel",o.estate),l(3),p("ngForOf",o.listOfEstates),l(3),p("labelForName","block")("labelName","Blocks"),l(2),p("clearable",!1)("ngModel",o.block),l(3),p("ngForOf",o.listOfEstateBlocks)}}function bt(c,s){if(c&1){let o=b();t(0,"div",14)(1,"a",41),d("click",function(){v(o);let a=f();return _(a.export())}),u(2,"em",42),t(3,"span"),i(4,"Export"),n()()()}}function Ct(c,s){if(c&1){let o=b();t(0,"div",14)(1,"div",43)(2,"a",44),u(3,"em",42),t(4,"span"),i(5,"Export"),n()(),t(6,"div",45)(7,"ul",46)(8,"li")(9,"a",47),d("click",function(){v(o);let a=f();return _(a.export())}),u(10,"em",48),t(11,"span"),i(12,"Excel"),n()()(),t(13,"li")(14,"a",49),u(15,"em",50),t(16,"span"),i(17,"PDF"),n()()()()()()()}}function Et(c,s){c&1&&(t(0,"tr")(1,"th"),i(2,"SN"),n(),t(3,"th"),i(4,"Occupant"),n(),t(5,"th"),i(6,"Property"),n(),t(7,"th"),i(8,"Usage"),n(),t(9,"th"),i(10,"Block"),n(),t(11,"th"),i(12,"Occupation Period"),n(),t(13,"th"),i(14,"Duration Left"),n(),t(15,"th"),i(16,"Occupation Status"),n(),t(17,"th"),i(18,"Actions"),n()())}function It(c,s){if(c&1){let o=b();t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),u(4,"app-full-name",51),n(),t(5,"td"),u(6,"app-full-name",51),g(7,"titlecase"),n(),t(8,"td",52),i(9),g(10,"removeHyphen"),g(11,"titlecase"),n(),t(12,"td"),i(13),n(),t(14,"td"),i(15),g(16,"date"),g(17,"cleanDate"),g(18,"date"),g(19,"cleanDate"),n(),t(20,"td"),i(21),n(),t(22,"td"),i(23),n(),t(24,"td")(25,"div",53)(26,"a",54),u(27,"em",55),n(),t(28,"div",56)(29,"ul",46)(30,"li")(31,"a",47),d("click",function(){let e=v(o).$implicit,m=f();return _(m.openOccupantPropertyModalComponent(e,!1))}),u(32,"em",57),t(33,"span"),i(34,"Edit occupancy"),n()()(),t(35,"li")(36,"a",47),d("click",function(){let e=v(o).$implicit,m=f();return _(m.openViewOccupantModalComponent(e))}),u(37,"em",58),t(38,"span"),i(39,"View occupancy"),n()()(),u(40,"li",59),t(41,"li")(42,"a",60),d("click",function(){let e=v(o).$implicit,m=f();return _(m.deleteOccupant(e))}),u(43,"em",61),t(44,"span"),i(45,"Delete"),n()()()()()()()()}if(c&2){let o=s.$implicit,r=s.rowIndex;l(2),y(r+1),l(2),F("fullName",o==null?null:o.occupantName),F("otherFieldName",o==null?null:o.institutionalDisplayName),p("showAvatar",!0),l(2),F("fullName",o==null?null:o.propertyName),pe("otherFieldName","",S(7,14,o==null?null:o.occupationType)," (",o==null?null:o.propertyNo,")"),p("showAvatar",!1),l(3),y(S(10,16,S(11,18,o==null?null:o.propertyUsage))),l(4),y(o.blockName),l(2),q(" ",w(16,20,S(17,23,o==null?null:o.firstDateOfOccupancy),"mediumDate")," -- ",w(18,25,S(19,28,o==null?null:o.lastDateOfOccupancy),"mediumDate")," "),l(6),y(o.durationLeft),l(2),y(o.validity)}}var Mt=()=>[5,10,25,50],Tn=(()=>{let s=class s{constructor(r,a,e,m,x,Ke){this.logger=r,this.addOccupantPropertyBsModalRef=a,this.addInstitutionOccupantBsModalRef=e,this.viewOccupantPropertyBsModalRef=m,this.addOccupantPropertyModalService=x,this.institutionOccupantModalService=Ke,this.searchParameter="NAM",this.showOccupantSearchBy=!0,this.settingsService=O(Z),this.excelExporterService=O($e),this.accountService=O(V),this.alertService=O(X),this.utilsService=O(he),this.occupantsService=O(re),this.accountService.currentUser.subscribe(Xe=>this.currentUser=Xe)}ngOnInit(){this.block=localStorage.getItem("estateBlock")??"A",this.block!=="A"?(this.searchBy="BAB",this.estate=localStorage.getItem("estate"),this.fetchEstates(),this.fetchEstateBlocks(),this.fetchOccupantProperties()):(this.estate="A",this.block="A",this.searchParameter="PROP",this.searchBy=="PNAM",this.searchBy="OCC",this.searchParameter=="NAM",this.startDate=this.utilsService.getFirstDayDate(),this.endDate=new Date,this.searchParameterListener())}ngOnDestroy(){this.addOccupantPropertyModalService.hide(),oe.default.close()}searchByListener(){this.searchBy=="BAB"&&(this.estate="A",this.block="A",this.fetchEstates(),this.listOfEstateBlocks=[]),this.listOfOccupantProperties=[]}searchParameterListener(){if(this.searchParameter=="MOB"){this.searchParameterLabel="Mobile Number";return}if(this.searchParameter=="NAM"){this.searchParameterLabel="Occupant Name";return}if(this.searchParameter=="EMAIL"){this.searchParameterLabel="Email Address";return}}fetchOccupantProperties(){this.listOfOccupantProperties=[];let r=new ie;r.block="",r.searchBy=this.searchBy,r.searchParameter=this.searchParameter,r.searchValue=this.searchValue,this.searchBy=="BAB"&&(r.searchValue="",r.block=this.block,r.searchParameter="",r.searchValue=""),this.occupantsService.searchOccupantProperties(this.currentUser,r).subscribe({next:a=>{if(this.logger.info("searchOccupants response "+JSON.stringify(a)),a.headerResponse.responseCode!=="000"){this.alertService.error(a.headerResponse.responseMessage);return}if(a.occupantProperties.length<=0){this.alertService.showInfoMsgGeneral("No occupant properties found"),this.logger.info("No occupant properties found");return}this.listOfOccupantProperties=a.occupantProperties},error:a=>{this.logger.error(a),this.alertService.showInfoMsg(a)}})}export(){this.excelExporterService.exportAsExcelFile(this.listOfOccupantProperties,"occupantProperties")}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:r=>{if(this.logger.info("getEstates response "+JSON.stringify(r)),r.headerResponse.responseCode!=="000"){this.alertService.error(r.headerResponse.responseMessage);return}if(r.estates.length<=0){this.alertService.showInfoMsgGeneral("No zones found"),this.logger.info("No zones found");return}this.listOfEstates=r.estates},error:r=>{this.logger.error(r),this.alertService.showInfoMsg(r)}})}fetchEstateBlocks(){this.listOfEstateBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.estate).subscribe({next:r=>{if(this.logger.info("getEstates response "+JSON.stringify(r)),r.headerResponse.responseCode!=="000"){this.alertService.error(r.headerResponse.responseMessage);return}if(r.estateBlocks.length<=0){this.alertService.showInfoMsgGeneral("No blocks found"),this.logger.info("No blocks found ");return}this.listOfEstateBlocks=r.estateBlocks},error:r=>{this.logger.error(r.message),this.alertService.showInfoMsg(r.message)}})}deleteOccupant(r){let a=r.occupantName;oe.default.fire({position:"top",title:"Confirmation",text:`Do you want to delete ${a}?`,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancel",confirmButtonText:"Yes, delete"}).then(e=>{e.value?this.occupantsService.deleteOccupantProperty(this.currentUser,r.recordId).subscribe({next:m=>{if(this.logger.info("deleteOccupant response:"+JSON.stringify(m)),m.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(m.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(`${a} deleted successfully`),this.addInstitutionOccupantBsModalRef.hide(),this.logAction(`Updated ${a}`,L.OCCUPANCY),this.accountService.reloadCurrentRoute()},error:m=>{this.alertService.showInfoMsg(m.message)}}):(e.dismiss,oe.default.DismissReason.cancel)})}openOccupantPropertyModalComponent(r,a){let e={initialState:{isAddMode:a,occupantProperty:r}};this.addOccupantPropertyModalService.config.ignoreBackdropClick=!0,this.addOccupantPropertyModalService.config.animated=!0,this.addOccupantPropertyBsModalRef=this.addOccupantPropertyModalService.show(Ye,e),this.addOccupantPropertyBsModalRef.content.closeBtnName="Close"}openInstitutionModalComponent(r,a){let e={initialState:{isAddMode:a,occupant:r}};this.institutionOccupantModalService.config.ignoreBackdropClick=!0,this.institutionOccupantModalService.config.animated=!0,this.addInstitutionOccupantBsModalRef=this.institutionOccupantModalService.show(Ue,e),this.addInstitutionOccupantBsModalRef.content.closeBtnName="Close"}openViewOccupantModalComponent(r){let a={initialState:{occupantProperty:r}};this.institutionOccupantModalService.config.ignoreBackdropClick=!0,this.institutionOccupantModalService.config.animated=!0,this.viewOccupantPropertyBsModalRef=this.institutionOccupantModalService.show(He,a),this.viewOccupantPropertyBsModalRef.content.closeBtnName="Close"}logAction(r,a){return G(this,null,function*(){yield this.accountService.logUserAudit(r,a)})}};s.\u0275fac=function(a){return new(a||s)(P(J),P(M),P(M),P(M),P(ae),P(ae))},s.\u0275cmp=B({type:s,selectors:[["ng-component"]],standalone:!0,features:[A],decls:38,vars:18,consts:[[3,"pageTitleName"],[1,"newItemName"],[1,"btn","btn-primary",3,"click"],[1,"icon","ni","ni-plus"],[1,"row","gy-2","gx-2","mt-5","mb-4","align-items-center"],[1,"col-sm-2"],[1,"form-group"],["for","startsearchByDate",1,"form-label","pt-0"],[1,"form-control-wrap"],[1,"form-control-select"],["id","searchBy",1,"form-control",3,"ngModel","ngModelChange","change"],["value","OCC","selected","",1,"fs-6"],["value","BAB"],[4,"ngIf"],[1,"col-auto"],["type","button","title","",1,"btn","btn-dim","btn-primary","mt-4",3,"click"],["class","col-auto",4,"ngIf"],["class","col-auto ",4,"ngIf"],[1,"row","gy-2","gx-3","my-3"],[1,"form-icon","form-icon-right"],[1,"icon","ni","ni-search"],["type","text","autocomplete","off","id","default-04","placeholder","Quick search",1,"form-control",3,"ngModel","ngModelChange"],["responsiveLayout","scroll","sortMode","multiple","responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","scrollDirection","both",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","resizableColumns","autoLayout"],["dt1",""],["pTemplate","header"],["pTemplate","body"],["for","searchParameter",1,"form-label","pt-0"],["id","searchParameter",1,"form-control",3,"ngModel","ngModelChange","change"],["value","NAM"],["value","MOB"],["value","EMAIL"],["class","col-sm-2",4,"ngIf"],["for","startDate",1,"form-label","pt-0"],["type","text","autocomplete","off","id","default-04",1,"form-control",3,"placeholder","ngModel","ngModelChange"],[1,"col-sm-3"],[3,"labelForName","labelName"],["id","estate",3,"clearable","ngModel","ngModelChange","change"],["value","A","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],["id","block",3,"clearable","ngModel","ngModelChange","change"],[3,"value"],[1,"btn","mt-4","btn-outline-light",3,"click"],[1,"icon","ni","ni-download"],[1,"dropdown","mt-4"],["href","#","data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-outline-light"],[1,"dropdown-menu"],[1,"link-list-opt","no-bdr"],[3,"click"],[1,"icon","ni","ni-file-xls","text-primary"],[2,"cursor","not-allowed"],[1,"icon","ni","ni-file-pdf"],[3,"showAvatar","fullName","otherFieldName"],[1,"text-capitalize"],[1,"drodown"],["data-bs-toggle","dropdown","aria-expanded","false",1,"dropdown-toggle","btn","btn-icon","btn-light"],[1,"icon","ni","ni-more-h"],[1,"dropdown-menu","dropdown-menu-end"],[1,"icon","ni","ni-edit"],[1,"icon","ni","ni-eye"],[1,"divider"],[1,"text-danger",3,"click"],[1,"icon","ni","ni-trash"]],template:function(a,e){a&1&&(t(0,"app-add-item",0),i(1,` [description]="'Defines the contract between occupant, properties and estate company'"> `),t(2,"span",1)(3,"a",2),d("click",function(){return e.openOccupantPropertyModalComponent(null,!0)}),u(4,"em",3),t(5,"span"),i(6,"Add occupant property"),n()()()(),t(7,"div",4)(8,"div",5)(9,"div",6)(10,"label",7),i(11,"Search Parameter"),n(),u(12,"br"),t(13,"div",8)(14,"div",9)(15,"select",10),d("ngModelChange",function(x){return e.searchBy=x})("change",function(){return e.searchByListener()}),t(16,"option",11),i(17,"Occupant"),n(),t(18,"option",12),i(19,"Estate & block"),n()()()()()(),h(20,_t,16,2,"ng-container",13)(21,St,17,10,"ng-container",13),t(22,"div",14)(23,"button",15),d("click",function(){return e.fetchOccupantProperties()}),i(24," Search "),n()(),h(25,bt,5,0,"div",16)(26,Ct,18,0,"div",17),n(),t(27,"div",18)(28,"div",14)(29,"div",8)(30,"div",19),u(31,"em",20),n(),t(32,"input",21),d("ngModelChange",function(x){return e.searchedKeyword=x}),n()()()(),t(33,"p-table",22,23),g(35,"filter"),h(36,Et,19,0,"ng-template",24)(37,It,46,30,"ng-template",25),n()),a&2&&(p("pageTitleName","Occupants Properties"),l(15),p("ngModel",e.searchBy),l(5),p("ngIf",e.searchBy=="OCC"),l(1),p("ngIf",e.searchBy=="BAB"),l(4),p("ngIf",!1),l(1),p("ngIf",(e.listOfOccupantProperties==null?null:e.listOfOccupantProperties.length)>0),l(6),p("ngModel",e.searchedKeyword),l(1),p("value",w(35,14,e.listOfOccupantProperties,e.searchedKeyword))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",se(17,Mt))("resizableColumns",!0)("autoLayout",!0))},dependencies:[R,$,D,j,z,Q,ne,te,ee,K,Ce,Ee,Y,be,H,ve,W,Ne,Ae,Te,ke,Re,we,Le,qe],encapsulation:2});let c=s;return c})();export{Tn as OccupantPropertyComponent};
