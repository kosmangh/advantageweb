import{a as re}from"./chunk-YZRYK4HC.js";import"./chunk-7PXYQJAM.js";import{d as z}from"./chunk-PLAPZAN2.js";import{a as ee,b as te,c as le}from"./chunk-QQMX5O62.js";import{a as W}from"./chunk-T45HSKH6.js";import{d as x}from"./chunk-WH3N5QDN.js";import{s as K,t as Q}from"./chunk-KPCRGR73.js";import{h as Z}from"./chunk-543WOPA4.js";import"./chunk-5WO4BOAD.js";import{a as X}from"./chunk-NEQ5BFSP.js";import{b as w,c as T,e as g,f as q,g as P,l as H,m as G,o as V,p as D,u as j,v as L,w as $,x as J}from"./chunk-B2QESFZG.js";import{b as de,c as U}from"./chunk-R55IMLXW.js";import{b as R,d as Y,f as O,g as A}from"./chunk-IHPVOZWG.js";import"./chunk-HPGLX4ZN.js";import"./chunk-7DWKZ4XI.js";import{Eb as d,Gb as h,Hb as _,Ic as M,Kc as N,Lc as E,Mb as C,Ob as u,Sa as n,Ta as f,Uc as k,bb as i,ib as p,la as I,nb as t,ob as r,pb as s,wb as F}from"./chunk-QRSQYA3Q.js";import{d as me,e as y}from"./chunk-5FZOKLP6.js";var S=me(de());function pe(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m.recordId),n(1),h(" ",m.estateName," ")}}function ue(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}function ce(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m.recordId),n(1),h(" ",m.block," ")}}function fe(l,a){l&1&&(t(0,"div",35),s(1,"app-required-field"),r())}function ge(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m.recordId),n(1),_(" ",m.propertyName," ",m.recordId," ")}}function ve(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}function he(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}function Be(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m),n(1),h(" ",m," ")}}function Fe(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}function be(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m),n(1),h(" ",m," ")}}function Se(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}function ye(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m),n(1),h(" ",m," ")}}function Ie(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}function _e(l,a){if(l&1&&(t(0,"ng-option",34),d(1),r()),l&2){let m=a.$implicit;i("value",m),n(1),h(" ",m," ")}}function Ce(l,a){l&1&&(t(0,"div"),s(1,"app-required-field"),r())}var v=l=>({"is-invalid":l}),b=l=>({"is-valid":l}),Ke=(()=>{let a=class a{constructor(o,c,e,B,ne,ie,oe,ae){this.rentBillingService=o,this.utilsService=c,this.settingsService=e,this.addRentalBillBsModalRef=B,this.fb=ne,this.accountService=ie,this.alertService=oe,this.logger=ae,this.submitted=!1,this.accountService.currentUser.subscribe(se=>this.currentUser=se)}ngOnInit(){this.fetchEstates(),this.createNewForm(),this.listOfChargeYears=this.utilsService.getChargeYears(),this.listOfMonths=this.utilsService.getMonthsOfYear()}createNewForm(){this.rentalBillFormGroup=this.fb.group({estateId:["",[g.required]],blockId:["",[g.required]],propertyId:["",[g.required]],rentAmount:["",[g.required]],startYear:["",[g.required]],startMonth:["",[g.required]],endMonth:["",[g.required]],endYear:["",[g.required]],recordId:[""],billingType:["PROP"],saveAndNew:[!1]}),this.rentalBillForm.startMonth.setValue(this.utilsService.getLastMonthName()),this.rentalBillForm.startYear.setValue(this.utilsService.getLastDayOfPreviousMonth().getFullYear()),this.rentalBillForm.endMonth.setValue(this.utilsService.getCurrentMonthName()),this.rentalBillForm.endYear.setValue(new Date().getFullYear())}get rentalBillForm(){return this.rentalBillFormGroup.controls}resetRentalBill(){this.createNewForm()}applyBackRentalBill(){if(this.submitted=!0,this.rentalBillFormGroup.invalid)return;let o=this.listOfProperties.find(c=>c.recordId===this.rentalBillForm.propertyId.value)?.propertyName;S.default.fire({title:"Confirmation",text:`Do you want to apply ground rent bill for  ${o} property?`,icon:"question",position:"top",showCancelButton:!0,confirmButtonText:"Yes, create",cancelButtonText:"No, cancel"}).then(c=>{c.value?(this.alertService.clear(),this.rentBillingService.applyBackRentalBill(this.currentUser,this.rentalBillFormGroup.value).subscribe({next:e=>{if(e.headerResponse.responseCode!=="000"){this.alertService.showErrorMsg(e.headerResponse.responseMessage);return}this.alertService.showSuccessMsg(e.headerResponse.responseMessage),this.rentalBillFormGroup.reset(),this.rentalBillFormGroup.patchValue({billingType:"PROP",startMonth:this.utilsService.getLastMonthName(),startYear:this.utilsService.getLastDayOfPreviousMonth().getFullYear(),endMonth:this.utilsService.getCurrentMonthName(),endYear:new Date().getFullYear()}),this.submitted=!1,this.logAction(`Applied ground rent bill for ${o}`,Y.ESTATE_BILLING)},error:e=>{this.alertService.showInfoMsg(e)}})):(c.dismiss,S.default.DismissReason.cancel)})}fetchEstates(){this.listOfEstates=[],this.settingsService.getEstates().subscribe({next:o=>{if(this.logger.info("getEstates response "+JSON.stringify(o)),o.headerResponse.responseCode!=="000"){this.alertService.error(o.headerResponse.responseMessage);return}if(o.estates.length<=0){this.alertService.showInfoMsgGeneral("No estates found"),this.logger.info("No estates found");return}this.listOfEstates=o.estates},error:o=>{this.logger.error(o),this.alertService.showInfoMsg(o)}})}fetchBlocks(){this.listOfBlocks=[],this.settingsService.getEstateBlocks(this.currentUser,this.rentalBillForm.estateId.value).subscribe({next:o=>{if(o.headerResponse.responseCode!=="000"){this.alertService.error(o.headerResponse.responseMessage);return}if(o.estateBlocks.length<=0){this.alertService.showInfoMsgGeneral("No blocks found");return}this.listOfBlocks=o.estateBlocks},error:o=>{this.alertService.showInfoMsg(o)}})}fetchEstateProperties(){this.listOfProperties=[],this.settingsService.getEstateProperties(this.currentUser,this.rentalBillForm.blockId.value,!0,"RENTAL").subscribe({next:o=>{if(this.logger.info("getEstateProperties response "+JSON.stringify(o)),o.headerResponse.responseCode!=="000"){this.alertService.error(o.headerResponse.responseMessage);return}if(o.properties.length<=0){this.alertService.showInfoMsgGeneral("No properties found"),this.logger.info("No properties found "),this.rentalBillForm.propertyId.setValue("No properties found");return}this.listOfProperties=o.properties},error:o=>{this.logger.error(o.message),this.alertService.showInfoMsg(o.message)}})}logAction(o,c){return y(this,null,function*(){yield this.accountService.logUserAudit(o,c)})}};a.\u0275fac=function(c){return new(c||a)(f(re),f(O),f(x),f(Z),f(j),f(A),f(U),f(R))},a.\u0275cmp=I({type:a,selectors:[["ng-component"]],standalone:!0,features:[C],decls:101,vars:80,consts:[[1,"card","card-no-border"],[1,"card-inner"],["novalidate","",3,"formGroup"],[1,"row"],[1,"col-2"],[1,"col-8"],[3,"pageTitleName","description"],[1,"card-bordered"],[1,"row","gy-4"],[1,"col-sm-6"],[1,"form-group"],[3,"labelForName","labelName"],[1,"form-control-wrap"],["id","estateid","formControlName","estateId",3,"clearable","ngClass","change"],["value","","selected","",1,"fs-6"],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],[4,"ngIf"],["id","estateid","formControlName","blockId",3,"clearable","ngClass","change"],["class","text-danger",4,"ngIf"],["id","propertyId","formControlName","propertyId",3,"clearable","ngClass"],["type","number","formControlName","rentAmount","id","rentAmount","autocomplete","off",1,"form-control",3,"ngClass"],["id","startMonth","formControlName","startMonth",3,"clearable","ngClass"],["id","startYear","formControlName","startYear",3,"clearable","ngClass"],["id","endMonth","formControlName","endMonth",3,"clearable","ngClass"],["id","endYear","formControlName","endYear",3,"clearable","ngClass"],[1,"col-sm-12"],[1,"custom-control","custom-control-sm","custom-checkbox","checked"],["type","checkbox","formControlName","saveAndNew","id","saveAndNew","id","saveAndNew",1,"custom-control-input"],["for","saveAndNew",1,"custom-control-label","fw-bolder"],[1,"row","my-3","mb-3","justify-content-end"],[1,"col-auto"],["data-bs-dismiss","modal",1,"btn","btn-outline-light","btn-sm",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click"],[3,"value"],[1,"text-danger"]],template:function(c,e){c&1&&(t(0,"div",0)(1,"div",1)(2,"form",2)(3,"div",3),s(4,"div",4),t(5,"div",5),s(6,"app-add-item",6),t(7,"div",7)(8,"div",1)(9,"div",8),s(10,"app-required-fields-notice"),t(11,"div",9)(12,"div",10),s(13,"app-form-label",11),t(14,"div",12)(15,"ng-select",13),F("change",function(){return e.fetchBlocks()}),t(16,"ng-option",14),d(17,"Select Estate"),r(),p(18,pe,2,2,"ng-option",15),r(),t(19,"span",16),p(20,ue,2,0,"div",17),r()()()(),t(21,"div",9)(22,"div",10),s(23,"app-form-label",11),t(24,"div",12)(25,"ng-select",18),F("change",function(){return e.fetchEstateProperties()}),t(26,"ng-option",14),d(27,"Select Block"),r(),p(28,ce,2,2,"ng-option",15),r(),t(29,"span",16),p(30,fe,2,0,"div",19),r()()()(),t(31,"div",9)(32,"div",10),s(33,"app-form-label",11),t(34,"div",12)(35,"ng-select",20)(36,"ng-option",14),d(37,"Select Property"),r(),p(38,ge,2,3,"ng-option",15),r(),t(39,"span",16),p(40,ve,2,0,"div",17),r()()()(),t(41,"div",9)(42,"div",10),s(43,"app-form-label",11),t(44,"div",12),s(45,"input",21),t(46,"span",16),p(47,he,2,0,"div",17),r()()()(),t(48,"div",9)(49,"div",10),s(50,"app-form-label",11),t(51,"div",12)(52,"ng-select",22)(53,"ng-option",14),d(54,"Select Start Month"),r(),p(55,Be,2,2,"ng-option",15),r(),t(56,"span",16),p(57,Fe,2,0,"div",17),r()()()(),t(58,"div",9)(59,"div",10),s(60,"app-form-label",11),t(61,"div",12)(62,"ng-select",23)(63,"ng-option",14),d(64,"Select Property"),r(),p(65,be,2,2,"ng-option",15),r(),t(66,"span",16),p(67,Se,2,0,"div",17),r()()()(),t(68,"div",9)(69,"div",10),s(70,"app-form-label",11),t(71,"div",12)(72,"ng-select",24)(73,"ng-option",14),d(74,"Select Property"),r(),p(75,ye,2,2,"ng-option",15),r(),t(76,"span",16),p(77,Ie,2,0,"div",17),r()()()(),t(78,"div",9)(79,"div",10),s(80,"app-form-label",11),t(81,"div",12)(82,"ng-select",25)(83,"ng-option",14),d(84,"Select Property"),r(),p(85,_e,2,2,"ng-option",15),r(),t(86,"span",16),p(87,Ce,2,0,"div",17),r()()()(),t(88,"div",26)(89,"div",27),s(90,"input",28),t(91,"label",29),d(92," Save & select new property "),r()()()(),t(93,"div",30)(94,"div",31)(95,"button",32),F("click",function(){return e.resetRentalBill()}),d(96," Reset "),r()(),t(97,"div",31)(98,"button",33),F("click",function(){return e.applyBackRentalBill()}),d(99," Apply back billing "),r()()()()()(),s(100,"div",4),r()()()()),c&2&&(n(2),i("formGroup",e.rentalBillFormGroup),n(4),i("pageTitleName","Back Rental Billing")("description","Apply rental bill for previous months and years"),n(7),i("labelForName","estateId")("labelName","Estate"),n(2),i("clearable",!1)("ngClass",u(54,v,((e.rentalBillForm.estateId==null?null:e.rentalBillForm.estateId.touched)||(e.rentalBillForm.estateId==null?null:e.rentalBillForm.estateId.dirty)||e.submitted)&&(e.rentalBillForm.estateId==null?null:e.rentalBillForm.estateId.errors))),n(3),i("ngForOf",e.listOfEstates),n(2),i("ngIf",(e.rentalBillForm.estateId==null||e.rentalBillForm.estateId.errors==null?null:e.rentalBillForm.estateId.errors.required)||e.submitted),n(3),i("labelForName","blockId")("labelName","Block"),n(2),i("clearable",!0)("ngClass",u(56,v,((e.rentalBillForm.blockId==null?null:e.rentalBillForm.blockId.touched)||(e.rentalBillForm.blockId==null?null:e.rentalBillForm.blockId.dirty)||e.submitted)&&(e.rentalBillForm.blockId==null?null:e.rentalBillForm.blockId.errors))),n(3),i("ngForOf",e.listOfBlocks),n(2),i("ngIf",e.rentalBillForm.blockId==null||e.rentalBillForm.blockId.errors==null?null:e.rentalBillForm.blockId.errors.required),n(3),i("labelForName","propertyId")("labelName","Estate Properties"),n(2),i("clearable",!1)("ngClass",u(58,b,e.rentalBillForm.propertyId==null?null:e.rentalBillForm.propertyId.valid))("ngClass",u(60,v,((e.rentalBillForm.propertyId==null?null:e.rentalBillForm.propertyId.touched)||(e.rentalBillForm.propertyId==null?null:e.rentalBillForm.propertyId.dirty)||e.submitted)&&(e.rentalBillForm.propertyId==null?null:e.rentalBillForm.propertyId.errors))),n(3),i("ngForOf",e.listOfProperties),n(2),i("ngIf",e.rentalBillForm.propertyId==null||e.rentalBillForm.propertyId.errors==null?null:e.rentalBillForm.propertyId.errors.required),n(3),i("labelForName","rentAmount")("labelName","Rent Charge"),n(2),i("ngClass",u(62,v,((e.rentalBillForm.rentAmount==null?null:e.rentalBillForm.rentAmount.touched)||(e.rentalBillForm.rentAmount==null?null:e.rentalBillForm.rentAmount.dirty)||e.submitted)&&(e.rentalBillForm.rentAmount==null?null:e.rentalBillForm.rentAmount.errors))),n(2),i("ngIf",e.rentalBillForm.rentAmount==null||e.rentalBillForm.rentAmount.errors==null?null:e.rentalBillForm.rentAmount.errors.required),n(3),i("labelForName","startMonth")("labelName","Start Month"),n(2),i("clearable",!1)("ngClass",u(64,b,e.rentalBillForm.startMonth==null?null:e.rentalBillForm.startMonth.valid))("ngClass",u(66,v,((e.rentalBillForm.startMonth==null?null:e.rentalBillForm.startMonth.touched)||(e.rentalBillForm.startMonth==null?null:e.rentalBillForm.startMonth.dirty)||e.submitted)&&(e.rentalBillForm.startMonth==null?null:e.rentalBillForm.startMonth.errors))),n(3),i("ngForOf",e.listOfMonths),n(2),i("ngIf",e.rentalBillForm.startMonth==null||e.rentalBillForm.startMonth.errors==null?null:e.rentalBillForm.startMonth.errors.required),n(3),i("labelForName","startYear")("labelName","Start Year"),n(2),i("clearable",!1)("ngClass",u(68,b,e.rentalBillForm.startYear==null?null:e.rentalBillForm.startYear.valid))("ngClass",u(70,v,((e.rentalBillForm.startYear==null?null:e.rentalBillForm.startYear.touched)||(e.rentalBillForm.startYear==null?null:e.rentalBillForm.startYear.dirty)||e.submitted)&&(e.rentalBillForm.startYear==null?null:e.rentalBillForm.startYear.errors))),n(3),i("ngForOf",e.listOfChargeYears),n(2),i("ngIf",e.rentalBillForm.startYear==null||e.rentalBillForm.startYear.errors==null?null:e.rentalBillForm.startYear.errors.required),n(3),i("labelForName","endMonth")("labelName","End Month"),n(2),i("clearable",!1)("ngClass",u(72,b,e.rentalBillForm.endMonth==null?null:e.rentalBillForm.endMonth.valid))("ngClass",u(74,v,((e.rentalBillForm.endMonth==null?null:e.rentalBillForm.endMonth.touched)||(e.rentalBillForm.endMonth==null?null:e.rentalBillForm.endMonth.dirty)||e.submitted)&&(e.rentalBillForm.endMonth==null?null:e.rentalBillForm.endMonth.errors))),n(3),i("ngForOf",e.listOfMonths),n(2),i("ngIf",e.rentalBillForm.endMonth==null||e.rentalBillForm.endMonth.errors==null?null:e.rentalBillForm.endMonth.errors.required),n(3),i("labelForName","endYear")("labelName","End Year"),n(2),i("clearable",!1)("ngClass",u(76,b,e.rentalBillForm.endYear==null?null:e.rentalBillForm.endYear.valid))("ngClass",u(78,v,((e.rentalBillForm.endYear==null?null:e.rentalBillForm.endYear.touched)||(e.rentalBillForm.endYear==null?null:e.rentalBillForm.endYear.dirty)||e.submitted)&&(e.rentalBillForm.endYear==null?null:e.rentalBillForm.endYear.errors))),n(3),i("ngForOf",e.listOfChargeYears),n(2),i("ngIf",e.rentalBillForm.endYear==null||e.rentalBillForm.endYear.errors==null?null:e.rentalBillForm.endYear.errors.required))},dependencies:[k,M,N,E,L,H,T,G,w,q,P,$,V,D,W,K,J,X,le,te,ee,z,Q],encapsulation:2});let l=a;return l})();export{Ke as HouseRentBackBillingComponent};
